var me=Object.defineProperty;var Z=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var $=(d,e,s)=>e in d?me(d,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[e]=s,A=(d,e)=>{for(var s in e||(e={}))_e.call(e,s)&&$(d,s,e[s]);if(Z)for(var s of Z(e))ge.call(e,s)&&$(d,s,e[s]);return d};import{d as se,_ as ne,U as c,t as U,c as f,o as r,p as P,a5 as ye,e as R,ac as pe,r as H,bx as xe,ci as Se,A as ve,aH as ee,al as we,bX as he,q as l,s as t,V as M,w as i,X as w,Y as S,F as G,n as Y}from"./index-DzJUk-4s.js";import{u as be,c as ze,d as ke}from"./systemStore-CDAOEx2u.js";import{u as Fe,S as te}from"./projectStore-BUNtFK-_.js";import{c as Ie,e as De}from"./file-BoGdIhh5.js";import{g as Ce,D as Le}from"./plugin-BZaVEG5Y.js";import{u as Te}from"./useScroll.hook-BppF_wKM.js";import{i as ie}from"./icon-Bt2TghsQ.js";import{i as Ne,d as Ee}from"./index-YIaHLc6Z.js";import{i as Ve}from"./import-C6j5z5Sk.js";import{n as Be}from"./noData-C0vzgK10.js";const Ae=se({__name:"index",props:{showVideo:{type:Boolean,default:!1},fileUrl:{type:String,required:!0},fileName:{type:String,required:!0},fileSuffix:{type:String,required:!0},size:{type:Number,default:14},width:{type:Number,required:!1},height:{type:Number,required:!1},customStyle:{type:Object,required:!1,default:()=>({})}},setup(d,{expose:e}){e();const s={get fetchFileType(){return De},get fetchFileIcon(){return Ie}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),Me=["src"],Ue=["src"],Oe=["src"];function je(d,e,s,n,D,C){const m=c("n-image"),k=c("svg-icon");return n.fetchFileType(s.fileName,s.fileSuffix)==="photo"?(r(),U(m,{key:0,lazy:"",src:s.fileUrl,height:s.height||s.size,width:s.width||s.size,style:P(A({},s.customStyle)),"object-fit":"contain",alt:"图表图片"},null,8,["src","height","width","style"])):s.showVideo&&n.fetchFileType(s.fileName,s.fileSuffix)==="video"&&s.fileSuffix!=="mp3"?(r(),f("video",{key:1,autoplay:"false",loop:"",muted:"",crossOrigin:"anonymous",style:P(A({height:s.height||s.size+"px",width:s.width||s.size+"px"},s.customStyle))},[s.fileSuffix==="mp4"?(r(),f("source",{key:0,src:s.fileUrl,type:"video/mp4"},null,8,Me)):s.fileSuffix==="webm"?(r(),f("source",{key:1,src:s.fileUrl,type:"video/webm"},null,8,Ue)):(r(),f("source",{key:2,src:s.fileUrl,type:"video/mp4"},null,8,Oe))],4)):(r(),U(k,{key:2,icon:n.fetchFileIcon(s.fileUrl,s.fileSuffix),style:P(A({fontSize:s.size+"px"},s.customStyle))},null,8,["icon","style"]))}const qe=ne(Ae,[["render",je],["__file","index.vue"]]);var oe=(d=>(d.UPLOAD="upload",d))(oe||{});const Pe=se({__name:"index",setup(d,{expose:e}){e(),ye(a=>({"21a80408":X.value}));const{contentRef:s,page:n,pageSize:D,bottom:C,inBottom:m}=Te(60),{AddIcon:k,EllipsisHorizontalIcon:y,TrashIcon:p,RefreshIcon:O,ArrowRedoOutlineIcon:x,ListIcon:j,GridOutlineIcon:q}=ie.ionicons5,{LinkIcon:L}=ie.carbon,v=be(),h=Fe(),F=pe(),z=H(0 .toFixed(2)),b=H([]),o=H({}),_=xe();let T=null;const le=[{label:"上传文件",desc:"可用于字体、地图、组件依赖等静态资源",img:Ve,key:"upload"}],ae=[{label:"跳转链接",key:"toLink",icon:ee(x)},{label:"删除",key:"delete",icon:ee(p)}],X=R(()=>F.getAppTheme),re=R(()=>h.staticFileListType?h.staticFileListType===te.LIST:!0),ce=R(()=>ze());Se(async()=>{N(),I(),ve(()=>C.value,a=>{if(a){if(n.value+=1,m.value)return;I(o.value.nextMarker)}})});const N=async()=>{const a=await v.getCloudStorageDirectorySize();z.value=a.mb.toFixed(2)},I=async(a="")=>{const u=await v.getCloudStorageStatic({pageSize:D.value,nextMarker:a||""}),E=u.objects.map(g=>{const V=g.name.split("/");let B=V[V.length-1];const Q=B.lastIndexOf(".");return g.fileName=B.substring(0,Q),g.fileSuffix=B.substring(Q+1,B.length),g.size=(g.size/1024/1024).toFixed(2),g.date=ke(g.lastModified).format("YYYY-MM-DD"),g});a===""&&(o.value={},m.value=!1,b.value=[]),o.value=u,u.isTruncated||(m.value=!0),b.value=[...b.value,...E].sort((g,V)=>new Date(V.lastModified).getTime()-new Date(g.lastModified).getTime())},ue=()=>{const a=v.checkSVIP,u=Number(z.value);if(a){if(u>1024){window.$message.warning("SVIP用户上传大小限制为1G");return}}else if(u>100){window.$message.warning("存储空间已到达上限，请升级为SVIP用户");return}W()},{files:de,open:W,reset:fe,onChange:J}=Ne({accept:"*",directory:!1,multiple:!1});J(async a=>{if(!a)return;const u=a[0];if(u.size/1024/1024>20){window.$message.error("文件大小不能超过20M");return}T=_.create("正在上传文件",{type:"loading"}),await v.setCloudStorageStatic(u),await I(),await N(),T.destroy(),_.success("上传成功")});const K={ListItemEnum:oe,contentRef:s,page:n,pageSize:D,bottom:C,inBottom:m,AddIcon:k,EllipsisHorizontalIcon:y,TrashIcon:p,RefreshIcon:O,ArrowRedoOutlineIcon:x,ListIcon:j,GridOutlineIcon:q,LinkIcon:L,systemStore:v,projectStore:h,designStore:F,sizeNum:z,fileList:b,currentCloudStorage:o,message:_,get msgReactive(){return T},set msgReactive(a){T=a},listItem:le,dropdownOptions:ae,themeColor:X,isListType:re,checkMember:ce,getCurrentSize:N,getListData:I,openCreateModal:ue,files:de,open:W,reset:fe,onChange:J,handleDropdownSelect:(a,u)=>{a==="toLink"?we(u.url):a==="delete"&&Ce({title:"警告",type:Le.DELETE,message:"删除后此资源将永久失效, 此操作不可恢复！",onPositiveCallback:async()=>{await v.deleteCloudStorageStatic(u.name),window.$message.success("删除成功"),I(),N()}})},copyName:async(a,u)=>{a.preventDefault(),a.stopPropagation();const{copy:E,isSupported:g}=Ee({source:u});g.value?(await E(),window.$message.success("复制链接成功")):he(u)?window.$message.success("复制链接成功"):window.$message.error("复制失败")},changeTypeHandle:a=>{h.setItem("staticFileListType",a)},get StaticFileListTypeEnum(){return te},GoUrlImageVideoFile:qe};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}}),Re={class:"go-file-static-box",ref:"contentRef"},He={class:"team-header-tips"},Ge={class:"files-num"},Ye={key:0,class:"go-mx-1"},Xe={key:1,class:"go-mx-1"},We={key:0,class:"create-box"},Je={class:"go-flex-center"},Ke=["src"],Qe={class:"right-desc"},Ze={class:"label"},$e={key:1,class:"card-box"},et={class:"card-item go-mb-2",style:{width:"100%",height:"20px"}},tt={class:"card-item"},it={class:"item-time"},st={class:"item-size"},nt={key:2,class:"card-box"},ot={class:"bottom-desc"},lt={class:"bottom-button"},at={key:3,class:"go-flex-column-center",style:{margin:"100px auto"}};function rt(d,e,s,n,D,C){const m=c("n-text"),k=c("n-tab"),y=c("n-icon"),p=c("n-button"),O=c("n-button-group"),x=c("n-flex"),j=c("n-tabs"),q=c("n-divider"),L=c("n-grid-item"),v=c("n-grid"),h=c("n-tooltip"),F=c("n-ellipsis"),z=c("n-dropdown"),b=c("n-card");return r(),f("div",Re,[l("div",null,[t(j,{type:"line",animated:""},{suffix:i(()=>[t(x,{align:"center"},{default:i(()=>[l("div",He,[e[5]||(e[5]=l("span",null,"「当前资源存储空间 ",-1)),l("span",Ge,S(n.sizeNum),1),n.systemStore.checkSVIP?(r(),f("span",Ye," / 1024 MB")):(r(),f("span",Xe,"/ 100 MB")),e[6]||(e[6]=l("span",null,null,-1)),e[7]||(e[7]=l("span",null,"」",-1))]),t(O,null,{default:i(()=>[t(p,{size:"tiny",type:n.isListType?"primary":"",ghost:"",onClick:e[0]||(e[0]=o=>n.changeTypeHandle(n.StaticFileListTypeEnum.LIST))},{icon:i(()=>[t(y,{size:"14"},{default:i(()=>[t(n.ListIcon)]),_:1})]),_:1},8,["type"]),t(p,{size:"tiny",ghost:"",type:n.isListType?"":"primary",onClick:e[1]||(e[1]=o=>n.changeTypeHandle(n.StaticFileListTypeEnum.CARD))},{icon:i(()=>[t(y,null,{default:i(()=>[t(n.GridOutlineIcon)]),_:1})]),_:1},8,["type"])]),_:1})]),_:1})]),default:i(()=>[t(k,{name:"file-static-box"},{default:i(()=>[t(m,{type:"primary"},{default:i(()=>e[4]||(e[4]=[w(" 资源存储 ")])),_:1})]),_:1})]),_:1})]),t(q,{style:{margin:"0px"}}),n.checkMember?(r(),f("div",We,[t(v,{"x-gap":20,"y-gap":20,cols:"1 s:2 m:2 l:3 xl:3 xxl:4",responsive:"screen"},{default:i(()=>[(r(),f(G,null,Y(n.listItem,o=>t(L,{key:o.key},{default:i(()=>[l("div",{class:"item go-flex-center go-transition-quick",onClick:e[2]||(e[2]=_=>n.openCreateModal())},[l("div",Je,[l("img",{class:"go-transition",src:o.img,alt:"创建"},null,8,Ke),l("div",Qe,[l("div",Ze,S(o.label),1),t(m,{class:"desc",depth:3},{default:i(()=>[w(S(o.desc),1)]),_:2},1024)])]),t(y,{size:"16",component:n.AddIcon},null,8,["component"])])]),_:2},1024)),64))]),_:1})])):M("",!0),n.isListType?(r(),f("div",$e,[l("div",et,[t(x,{class:"go-pl-4",align:"center",size:4},{default:i(()=>[e[9]||(e[9]=w(" 文件名称 ")),t(h,{trigger:"hover","show-arrow":!1},{trigger:i(()=>[t(p,{text:"",size:"small",onClick:e[3]||(e[3]=o=>n.getListData())},{default:i(()=>[t(y,{size:"16"},{default:i(()=>[t(n.RefreshIcon)]),_:1})]),_:1})]),default:i(()=>[e[8]||(e[8]=w(" 刷新列表 "))]),_:1})]),_:1}),e[10]||(e[10]=l("div",{class:"item-time"},"更新时间",-1)),e[11]||(e[11]=l("div",{class:"item-size",style:{position:"relative",left:"-6px"}},"大小 / GB",-1)),e[12]||(e[12]=l("div",{class:"item-button go-pr-4",style:{"text-align":"right"}},"文件操作",-1))]),(r(!0),f(G,null,Y(n.fileList,o=>(r(),U(b,{class:"card-item-box","content-style":"padding: 6px 20px;",key:o.owner.id,size:"small"},{default:i(()=>[l("div",tt,[t(x,{align:"center"},{default:i(()=>[t(x,{justify:"space-between",style:{width:"34px",overflow:"hidden"}},{default:i(()=>[t(n.GoUrlImageVideoFile,{showVideo:!1,fileUrl:o.url,fileName:o.fileName,fileSuffix:o.fileSuffix,size:34,customStyle:{borderRadius:"5px"}},null,8,["fileUrl","fileName","fileSuffix"])]),_:2},1024),t(F,null,{default:i(()=>[l("span",null,S(o.fileName)+"."+S(o.fileSuffix),1)]),_:2},1024)]),_:2},1024),l("div",it,S(o.date),1),l("span",st,S(o.size)+"MB",1),t(x,{class:"item-button",align:"center",wrap:!1},{default:i(()=>[t(p,{quaternary:"",size:"small",onClick:_=>n.copyName(_,o.url)},{default:i(()=>[t(m,{class:"go-fs-13 go-mr-2",depth:"2"},{default:i(()=>e[13]||(e[13]=[w(" 复制链接 ")])),_:1}),t(y,{size:"16"},{default:i(()=>[t(n.LinkIcon)]),_:1})]),_:2},1032,["onClick"]),t(z,{trigger:"hover",options:n.dropdownOptions,onSelect:_=>n.handleDropdownSelect(_,o)},{default:i(()=>[t(p,{quaternary:"",size:"small",style:{width:"40px"}},{default:i(()=>[t(y,{size:"16"},{default:i(()=>[t(n.EllipsisHorizontalIcon)]),_:1})]),_:1})]),_:2},1032,["onSelect"])]),_:2},1024)])]),_:2},1024))),128))])):M("",!0),n.isListType?M("",!0):(r(),f("div",nt,[t(v,{"x-gap":10,"y-gap":10,cols:"3 s:5 m:6 l:7 xl:8 xxl:9",responsive:"screen"},{default:i(()=>[(r(!0),f(G,null,Y(n.fileList,o=>(r(),U(L,{key:o.owner.id},{default:i(()=>[t(b,{class:"card-item-box card-type","content-style":"padding: 10px 10px;",size:"small"},{default:i(()=>[t(x,{class:"item-left",align:"center",size:0,vertical:"",justify:"center"},{default:i(()=>[t(n.GoUrlImageVideoFile,{showVideo:!1,fileUrl:o.url,fileName:o.fileName,fileSuffix:o.fileSuffix,size:50,width:100,style:{overflow:"hidden"}},null,8,["fileUrl","fileName","fileSuffix"]),t(F,{class:"go-fs-13 go-mt-2"},{default:i(()=>[w(S(o.fileName)+"."+S(o.fileSuffix),1)]),_:2},1024),l("div",ot,[t(x,{class:"go-mt-2",justify:"center"},{default:i(()=>[t(m,{class:"go-fs-12",depth:"3"},{default:i(()=>[w(S(o.size)+"MB",1)]),_:2},1024)]),_:2},1024)]),l("div",lt,[t(h,{trigger:"hover","show-arrow":!1},{trigger:i(()=>[t(p,{quaternary:"",size:"small",onClick:_=>n.copyName(_,o.url)},{default:i(()=>[t(m,{class:"go-fs-12 go-mr-2",depth:"2"},{default:i(()=>e[14]||(e[14]=[w(" 链接 ")])),_:1}),t(y,{size:"16"},{default:i(()=>[t(n.LinkIcon)]),_:1})]),_:2},1032,["onClick"])]),default:i(()=>[e[15]||(e[15]=l("span",{class:"go-fs-12"},"点击复制",-1))]),_:2},1024),t(z,{trigger:"hover",options:n.dropdownOptions,onSelect:_=>n.handleDropdownSelect(_,o)},{default:i(()=>[t(p,{quaternary:"",size:"small",style:{width:"40px"}},{default:i(()=>[t(y,{size:"16"},{default:i(()=>[t(n.EllipsisHorizontalIcon)]),_:1})]),_:1})]),_:2},1032,["onSelect"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])),n.fileList.length===0?(r(),f("div",at,[e[17]||(e[17]=l("img",{src:Be,width:"230"},null,-1)),t(m,{depth:"3"},{default:i(()=>e[16]||(e[16]=[w("暂未上传资源文件 ~ ")])),_:1})])):M("",!0)],512)}const bt=ne(Pe,[["render",rt],["__scopeId","data-v-e05b50af"],["__file","index.vue"]]);export{bt as default};
