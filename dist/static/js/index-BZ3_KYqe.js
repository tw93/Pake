import{M as T}from"./index-DumZb7Zp.js";import{d as A,r as B,bt as V,bJ as S,bM as D,ab as y,b3 as b,bj as L,f as M,c4 as R,bS as J,_ as j,U as r,c as G,o as C,s as t,w as o,q as z,t as x,V as E,X as _}from"./index-DzJUk-4s.js";import{g as H}from"./storage-u-tNEdAI.js";import"./querySelectorAll-CWDd-9ax.js";import{g as O}from"./plugin-BZaVEG5Y.js";import{i as U}from"./icon-Bt2TghsQ.js";import{u as k}from"./index-B2h3DCGB.js";import{u as $}from"./useSync.hook-CykodbHN.js";import"./systemStore-CDAOEx2u.js";import"./file-BoGdIhh5.js";import"./index-YIaHLc6Z.js";import"./fileTypeEnum-22QBGXO_.js";const q=A({__name:"index",setup(P,{expose:n}){n();const{updateComponent:f}=$(),{DownloadIcon:a,AnalyticsIcon:v}=U.ionicons5,p=window.showOpenFilePicker,l=B(""),c=V();window.$message.warning("请不要刷新此窗口！");async function d(){const e=k(),i=M(),s=R(y.GO_CHART_STORAGE_LIST)||[];if(s!=null&&s.length){const N=s.find(h=>h.id===i);f(N,!0)}else await H();c&&c.activeIndex&&await e.setCurrentPage(c.activeIndex||0);const{editCanvasConfig:w,requestGlobalConfig:F,componentList:I}=e;J(`编辑-${e.projectInfo.projectName}`),l.value=b({editCanvasConfig:w,requestGlobalConfig:F,componentList:I})}d();function g(){O({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:async()=>{try{const i=await(await p())[0].getFile(),s=new FileReader;s.readAsText(i),s.onloadend=()=>{l.value=(s.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}}})}window.opener.addEventListener(S.CHART,e=>{window.$message.success("正在进行更新..."),D(y.GO_CHART_STORAGE_LIST,[e.detail]),l.value=b(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),u())});async function u(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");O({message:"是否覆盖源视图内容? 此操作不可撤回！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{try{const e=k(),i=L(l.value);delete i.id,i.activeIndex=c.activeIndex,e.saveCurrentPage(),window.opener.dispatchEvent(new CustomEvent(S.JSON,{detail:i})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}}})}window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(S.CLOSE))};const m={updateComponent:f,DownloadIcon:a,AnalyticsIcon:v,showOpenFilePicker:p,content:l,params:c,getDataBySession:d,importJSON:g,updateSync:u,MonacoEditor:T};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),K={class:"go-edit"};function X(P,n,f,a,v,p){const l=r("n-text"),c=r("n-icon"),d=r("n-button"),g=r("n-tag"),u=r("n-flex"),m=r("n-space"),e=r("n-layout-header"),i=r("n-layout-content"),s=r("n-layout");return C(),G("div",K,[t(s,null,{default:o(()=>[t(e,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:o(()=>[z("div",null,[t(l,{class:"go-edit-title go-mr-4"},{default:o(()=>n[1]||(n[1]=[_("页面在线编辑器")])),_:1}),a.showOpenFilePicker?(C(),x(d,{key:0,class:"go-mr-3",size:"medium",onClick:a.importJSON},{icon:o(()=>[t(c,null,{default:o(()=>[t(a.DownloadIcon)]),_:1})]),default:o(()=>[n[2]||(n[2]=_(" 导入 "))]),_:1})):E("",!0)]),t(m,null,{default:o(()=>[a.showOpenFilePicker?(C(),x(d,{key:0,class:"go-mr-3",size:"medium",onClick:a.updateSync},{icon:o(()=>[t(c,null,{default:o(()=>[t(a.AnalyticsIcon)]),_:1})]),default:o(()=>[t(u,{align:"center",size:6},{default:o(()=>[n[4]||(n[4]=_(" 更新视图 ")),t(g,{size:"small",bordered:!1,type:"info"},{default:o(()=>n[3]||(n[3]=[_(" 「Ctrl + S」 ")])),_:1})]),_:1})]),_:1})):E("",!0)]),_:1})]),_:1}),t(i,null,{default:o(()=>[t(a.MonacoEditor,{modelValue:a.content,"onUpdate:modelValue":n[0]||(n[0]=w=>a.content=w),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}const ce=j(q,[["render",X],["__scopeId","data-v-bcbe32f6"],["__file","index.vue"]]);export{ce as default};
