var Dt=Object.defineProperty;var Le=Object.getOwnPropertySymbols;var xt=Object.prototype.hasOwnProperty,kt=Object.prototype.propertyIsEnumerable;var He=(n,e,l)=>e in n?Dt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[e]=l,Re=(n,e)=>{for(var l in e||(e={}))xt.call(e,l)&&He(n,l,e[l]);if(Le)for(var l of Le(e))kt.call(e,l)&&He(n,l,e[l]);return n};import{bI as Ye,A as Xe,r as H,H as ue,d as Ne,s as o,X as d,e as ne,a5 as It,ac as St,b2 as Ee,D as At,fh as Ze,b8 as de,ay as Ot,cv as Me,fi as Nt,cS as ke,E as ie,aw as le,K as Pe,fj as Tt,R as Vt,P as jt,_ as $e,U as D,c as $,o as M,w as a,t as X,q as m,aS as Y,Y as te,z as Bt,fk as Lt,F as ce,n as et,V as se,b3 as Ht,bj as Rt,bu as ze,fl as Mt,fm as Pt,fn as zt,aU as Ut,W as Fe,$ as _e}from"./index-DzJUk-4s.js";import{c as tt,h as qt,D as Gt}from"./index-DkV0_qOD.js";import{g as Ie}from"./plugin-BZaVEG5Y.js";import{i as fe}from"./icon-Bt2TghsQ.js";import{D as De,T as Jt}from"./index-DnNrz6w_.js";import{c as Kt}from"./index-YIaHLc6Z.js";import{M as nt}from"./index-DumZb7Zp.js";import{j as Ue,e as Qt,c as Wt,a as Yt,k as Xt,l as Zt}from"./logo-Bd1KfhDG.js";import{D as $t}from"./DataBaseAIChat-Dq68Jh7Q.js";import{u as en}from"./systemStore-CDAOEx2u.js";import{u as tn}from"./indexDBStore-BkJ2w0ZQ.js";import{F as qe}from"./fileTypeEnum-22QBGXO_.js";import{a as nn,r as on}from"./file-BoGdIhh5.js";var ge={d:(n,e)=>{for(var l in e)ge.o(e,l)&&!ge.o(n,l)&&Object.defineProperty(n,l,{enumerable:!0,get:e[l]})},o:(n,e)=>Object.prototype.hasOwnProperty.call(n,e)},ot={};function Se(n,e){(e==null||e>n.length)&&(e=n.length);for(var l=0,t=new Array(e);l<e;l++)t[l]=n[l];return t}function at(n,e){if(n){if(typeof n=="string")return Se(n,e);var l=Object.prototype.toString.call(n).slice(8,-1);return l==="Object"&&n.constructor&&(l=n.constructor.name),l==="Map"||l==="Set"?Array.from(n):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?Se(n,e):void 0}}function pe(n){return function(e){if(Array.isArray(e))return Se(e)}(n)||function(e){if(typeof Symbol!="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}(n)||at(n)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function me(n,e,l){return e in n?Object.defineProperty(n,e,{value:l,enumerable:!0,configurable:!0,writable:!0}):n[e]=l,n}ge.d(ot,{Z:()=>un});const f=(Ge={computed:()=>ne,createTextVNode:()=>d,createVNode:()=>o,defineComponent:()=>Ne,reactive:()=>ue,ref:()=>H,watch:()=>Xe,watchEffect:()=>Ye},xe={},ge.d(xe,Ge),xe),an=(0,f.defineComponent)({props:{data:{required:!0,type:String},onClick:Function},render:function(){var n=this.data,e=this.onClick;return(0,f.createVNode)("span",{class:"vjs-tree-brackets",onClick:e},[n])}}),ln=(0,f.defineComponent)({emits:["change","update:modelValue"],props:{checked:{type:Boolean,default:!1},isMultiple:Boolean,onChange:Function},setup:function(n,e){var l=e.emit;return{uiType:(0,f.computed)(function(){return n.isMultiple?"checkbox":"radio"}),model:(0,f.computed)({get:function(){return n.checked},set:function(t){return l("update:modelValue",t)}})}},render:function(){var n=this.uiType,e=this.model,l=this.$emit;return(0,f.createVNode)("label",{class:["vjs-check-controller",e?"is-checked":""],onClick:function(t){return t.stopPropagation()}},[(0,f.createVNode)("span",{class:"vjs-check-controller-inner is-".concat(n)},null),(0,f.createVNode)("input",{checked:e,class:"vjs-check-controller-original is-".concat(n),type:n,onChange:function(){return l("change",e)}},null)])}}),rn=(0,f.defineComponent)({props:{nodeType:{required:!0,type:String},onClick:Function},render:function(){var n=this.nodeType,e=this.onClick,l=n==="objectStart"||n==="arrayStart";return l||n==="objectCollapsed"||n==="arrayCollapsed"?(0,f.createVNode)("span",{class:"vjs-carets vjs-carets-".concat(l?"open":"close"),onClick:e},[(0,f.createVNode)("svg",{viewBox:"0 0 1024 1024",focusable:"false","data-icon":"caret-down",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},[(0,f.createVNode)("path",{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"},null)])]):null}});var Ge,xe;function Ae(n){return Ae=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ae(n)}function lt(n){return Object.prototype.toString.call(n).slice(8,-1).toLowerCase()}function ae(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"root",l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0,N=t||{},T=N.key,w=N.index,h=N.type,S=h===void 0?"content":h,k=N.showComma,z=k!==void 0&&k,j=N.length,v=j===void 0?1:j,F=lt(n);if(F==="array"){var R=Je(n.map(function(O,_,r){return ae(O,"".concat(e,"[").concat(_,"]"),l+1,{index:_,showComma:_!==r.length-1,length:v,type:S})}));return[ae("[",e,l,{showComma:!1,key:T,length:n.length,type:"arrayStart"})[0]].concat(R,ae("]",e,l,{showComma:z,length:n.length,type:"arrayEnd"})[0])}if(F==="object"){var B=Object.keys(n),V=Je(B.map(function(O,_,r){return ae(n[O],/^[a-zA-Z_]\w*$/.test(O)?"".concat(e,".").concat(O):"".concat(e,'["').concat(O,'"]'),l+1,{key:O,showComma:_!==r.length-1,length:v,type:S})}));return[ae("{",e,l,{showComma:!1,key:T,index:w,length:B.length,type:"objectStart"})[0]].concat(V,ae("}",e,l,{showComma:z,length:B.length,type:"objectEnd"})[0])}return[{content:n,level:l,key:T,index:w,path:e,showComma:z,length:v,type:S}]}function Je(n){if(typeof Array.prototype.flat=="function")return n.flat();for(var e=pe(n),l=[];e.length;){var t=e.shift();Array.isArray(t)?e.unshift.apply(e,pe(t)):l.push(t)}return l}function Oe(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new WeakMap;if(n==null)return n;if(n instanceof Date)return new Date(n);if(n instanceof RegExp)return new RegExp(n);if(Ae(n)!=="object")return n;if(e.get(n))return e.get(n);if(Array.isArray(n)){var l=n.map(function(T){return Oe(T,e)});return e.set(n,l),l}var t={};for(var N in n)t[N]=Oe(n[N],e);return e.set(n,t),t}function Ke(n,e){var l=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(N){return Object.getOwnPropertyDescriptor(n,N).enumerable})),l.push.apply(l,t)}return l}function Qe(n){for(var e=1;e<arguments.length;e++){var l=arguments[e]!=null?arguments[e]:{};e%2?Ke(Object(l),!0).forEach(function(t){me(n,t,l[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(l)):Ke(Object(l)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(l,t))})}return n}var rt={showLength:{type:Boolean,default:!1},showDoubleQuotes:{type:Boolean,default:!0},renderNodeKey:Function,renderNodeValue:Function,selectableType:String,showSelectController:{type:Boolean,default:!1},showLine:{type:Boolean,default:!0},showLineNumber:{type:Boolean,default:!1},selectOnClickNode:{type:Boolean,default:!0},nodeSelectable:{type:Function,default:function(){return!0}},highlightSelectedNode:{type:Boolean,default:!0},showIcon:{type:Boolean,default:!1},theme:{type:String,default:"light"},showKeyValueSpace:{type:Boolean,default:!0},editable:{type:Boolean,default:!1},editableTrigger:{type:String,default:"click"},onNodeClick:{type:Function},onBracketsClick:{type:Function},onIconClick:{type:Function},onValueChange:{type:Function}};const sn=(0,f.defineComponent)({name:"TreeNode",props:Qe(Qe({},rt),{},{node:{type:Object,required:!0},collapsed:Boolean,checked:Boolean,style:Object,onSelectedChange:{type:Function}}),emits:["nodeClick","bracketsClick","iconClick","selectedChange","valueChange"],setup:function(n,e){var l=e.emit,t=(0,f.computed)(function(){return lt(n.node.content)}),N=(0,f.computed)(function(){return"vjs-value vjs-value-".concat(t.value)}),T=(0,f.computed)(function(){return n.showDoubleQuotes?'"'.concat(n.node.key,'"'):n.node.key}),w=(0,f.computed)(function(){return n.selectableType==="multiple"}),h=(0,f.computed)(function(){return n.selectableType==="single"}),S=(0,f.computed)(function(){return n.nodeSelectable(n.node)&&(w.value||h.value)}),k=(0,f.reactive)({editing:!1}),z=function(_){var r,s,y=(s=(r=_.target)===null||r===void 0?void 0:r.value)==="null"?null:s==="undefined"?void 0:s==="true"||s!=="false"&&(s[0]+s[s.length-1]==='""'||s[0]+s[s.length-1]==="''"?s.slice(1,-1):typeof Number(s)=="number"&&!isNaN(Number(s))||s==="NaN"?Number(s):s);l("valueChange",y,n.node.path)},j=(0,f.computed)(function(){var _,r=(_=n.node)===null||_===void 0?void 0:_.content;return r===null?r="null":r===void 0&&(r="undefined"),t.value==="string"?'"'.concat(r,'"'):r+""}),v=function(){var _=n.renderNodeValue;return _?_({node:n.node,defaultValue:j.value}):j.value},F=function(){l("bracketsClick",!n.collapsed,n.node)},R=function(){l("iconClick",!n.collapsed,n.node)},B=function(){l("selectedChange",n.node)},V=function(){l("nodeClick",n.node),S.value&&n.selectOnClickNode&&l("selectedChange",n.node)},O=function(_){if(n.editable&&!k.editing){k.editing=!0;var r=function s(y){var u;y.target!==_.target&&((u=y.target)===null||u===void 0?void 0:u.parentElement)!==_.target&&(k.editing=!1,document.removeEventListener("click",s))};document.removeEventListener("click",r),document.addEventListener("click",r)}};return function(){var _,r=n.node;return(0,f.createVNode)("div",{class:{"vjs-tree-node":!0,"has-selector":n.showSelectController,"has-carets":n.showIcon,"is-highlight":n.highlightSelectedNode&&n.checked,dark:n.theme==="dark"},onClick:V,style:n.style},[n.showLineNumber&&(0,f.createVNode)("span",{class:"vjs-node-index"},[r.id+1]),n.showSelectController&&S.value&&r.type!=="objectEnd"&&r.type!=="arrayEnd"&&(0,f.createVNode)(ln,{isMultiple:w.value,checked:n.checked,onChange:B},null),(0,f.createVNode)("div",{class:"vjs-indent"},[Array.from(Array(r.level)).map(function(s,y){return(0,f.createVNode)("div",{key:y,class:{"vjs-indent-unit":!0,"has-line":n.showLine}},null)}),n.showIcon&&(0,f.createVNode)(rn,{nodeType:r.type,onClick:R},null)]),r.key&&(0,f.createVNode)("span",{class:"vjs-key"},[(_=n.renderNodeKey,_?_({node:n.node,defaultKey:T.value||""}):T.value),(0,f.createVNode)("span",{class:"vjs-colon"},[":".concat(n.showKeyValueSpace?" ":"")])]),(0,f.createVNode)("span",null,[r.type!=="content"&&r.content?(0,f.createVNode)(an,{data:r.content.toString(),onClick:F},null):(0,f.createVNode)("span",{class:N.value,onClick:!n.editable||n.editableTrigger&&n.editableTrigger!=="click"?void 0:O,onDblclick:n.editable&&n.editableTrigger==="dblclick"?O:void 0},[n.editable&&k.editing?(0,f.createVNode)("input",{value:j.value,onChange:z,style:{padding:"3px 8px",border:"1px solid #eee",boxShadow:"none",boxSizing:"border-box",borderRadius:5,fontFamily:"inherit"}},null):v()]),r.showComma&&(0,f.createVNode)("span",null,[","]),n.showLength&&n.collapsed&&(0,f.createVNode)("span",{class:"vjs-comment"},[(0,f.createTextVNode)(" // "),r.length,(0,f.createTextVNode)(" items ")])])])}}});function We(n,e){var l=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(N){return Object.getOwnPropertyDescriptor(n,N).enumerable})),l.push.apply(l,t)}return l}function G(n){for(var e=1;e<arguments.length;e++){var l=arguments[e]!=null?arguments[e]:{};e%2?We(Object(l),!0).forEach(function(t){me(n,t,l[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(l)):We(Object(l)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(l,t))})}return n}const un=(0,f.defineComponent)({name:"Tree",props:G(G({},rt),{},{data:{type:[String,Number,Boolean,Array,Object],default:null},collapsedNodeLength:{type:Number,default:1/0},deep:{type:Number,default:1/0},pathCollapsible:{type:Function,default:function(){return!1}},rootPath:{type:String,default:"root"},virtual:{type:Boolean,default:!1},height:{type:Number,default:400},itemHeight:{type:Number,default:20},selectedValue:{type:[String,Array],default:function(){return""}},collapsedOnClickBrackets:{type:Boolean,default:!0},style:Object,onSelectedChange:{type:Function},theme:{type:String,default:"light"}}),slots:["renderNodeKey","renderNodeValue"],emits:["nodeClick","bracketsClick","iconClick","selectedChange","update:selectedValue","update:data"],setup:function(n,e){var l=e.emit,t=e.slots,N=(0,f.ref)(),T=(0,f.computed)(function(){return ae(n.data,n.rootPath)}),w=function(r,s){return T.value.reduce(function(y,u){var b,E=u.level>=r||u.length>=s,p=(b=n.pathCollapsible)===null||b===void 0?void 0:b.call(n,u);return u.type!=="objectStart"&&u.type!=="arrayStart"||!E&&!p?y:G(G({},y),{},me({},u.path,1))},{})},h=(0,f.reactive)({translateY:0,visibleData:null,hiddenPaths:w(n.deep,n.collapsedNodeLength)}),S=(0,f.computed)(function(){for(var r=null,s=[],y=T.value.length,u=0;u<y;u++){var b=G(G({},T.value[u]),{},{id:u}),E=h.hiddenPaths[b.path];if(r&&r.path===b.path){var p=r.type==="objectStart",L=G(G(G({},b),r),{},{showComma:b.showComma,content:p?"{...}":"[...]",type:p?"objectCollapsed":"arrayCollapsed"});r=null,s.push(L)}else{if(E&&!r){r=b;continue}if(r)continue;s.push(b)}}return s}),k=(0,f.computed)(function(){var r=n.selectedValue;return r&&n.selectableType==="multiple"&&Array.isArray(r)?r:[r]}),z=(0,f.computed)(function(){return!n.selectableType||n.selectOnClickNode||n.showSelectController?"":"When selectableType is not null, selectOnClickNode and showSelectController cannot be false at the same time, because this will cause the selection to fail."}),j=function(){var r=S.value;if(n.virtual){var s,y=n.height/n.itemHeight,u=((s=N.value)===null||s===void 0?void 0:s.scrollTop)||0,b=Math.floor(u/n.itemHeight),E=b<0?0:b+y>r.length?r.length-y:b;E<0&&(E=0);var p=E+y;h.translateY=E*n.itemHeight,h.visibleData=r.filter(function(L,I){return I>=E&&I<p})}else h.visibleData=r},v=function(){j()},F=function(r){var s,y,u=r.path,b=n.selectableType;if(b==="multiple"){var E=k.value.findIndex(function(U){return U===u}),p=pe(k.value);E!==-1?p.splice(E,1):p.push(u),l("update:selectedValue",p),l("selectedChange",p,pe(k.value))}else if(b==="single"&&k.value[0]!==u){var L=(s=k.value,y=1,function(U){if(Array.isArray(U))return U}(s)||function(U,Q){var P=U==null?null:typeof Symbol!="undefined"&&U[Symbol.iterator]||U["@@iterator"];if(P!=null){var oe,W,K=[],x=!0,C=!1;try{for(P=P.call(U);!(x=(oe=P.next()).done)&&(K.push(oe.value),!Q||K.length!==Q);x=!0);}catch(q){C=!0,W=q}finally{try{x||P.return==null||P.return()}finally{if(C)throw W}}return K}}(s,y)||at(s,y)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}())[0],I=u;l("update:selectedValue",I),l("selectedChange",I,L)}},R=function(r){l("nodeClick",r)},B=function(r,s){if(r)h.hiddenPaths=G(G({},h.hiddenPaths),{},me({},s,1));else{var y=G({},h.hiddenPaths);delete y[s],h.hiddenPaths=y}},V=function(r,s){n.collapsedOnClickBrackets&&B(r,s.path),l("bracketsClick",r,s)},O=function(r,s){B(r,s.path),l("iconClick",r,s)},_=function(r,s){var y=Oe(n.data),u=n.rootPath;new Function("data","val","data".concat(s.slice(u.length),"=val"))(y,r),l("update:data",y)};return(0,f.watchEffect)(function(){z.value&&function(r){throw new Error("[VueJSONPretty] ".concat(r))}(z.value)}),(0,f.watchEffect)(function(){S.value&&j()}),(0,f.watch)(function(){return n.deep},function(r){r&&(h.hiddenPaths=w(r,n.collapsedNodeLength))}),(0,f.watch)(function(){return n.collapsedNodeLength},function(r){r&&(h.hiddenPaths=w(n.deep,r))}),function(){var r,s,y=(r=n.renderNodeKey)!==null&&r!==void 0?r:t.renderNodeKey,u=(s=n.renderNodeValue)!==null&&s!==void 0?s:t.renderNodeValue,b=h.visibleData&&h.visibleData.map(function(E){return(0,f.createVNode)(sn,{key:E.id,node:E,collapsed:!!h.hiddenPaths[E.path],theme:n.theme,showDoubleQuotes:n.showDoubleQuotes,showLength:n.showLength,checked:k.value.includes(E.path),selectableType:n.selectableType,showLine:n.showLine,showLineNumber:n.showLineNumber,showSelectController:n.showSelectController,selectOnClickNode:n.selectOnClickNode,nodeSelectable:n.nodeSelectable,highlightSelectedNode:n.highlightSelectedNode,editable:n.editable,editableTrigger:n.editableTrigger,showIcon:n.showIcon,showKeyValueSpace:n.showKeyValueSpace,renderNodeKey:y,renderNodeValue:u,onNodeClick:R,onBracketsClick:V,onIconClick:O,onSelectedChange:F,onValueChange:_,style:n.itemHeight&&n.itemHeight!==20?{lineHeight:"".concat(n.itemHeight,"px")}:{}},null)});return(0,f.createVNode)("div",{ref:N,class:{"vjs-tree":!0,"is-virtual":n.virtual,dark:n.theme==="dark"},onScroll:n.virtual?v:void 0,style:n.showLineNumber?G({paddingLeft:"".concat(12*Number(T.value.length.toString().length),"px")},n.style):n.style},[n.virtual?(0,f.createVNode)("div",{class:"vjs-tree-list",style:{height:"".concat(n.height,"px")}},[(0,f.createVNode)("div",{class:"vjs-tree-list-holder",style:{height:"".concat(S.value.length*n.itemHeight,"px")}},[(0,f.createVNode)("div",{class:"vjs-tree-list-holder-inner",style:{transform:"translateY(".concat(h.translateY,"px)")}},[b])])]):b])}}});var it=ot.Z;const dn="过滤后数据的期望结果（可进行修改）",cn=Ne({__name:"index",setup(n,{expose:e}){e(),It(i=>({"4d0a6810":he.value}));const{DocumentTextIcon:l,AddIcon:t,TrashOutlineIcon:N,ChevronUpOutlineIcon:T,ChevronDownOutlineIcon:w,EllipsisHorizontalIcon:h}=fe.ionicons5,{EditIcon:S,DraggableIcon:k,MaximizeIcon:z}=fe.carbon,j=At(),{targetData:v,chartEditStore:F}=tt(),R=St(),B=en(),V=tn(),O=H(window.__PRIVATE_MODULE__.CloseOpenAI),_=H(!1),r=H(!1),s=ue({beforeRes:void 0,content:void 0,stringValue:"",index:0}),y=H(v.value.filter||"return data"),u=H(!1),b=H(""),E=H([]),p=ue({dragIndex:0}),L=ue([]),I=H(),U=Kt("GO_AIChatFilterCollapsed",!1);let Q=null;const P=H(""),oe=H(!1),W=H(!1),K=H(""),x=H(260),C=H(260),q=()=>{U.value=!0},ee=()=>{U.value=!1},re=async()=>{try{const i=await Ze(de(v.value.request),de(F.getRequestGlobalConfig));if(i){b.value=i;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(i){console.error(i),window.$message.warning("数据异常，请检查！")}};Ye(()=>{const i=[];v.value.filterConfig.selectList.forEach(c=>{if(c.globalFilterId!==""){const g=F.pageConfig.globalFilterList.find(A=>A.id===c.globalFilterId);i.push(Re({id:c.globalFilterId,desc:(g==null?void 0:g.desc)||"「暂无描述」",name:(g==null?void 0:g.name)||"该全局过滤器已被删除"},g))}}),E.value=i});const he=ne(()=>R.getAppTheme),Z=ne(()=>F.pageConfig.globalFilterList.map(i=>{const c=v.value.filterConfig.selectList.some(g=>g.globalFilterId===i.id);return{label:`${i.name}${c?" (已选择)":""}`,value:i.id,desc:i.desc,disabled:c}})),J=ne(()=>{try{const i=new Function("data","res","id",y.value),c=Ee(b.value),g=i(c==null?void 0:c.data,c,v.value.id);return u.value=!1,g}catch(i){return u.value=!0,`过滤函数错误，日志：${i}`}}),st=ne(()=>{if(r.value)try{const i=Ee(b.value),g=new Function(`return (function(...args) {${s.stringValue}})`)().bind()(s.beforeRes,i==null?void 0:i.data,i,v.value.id);return u.value=!1,g}catch(i){return u.value=!0,`过滤函数错误，日志：${i}`}}),ut=i=>{const{option:c,node:g}=i;return c.desc?Ot(Me,{keepAliveOnHover:!1,showArrow:!1,style:{width:"max-content",maxWidth:"300px"},placement:"left"},{trigger:()=>[g],default:()=>c.desc}):g},dt=async()=>{_.value=!0,P.value=await Ce()||"",y.value=v.value.filter||"return data",b.value||ve(),re(),ye()},ct=async(i,c)=>{s.stringValue=i.stringValue||"",s.content=i,s.index=c;try{b.value||ve(),await re();const g=v.value.filterConfig.selectList.slice(0,s.index).map(A=>A.globalFilterId).filter(A=>!!A);s.beforeRes=Nt(b.value,v.value.id,v.value.filter,g),P.value=await Ce()||""}catch(g){s.beforeRes="数据错误，请检查接口或前置过滤器结果"}r.value=!0,ye()},ft=i=>{i&&(v.value.filterConfig.selectList.push({globalFilterId:i,use:!0}),window.$message.success("添加成功, 重新请求可刷新数据"))},gt=i=>{v.value.filterConfig.selectList.splice(i,1),window.$message.success("删除成功, 重新请求可刷新数据")},pt=()=>{Ie({message:"是否删除初始化过滤器？",onPositiveCallback:()=>{v.value.filter=void 0}})},Te=()=>{_.value=!1},Ve=()=>{r.value=!1},mt=()=>{if(u.value){window.$message.error("过滤函数错误，无法进行保存");return}v.value.filter=y.value,v.value.request.requestDataType===ke.AJAX?j.emit(ie.CHART_EDIT_TRIGGER_FILTER_SEND_REQUEST):j.emit(ie.CHART_EDIT_TRIGGER_FILTER_SEND_POND_REQUEST),window.$message.success("保存成功"),Te()},ht=()=>{if(u.value){window.$message.error("过滤函数错误，无法进行保存");return}F.getFilterList.forEach(i=>{var c;i.id===((c=s.content)==null?void 0:c.id)&&(i.stringValue=s.stringValue)}),v.value.request.requestDataType===ke.AJAX?j.emit(ie.CHART_EDIT_TRIGGER_FILTER_SEND_REQUEST):j.emit(ie.CHART_EDIT_TRIGGER_FILTER_SEND_POND_REQUEST),window.$message.success("保存成功"),Ve()},vt=()=>{le(()=>{const i=document.querySelector(".editor-data-show-right"),c=document.querySelector(".editor-fetch-data-show"),g=document.querySelector(".editor-res-data-show");i&&c&&g&&(x.value=c.clientHeight-36,C.value=i.clientHeight-c.clientHeight-36)})},ve=()=>{setTimeout(()=>{const i=document.querySelector(".editor-data-show-right");i&&(x.value=(i.clientHeight-60)/2,C.value=(i.clientHeight-60)/2)},300)},yt=(i,c)=>{if(i.preventDefault(),p.dragIndex!==c){const g=E.value[p.dragIndex];E.value.splice(p.dragIndex,1),E.value.splice(c,0,g),p.dragIndex=c}},wt=i=>{i.preventDefault()},bt=(i,c)=>{p.dragIndex=c},Ct=i=>{const c=E.value.map(g=>g.id);v.value.filterConfig.selectList=c.map(g=>({globalFilterId:g,use:!0}))},ye=async()=>{const i=await V.getFilterFunction();i!=null&&i.length&&(L.length=0,i.forEach(c=>{c.AIContent&&L.push(Ue(c.AIContent,be(c.AIContent)))})),B.getMembershipInfo.model&&Promise.all([we()]).then(()=>{L.push(Qt("历史消息"))})},Et=async i=>{if(!B.getMembershipInfo.model){window.$message.warning("请先前往首页配制全局AI数据"),le(()=>{var g;(g=I.value)==null||g.unLoading()});return}if(!i){window.$message.warning("请输入数据"),le(()=>{var g,A;(g=I.value)==null||g.unLoading(),(A=I.value)==null||A.setValue("")});return}const c=Wt(i,i);L.push(c),b.value?setTimeout(async()=>{L.push(Yt("正在解析中，预计还需30秒～1分钟，请稍等..."));let g=P.value;(Pe.isObject(g)||Pe.isArray(g))&&(g=Ee(JSON.parse(P.value)),g=Tt(g)),await Xt({inputData:JSON.stringify(b.value),outputData:g,demand:i,functionType:_.value?"1":"2"}),setTimeout(()=>{le(()=>{var A;(A=I.value)==null||A.setValue("")})},1e3),await je()},500):(window.$message.warning("接口暂未返回有效数据，请检查接口！"),setTimeout(()=>{le(()=>{var g,A;(g=I.value)==null||g.unLoading(),(A=I.value)==null||A.setValue("")})},1e3))},je=async()=>{setTimeout(()=>{var i;(i=I.value)==null||i.unLoading()},5e3),Q=setInterval(async()=>{await we(i=>{var c;i!=null&&i.length&&((c=I.value)==null||c.unLoading(),clearInterval(Q))})},3e3)},we=async i=>{const c=await Zt({});c.code===Vt.SUCCESS&&c.data&&(await V.pushFilterFunction(c.data),c.data.forEach(g=>{const A=be(g.AIContent);L.push(Ue(g.AIContent,A||g.AIContent))}),i&&i(c.data))},be=i=>{const c=i.trimStart().startsWith("```"),g=i.trimEnd().endsWith("```");if(!c&&!g)return i;let A=i.split(`
`);return A.length>0&&A[0].startsWith("```")&&(A=A.slice(1)),A.length>0&&A[A.length-1].trim()==="```"&&(A=A.slice(0,-1)),A.join(`
`).trim()},Ft=async(i,c=!1)=>{window.$message.success("应用成功"),c?s.stringValue=i:y.value=i},_t=()=>{try{JSON.parse(K.value)}catch(i){return window.$message.error("数据格式错误，请检查！"),!1}W.value?(W.value=!1,P.value=K.value):W.value=!0},Ce=async()=>{var g;const i=v.value.chartConfig;let c=null;if(i.package===jt.REMOTES)return JSON.stringify(i==null?void 0:i.dataset,null,2);if(c=await qt(i),c)return i.dataset&&(c.option.dataset=i.dataset),JSON.stringify((g=c==null?void 0:c.option)==null?void 0:g.dataset,null,2)},Be={DocumentTextIcon:l,AddIcon:t,TrashOutlineIcon:N,ChevronUpOutlineIcon:T,ChevronDownOutlineIcon:w,EllipsisHorizontalIcon:h,EditIcon:S,DraggableIcon:k,MaximizeIcon:z,eventBus:j,targetData:v,chartEditStore:F,designStore:R,systemStore:B,indexDBStore:V,CloseOpenAI:O,showModal:_,showGlobalModal:r,showModalEditContent:s,filterCode:y,errorFlag:u,sourceData:b,filterList:E,dragInfo:p,messageList:L,AIChatRef:I,closeAIChat:U,get intervalTime(){return Q},set intervalTime(i){Q=i},AIOutput:P,outputDataDesc:dn,insideCard:oe,maxEditShowModal:W,maxEdiMonacoEditor:K,boxHeight:x,bottomSplitHeight:C,collapsedHandle:q,expandHandle:ee,fetchTargetData:re,themeColor:he,filterOptions:Z,filterResObj:J,filterGlobalResObj:st,renderOption:ut,addFilter:dt,editGlobalFilter:ct,addGlobalFilter:ft,deleteGlobalFilter:gt,delFilter:pt,closeFilter:Te,closeGlobalFilter:Ve,saveFilter:mt,saveGlobalFilter:ht,handleOnMoveEnd:vt,initLayout:ve,dragenter:yt,dragover:wt,dragstart:bt,dragend:Ct,AIDataInit:ye,sendHandle:Et,getAIHandle:je,getAIDataToIndexDB:we,contentApplyHandle:be,useFilterHandle:Ft,onPositiveClick:_t,getDefaultData:Ce,closeHandle:()=>{P.value="",K.value="",oe.value=!1,clearInterval(Q)},get NTooltip(){return Me},get VueJsonPretty(){return it},MonacoEditor:nt,DataBaseAIChat:$t};return Object.defineProperty(Be,"__isScriptSetup",{enumerable:!1,value:!0}),Be}}),fn={class:"go-ml-2 code-model-box"},gn={key:1,class:"n-card-shallow go-mb-1","content-style":"padding: 8px 10px;"},pn=["onClick"],mn={class:"go-pl-2 code-model-box"},hn={class:"go-mr-2",style:{height:"78vh",width:"480px"}},vn={class:"ai-input"},yn={key:0,style:{"margin-top":"-12px"}},wn={class:"editor-code-box"},bn={class:"editor-code-filter"},Cn={class:"editor-fetch-data-show"},En={class:"editor-data-show"},Fn={class:"editor-data-show editor-res-data-show"},_n={class:"go-flex-items-center"},Dn={class:"go-mr-2",style:{height:"78vh",width:"480px"}},xn={class:"ai-input"},kn={key:0,style:{"margin-top":"-12px"}},In={class:"editor-code-box"},Sn={class:"editor-code-filter"},An={class:"editor-fetch-data-show"},On={class:"editor-data-show"},Nn={class:"editor-data-show editor-res-data-show"},Tn={class:"go-flex-items-center"};function Vn(n,e,l,t,N,T){const w=D("n-icon"),h=D("n-button"),S=D("n-flex"),k=D("n-divider"),z=D("n-code"),j=D("n-collapse-item"),v=D("n-collapse"),F=D("n-text"),R=D("n-select"),B=D("n-ellipsis"),V=D("n-card"),O=D("n-space"),_=D("n-collapse-transition"),r=D("n-layout-sider"),s=D("n-tag"),y=D("n-split"),u=D("n-layout-content"),b=D("n-layout"),E=D("n-modal");return M(),$(ce,null,[o(V,{"content-style":"padding: 4px 8px 8px;"},{default:a(()=>[t.targetData.filter?(M(),X(v,{key:0,class:"chart-data-filter-global-collapse go-mb-3","default-expanded-names":[]},{default:a(()=>[o(j,null,{header:a(()=>e[15]||(e[15]=[m("span",{class:"go-fs-12",style:{padding:"2px 0 1px"}},"初始化过滤器",-1)])),arrow:a(()=>[d(te(),1)]),"header-extra":a(()=>[o(S,null,{default:a(()=>[o(t.NTooltip,{trigger:"hover"},{trigger:a(()=>[o(h,{text:"",onClick:Y(t.addFilter,["stop"])},{default:a(()=>[o(w,null,{default:a(()=>[o(t.EditIcon)]),_:1})]),_:1})]),default:a(()=>[e[16]||(e[16]=d(" 编辑 "))]),_:1}),o(t.NTooltip,{trigger:"hover"},{trigger:a(()=>[o(h,{text:"",onClick:Y(t.delFilter,["stop"])},{default:a(()=>[o(w,null,{default:a(()=>[o(t.TrashOutlineIcon)]),_:1})]),_:1})]),default:a(()=>[e[17]||(e[17]=d(" 删除 "))]),_:1})]),_:1})]),default:a(()=>[o(k,{class:"collapse-divider",style:{margin:"0 0 4px"}}),m("div",{class:"code-item-box go-p-2 go-pt-0",onClick:Y(t.addFilter,["stop"])},[e[19]||(e[19]=m("p",null,[m("span",{class:"func-keyword"},"function"),d("  "),m("span",{class:"func-name"},"filter"),d("(data, res, id)  { ")],-1)),m("div",fn,[o(z,{class:"go-fs-12",code:t.targetData.filter,language:"typescript"},null,8,["code"]),e[18]||(e[18]=m("div",{class:"code-model"},null,-1))])])]),_:1})]),_:1})):(M(),$("div",gn,[o(S,{justify:"space-between",align:"center",style:{height:"38px"}},{default:a(()=>[o(F,{class:"go-fs-12",depth:3},{default:a(()=>e[20]||(e[20]=[d("初始化过滤器")])),_:1}),o(h,{class:"go-ml-3 go-fs-13",type:"primary",size:"small",tertiary:"",onClick:e[0]||(e[0]=p=>t.addFilter()),style:{"padding-right":"15px"}},{icon:a(()=>[o(w,null,{default:a(()=>[o(t.AddIcon)]),_:1})]),default:a(()=>[e[21]||(e[21]=d(" 添加 "))]),_:1})]),_:1})])),o(k,{style:{margin:"12px 0"}}),o(S,{size:0,wrap:!1,class:Bt({"go-mb-3":t.filterList.length}),align:"center",justify:"space-between"},{default:a(()=>[o(F,{class:"go-fs-12",depth:"3"},{default:a(()=>e[22]||(e[22]=[d("全局过滤器「拖拽排序」")])),_:1}),o(R,{clearable:"",size:"small",style:{width:"140px"},placeholder:"请选择过滤器","render-option":t.renderOption,options:t.filterOptions,"onUpdate:value":t.addGlobalFilter},null,8,["options"])]),_:1},8,["class"]),o(v,{class:"chart-data-filter-global-collapse","default-expanded-names":[]},{default:a(()=>[o(Lt,{name:"drag"},{default:a(()=>[(M(!0),$(ce,null,et(t.filterList,(p,L)=>(M(),X(j,{name:p.id,key:p.id,draggable:"true",onDragenter:I=>t.dragenter(I,L),onDragover:e[1]||(e[1]=I=>t.dragover(I)),onDragstart:I=>t.dragstart(I,L),onDragend:e[2]||(e[2]=I=>t.dragend(I))},{arrow:a(()=>[d(te(),1)]),header:a(()=>[o(w,{class:"collapse-header-drag"},{default:a(()=>[o(t.DraggableIcon)]),_:1}),o(t.NTooltip,null,{trigger:a(()=>[m("div",null,[o(B,{style:{"max-width":"180px"}},{default:a(()=>[d(te(p.name||"未命名"),1)]),_:2},1024)])]),default:a(()=>[d(" "+te(p.desc||"暂无描述"),1)]),_:2},1024)]),"header-extra":a(()=>[o(S,null,{default:a(()=>[o(t.NTooltip,{trigger:"hover"},{trigger:a(()=>[o(h,{text:"",onClick:Y(I=>t.editGlobalFilter(p,L),["stop"])},{default:a(()=>[o(w,null,{default:a(()=>[o(t.EditIcon)]),_:1})]),_:2},1032,["onClick"])]),default:a(()=>[e[23]||(e[23]=d(" 编辑 "))]),_:2},1024),o(t.NTooltip,{trigger:"hover"},{trigger:a(()=>[o(h,{text:"",onClick:Y(I=>t.deleteGlobalFilter(L),["stop"])},{default:a(()=>[o(w,null,{default:a(()=>[o(t.TrashOutlineIcon)]),_:1})]),_:2},1032,["onClick"])]),default:a(()=>[e[24]||(e[24]=d(" 删除（不会影响全局数据） "))]),_:2},1024)]),_:2},1024)]),default:a(()=>[o(k,{class:"collapse-divider",style:{margin:"0 0 4px"}}),m("div",{class:"code-item-box go-p-2 go-pt-0",onClick:Y(I=>t.editGlobalFilter(p,L),["stop"])},[e[26]||(e[26]=m("p",null,[m("span",{class:"func-keyword"},"function"),d("  "),m("span",{class:"func-name"},"filter"),d("( ...args)  { ")],-1)),m("div",mn,[o(z,{class:"go-fs-12",code:p.stringValue||"",language:"typescript"},null,8,["code"]),e[25]||(e[25]=m("div",{class:"code-model"},null,-1))])],8,pn)]),_:2},1032,["name","onDragenter","onDragstart"]))),128))]),_:1})]),_:1})]),_:1}),o(E,{class:"go-chart-data-monaco-editor",show:t.showModal,"onUpdate:show":e[7]||(e[7]=p=>t.showModal=p),"mask-closable":!1,closeOnEsc:!1,onAfterLeave:t.closeHandle},{default:a(()=>[o(V,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{"min-width":"1200px",width:"85vw"}},{header:a(()=>[o(O,null,{default:a(()=>[o(F,null,{default:a(()=>e[27]||(e[27]=[d("过滤器函数编辑器")])),_:1})]),_:1})]),action:a(()=>[o(O,{justify:"space-between"},{default:a(()=>[m("div",_n,[o(s,{bordered:!1,type:"primary"},{icon:a(()=>[o(w,{component:t.DocumentTextIcon},null,8,["component"])]),default:a(()=>[e[37]||(e[37]=d(" 规则 "))]),_:1}),o(F,{class:"go-ml-2",depth:"2"},{default:a(()=>e[38]||(e[38]=[d("过滤器默认处理接口返回值的「data」字段")])),_:1})]),o(O,null,{default:a(()=>[o(h,{size:"medium",onClick:t.closeFilter},{default:a(()=>e[39]||(e[39]=[d("取消")])),_:1}),o(h,{size:"medium",type:"primary",onClick:t.saveFilter},{default:a(()=>e[40]||(e[40]=[d("保存")])),_:1})]),_:1})]),_:1})]),default:a(()=>[o(b,{"has-sider":""},{default:a(()=>[t.CloseOpenAI?se("",!0):(M(),X(r,{key:0,"collapse-mode":"transform",collapsed:t.closeAIChat,"collapsed-width":0,width:480,"show-trigger":"bar",bordered:"",onCollapse:t.collapsedHandle,onExpand:t.expandHandle},{default:a(()=>[m("div",hn,[o(t.DataBaseAIChat,{ref:"AIChatRef",width:480,height:"calc(76vh + 2px)",contentHeight:"calc(76vh - 129px)",messageList:t.messageList,hiddenBtn:!1,isVertical:!0,inputTitle:"请描述期望如何处理数据，也可直接输入<生成>。",onSend:t.sendHandle,onUseResponse:e[5]||(e[5]=p=>t.useFilterHandle(p,!1))},{inputTop:a(()=>[m("div",vn,[o(V,{size:"small","header-style":"padding: 4px 10px;"},{header:a(()=>[m("span",{style:{"font-size":"12px"}},te(t.outputDataDesc))]),"header-extra":a(()=>[o(h,{secondary:"",size:"tiny",onClick:e[3]||(e[3]=Y(p=>t.insideCard=!t.insideCard,["stop"]))},{default:a(()=>[o(S,{align:"center",size:8},{default:a(()=>[e[31]||(e[31]=d(" 展开 ")),o(w,{size:"14"},{default:a(()=>[t.insideCard?(M(),X(t.ChevronUpOutlineIcon,{key:0})):(M(),X(t.ChevronDownOutlineIcon,{key:1}))]),_:1})]),_:1})]),_:1}),o(h,{class:"go-ml-2",secondary:"",type:"info",size:"tiny",onClick:e[4]||(e[4]=Y(()=>{t.maxEdiMonacoEditor=t.AIOutput,t.maxEditShowModal=!0},["stop"]))},{default:a(()=>[o(S,{align:"center",size:8},{default:a(()=>[e[32]||(e[32]=d(" 编辑 ")),o(w,{size:"14"},{default:a(()=>[o(t.MaximizeIcon)]),_:1})]),_:1})]),_:1})]),default:a(()=>[o(_,{show:!t.insideCard},{default:a(()=>[o(t.VueJsonPretty,{data:t.AIOutput?JSON.parse(t.AIOutput):"",showIcon:!0,showLength:!0,showLineNumber:!0,showDoubleQuotes:!1,virtual:!0,height:150,style:{"font-size":"12px !important"}},null,8,["data"])]),_:1},8,["show"]),t.insideCard?(M(),$("div",yn,[o(w,null,{default:a(()=>[o(t.EllipsisHorizontalIcon)]),_:1})])):se("",!0)]),_:1}),o(k,{style:{margin:"8px 0"}})])]),default:a(()=>[o(F,{class:"go-mt-1",depth:2},{default:a(()=>[e[29]||(e[29]=d(" 支持自动关联")),o(F,{type:"info"},{default:a(()=>e[28]||(e[28]=[d("「接口返回值」")])),_:1}),e[30]||(e[30]=d("，提高结果准确率 "))]),_:1})]),_:1},8,["messageList"])])]),_:1},8,["collapsed"])),o(u,{"content-style":""},{default:a(()=>[m("div",wn,[o(y,{direction:"horizontal",max:.75,min:.25},{1:a(()=>[m("div",bn,[o(s,{type:"info"},{default:a(()=>e[33]||(e[33]=[m("span",{class:"func-keyword"},"function",-1),d("  "),m("span",{class:"func-name"},"filter",-1),d("(data, res, id)  { ")])),_:1}),o(t.MonacoEditor,{modelValue:t.filterCode,"onUpdate:modelValue":e[6]||(e[6]=p=>t.filterCode=p),width:"100%",height:"100%",language:"javascript"},null,8,["modelValue"]),o(s,{type:"info"},{default:a(()=>e[34]||(e[34]=[d("}")])),_:1})])]),2:a(()=>[o(y,{class:"editor-data-show-right",direction:"vertical",onDragEnd:t.handleOnMoveEnd},{1:a(()=>[m("div",Cn,[m("div",En,[o(F,{class:"go-fs-13 title",depth:"3"},{default:a(()=>e[35]||(e[35]=[d("res字段(整体数据)")])),_:1}),o(t.VueJsonPretty,{data:t.sourceData||"暂无",showIcon:!0,showLength:!0,showLineNumber:!0,showDoubleQuotes:!1,virtual:!0,height:t.boxHeight},null,8,["data","height"])])])]),2:a(()=>[m("div",Fn,[o(F,{class:"go-fs-13",depth:"3"},{default:a(()=>e[36]||(e[36]=[d("过滤器执行结果")])),_:1}),o(t.VueJsonPretty,{class:"go-mt-1",data:t.filterResObj,showIcon:!0,showLength:!0,showLineNumber:!0,showDoubleQuotes:!1,virtual:!0,height:t.bottomSplitHeight},null,8,["data","height"])])]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),o(E,{class:"go-chart-data-monaco-editor",show:t.showGlobalModal,"onUpdate:show":e[12]||(e[12]=p=>t.showGlobalModal=p),"mask-closable":!1,closeOnEsc:!1,onAfterLeave:t.closeHandle},{default:a(()=>[o(V,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{"min-width":"1000px",width:"85vw"}},{header:a(()=>[o(O,null,{default:a(()=>[o(F,null,{default:a(()=>e[41]||(e[41]=[d("全局过滤器函数编辑器")])),_:1})]),_:1})]),action:a(()=>[o(O,{justify:"space-between"},{default:a(()=>[m("div",Tn,[o(s,{bordered:!1,type:"primary"},{icon:a(()=>[o(w,{component:t.DocumentTextIcon},null,8,["component"])]),default:a(()=>[e[56]||(e[56]=d(" 规则 "))]),_:1}),o(F,{class:"go-ml-2",depth:"2"},{default:a(()=>e[57]||(e[57]=[d("过滤器默认处理接口返回值的「data」字段")])),_:1})]),o(O,null,{default:a(()=>[o(h,{size:"medium",onClick:t.closeGlobalFilter},{default:a(()=>e[58]||(e[58]=[d("取消")])),_:1}),o(h,{size:"medium",type:"primary",onClick:t.saveGlobalFilter},{default:a(()=>e[59]||(e[59]=[d("保存")])),_:1})]),_:1})]),_:1})]),default:a(()=>[o(b,{"has-sider":""},{default:a(()=>[t.CloseOpenAI?se("",!0):(M(),X(r,{key:0,"collapse-mode":"transform",collapsed:t.closeAIChat,"collapsed-width":0,width:480,"show-trigger":"bar",bordered:"",onCollapse:t.collapsedHandle,onExpand:t.expandHandle},{default:a(()=>[m("div",Dn,[o(t.DataBaseAIChat,{ref:"AIChatRef",width:0,height:"calc(76vh + 2px)",contentHeight:"calc(76vh - 129px)",messageList:t.messageList,hiddenBtn:!1,inputTitle:"请详细输入想要得到的数据结构与结果",onSend:t.sendHandle,onUseResponse:e[10]||(e[10]=p=>t.useFilterHandle(p,!0))},{inputTop:a(()=>[m("div",xn,[o(V,{size:"small","header-style":"padding: 4px 10px;"},{header:a(()=>[m("span",{style:{"font-size":"12px"}},te(t.outputDataDesc))]),"header-extra":a(()=>[o(h,{secondary:"",size:"tiny",onClick:e[8]||(e[8]=Y(p=>t.insideCard=!t.insideCard,["stop"]))},{default:a(()=>[o(S,{align:"center",size:8},{default:a(()=>[e[45]||(e[45]=d(" 展开 ")),o(w,{size:"14"},{default:a(()=>[t.insideCard?(M(),X(t.ChevronUpOutlineIcon,{key:0})):(M(),X(t.ChevronDownOutlineIcon,{key:1}))]),_:1})]),_:1})]),_:1}),o(h,{class:"go-ml-2",secondary:"",type:"info",size:"tiny",onClick:e[9]||(e[9]=Y(()=>{t.maxEdiMonacoEditor=t.AIOutput,t.maxEditShowModal=!0},["stop"]))},{default:a(()=>[o(S,{align:"center",size:8},{default:a(()=>[e[46]||(e[46]=d(" 编辑 ")),o(w,{size:"14"},{default:a(()=>[o(t.MaximizeIcon)]),_:1})]),_:1})]),_:1})]),default:a(()=>[o(_,{show:!t.insideCard},{default:a(()=>[o(t.VueJsonPretty,{data:t.AIOutput?JSON.parse(t.AIOutput):"",showIcon:!0,showLength:!0,showLineNumber:!0,showDoubleQuotes:!1,virtual:!0,height:150,style:{"font-size":"12px !important"}},null,8,["data"])]),_:1},8,["show"]),t.insideCard?(M(),$("div",kn,[o(w,null,{default:a(()=>[o(t.EllipsisHorizontalIcon)]),_:1})])):se("",!0)]),_:1}),o(k,{style:{margin:"8px 0"}})])]),default:a(()=>[o(F,{class:"go-mt-1",depth:2},{default:a(()=>[e[43]||(e[43]=d(" 支持自动关联")),o(F,{type:"info"},{default:a(()=>e[42]||(e[42]=[d("「接口返回值」")])),_:1}),e[44]||(e[44]=d("，提高结果准确率 "))]),_:1})]),_:1},8,["messageList"])])]),_:1},8,["collapsed"])),o(u,{"content-style":""},{default:a(()=>[m("div",In,[o(y,{direction:"horizontal",max:.75,min:.25},{1:a(()=>[m("div",Sn,[o(F,{depth:"3"},{default:a(()=>e[47]||(e[47]=[d(" 参数说明: (前过滤器数据=args[0], 接口数据的data=args[1], 接口数据=args[1], 当前组件ID=args[2]) ")])),_:1}),o(s,{type:"info"},{default:a(()=>[e[50]||(e[50]=m("span",{class:"func-keyword"},"function",-1)),e[51]||(e[51]=d("  ")),e[52]||(e[52]=m("span",{class:"func-name"}," globalFilter ",-1)),o(t.NTooltip,{trigger:"hover"},{trigger:a(()=>e[48]||(e[48]=[m("span",null,[m("span",{class:"code-style"},"(...args)"),d("  { ")],-1)])),default:a(()=>[e[49]||(e[49]=d(" 前过滤器返回数据，接口数据的data字段，接口整体数据，当前组件ID "))]),_:1})]),_:1}),o(t.MonacoEditor,{modelValue:t.showModalEditContent.stringValue,"onUpdate:modelValue":e[11]||(e[11]=p=>t.showModalEditContent.stringValue=p),width:"100%",height:"100%",language:"javascript"},null,8,["modelValue"]),o(s,{type:"info"},{default:a(()=>e[53]||(e[53]=[d("}")])),_:1})])]),2:a(()=>[o(y,{class:"editor-data-show-right",direction:"vertical",onDragEnd:t.handleOnMoveEnd},{1:a(()=>[m("div",An,[m("div",On,[o(F,{class:"go-fs-13 title",depth:"3"},{default:a(()=>e[54]||(e[54]=[d("获得的数据（仅展示前置返回的数据）")])),_:1}),o(t.VueJsonPretty,{data:t.showModalEditContent.beforeRes,showIcon:!0,showLength:!0,showLineNumber:!0,showDoubleQuotes:!1,virtual:!0,height:t.boxHeight},null,8,["data","height"])])])]),2:a(()=>[m("div",Nn,[o(F,{class:"go-fs-13",depth:"3"},{default:a(()=>e[55]||(e[55]=[d("过滤器执行结果")])),_:1}),o(t.VueJsonPretty,{class:"go-mt-1",data:t.filterGlobalResObj,showIcon:!0,showLength:!0,showLineNumber:!0,showDoubleQuotes:!1,virtual:!0,height:t.bottomSplitHeight},null,8,["data","height"])])]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),o(E,{show:t.maxEditShowModal,"onUpdate:show":e[14]||(e[14]=p=>t.maxEditShowModal=p),"mask-closable":!1,showIcon:!1,draggable:!0,preset:"dialog",title:"编辑想要生成的数据(JSON结构)","positive-text":"确认","negative-text":"取消",style:{width:"1000px"},onPositiveClick:t.onPositiveClick},{default:a(()=>[o(k,{style:{margin:"0 0 10px"}}),o(t.MonacoEditor,{modelValue:t.maxEdiMonacoEditor,"onUpdate:modelValue":e[13]||(e[13]=p=>t.maxEdiMonacoEditor=p),height:"500px",language:"json"},null,8,["modelValue"])]),_:1},8,["show"])],64)}const jn=$e(cn,[["render",Vn],["__scopeId","data-v-c902e489"],["__file","index.vue"]]),Bn=n=>{const e=H();return{uploadFileListRef:e,beforeUpload:({file:T})=>{e.value=[];const w=T.file.type;return w!==qe.JSON&&w!==qe.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},customRequest:T=>{const{file:w}=T;le(()=>{w.file?on(w.file).then(h=>{n.value.option.dataset=Rt(h)}):window.$message.error("导入数据失败，请稍后重试或联系管理员！")})},download:()=>{try{window.$message.success("下载中，请耐心等待..."),nn(Ht(n.value.option.dataset),void 0,"json")}catch(T){window.$message.error("下载失败，数据错误！")}}}},Ln=Ne({__name:"index",props:{show:{type:Boolean,required:!1},ajax:{type:Boolean,required:!0}},setup(n,{expose:e}){e();const{targetData:l,chartEditStore:t}=tt(),N=n,T=["源字段","映射","状态&过滤"],{HelpOutlineIcon:w,DocumentTextIcon:h,RefreshIcon:S}=fe.ionicons5,{DocumentAddIcon:k,DocumentDownloadIcon:z,EditIcon:j}=fe.carbon,v=H(),F=H(),R=H(!1),B=H(!1),V=H(""),{uploadFileListRef:O,customRequest:_,beforeUpload:r,download:s}=Bn(l),y=ne(()=>l.value.request.requestDataType!==ke.STATIC),u=ne(()=>l.value.chartConfig.chartFrame===ze.ECHARTS),b=x=>{const{oldIndex:C,newIndex:q}=x.moved;l.value.option.dataset.dimensions=l.value.mapping.map(ee=>ee.mappingValue)},E=()=>l.value.request.requestDataType!==0,p=x=>{let C=De.SUCCESS;for(let q=0;q<v.value.length;q++)if(v.value[q][x]===void 0)return C=De.FAILURE,C;return De.SUCCESS},L=(x=!1)=>{try{const C=E(),q=l.value.mapping,ee=F.value.length;if(q.length===ee&&!x)return q;const re=q.reduce((Z,J)=>(Z[J.mappingValue]=J,Z),{});return F.value.map(Z=>{const J=re[Z];return{mapping:C&&J?J.mapping:Z,mappingValue:C&&J?J.mappingValue:Z,display:J&&J.hasOwnProperty("display")?J.display:!0,result:p(Z)}})}catch(C){return[]}},I=async()=>{var x;if(E()){try{const C=await Ze(de(l.value.request),de(t.getRequestGlobalConfig));if(!C){window.$message.error("没有拿到返回值，请检查接口！");return}!(C!=null&&C.data)&&!l.value.filter&&!((x=l.value.filterConfig)!=null&&x.selectList[0].globalFilterId)&&window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),l.value.option.dataset=Mt(C==null?void 0:C.data,C,l.value.id,l.value.mapping,Pt(l.value))}catch(C){console.error(C),window.$message.error("数据异常，请检查！")}return}l.value.option.dataset=zt(l.value.option.dataset,l.value.mapping,!1)},U=ne(()=>l.value.chartConfig.chartKey==="VHtmlCommon"||l.value.chartConfig.chartKey==="VHtmlIframe"),Q=()=>{B.value=!0,U.value?V.value=v.value:V.value=JSON.stringify(v.value,null,2)},P=()=>{B.value=!1},oe=()=>{const x=C=>{l.value.option.dataset=C};Ie({message:"是否保存编辑后的数据？",onPositiveCallback:()=>{try{let C=V.value;if(U.value||(C=JSON.parse(C)),typeof C!=typeof v.value)Ie({message:"当前数据类型与原类型不相同, 是否强制应用数据?",onPositiveCallback:()=>{try{x(C),V.value="",window.$message.success("保存成功"),P()}catch(q){window.$message.error("内容应用错误, 请检查格式是否正确")}}});else try{x(C),V.value="",window.$message.success("保存成功"),P()}catch(q){window.$message.error("内容应用错误, 请检查格式是否正确")}}catch(C){console.log(C),window.$message.error("内容应用错误, 请检查格式是否正确")}}})},W=(x,C=!1)=>{var q,ee;x&&((ee=(q=l==null?void 0:l.value)==null?void 0:q.chartConfig)==null?void 0:ee.chartFrame)===ze.ECHARTS?(v.value=x,u.value&&(F.value=x.dimensionsMapping||x.dimensions,l.value.mapping=L(C))):x!=null?(l.value.mapping=[],v.value=x):(R.value=!0,v.value="此组件无数据源"),Ut(x)&&(l.value.mapping=[])};Xe(()=>{var x,C;return(C=(x=l.value)==null?void 0:x.option)==null?void 0:C.dataset},x=>{W(x)},{immediate:!0});const K={targetData:l,chartEditStore:t,props:N,tableTitle:T,HelpOutlineIcon:w,DocumentTextIcon:h,RefreshIcon:S,DocumentAddIcon:k,DocumentDownloadIcon:z,EditIcon:j,source:v,dimensions:F,noData:R,showRef:B,editorCode:V,uploadFileListRef:O,customRequest:_,beforeUpload:r,download:s,filterShow:y,isCharts:u,onMoveCallback:b,fnIsitArequest:E,matchingHandle:p,dimensionsAndSourceHandle:L,fetchTargetData:I,chartKeyIsHtml:U,openOnlineEditHandle:Q,closeOlineEditHandle:P,saveOlineEditHandle:oe,getMappingFn:W,get Draggable(){return Gt},get TimelineTitleEnum(){return Jt},get ChartDataMonacoEditor(){return jn},MonacoEditor:nt,get VueJsonPretty(){return it}};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}}),Hn={class:"ghost-list-td"},Rn={class:"ghost-list-td ghost-list-nth"},Mn=["title"],Pn={class:"go-ellipsis-1",style:{"user-select":"text","max-width":"100px"}},zn={key:0,class:"go-flex-no-wrap go-flex-center ghost-list-td-content"},Un={key:1,class:"go-flex-no-wrap go-flex-center ghost-list-td-content"},qn={class:"go-flex-items-center"};function Gn(n,e,l,t,N,T){const w=D("n-text"),h=D("n-space"),S=D("n-timeline-item"),k=D("n-icon"),z=D("n-input"),j=D("n-badge"),v=D("n-checkbox"),F=D("n-table"),R=D("n-button"),B=D("n-tooltip"),V=D("n-upload"),O=D("n-card"),_=D("n-timeline"),r=D("n-divider"),s=D("n-tag"),y=D("n-modal");return M(),$(ce,null,[o(_,{class:"go-chart-configurations-timeline",size:"medium"},{default:a(()=>[Fe(o(S,{color:"#97846c",title:t.TimelineTitleEnum.FILTER},{default:a(()=>[o(h,{size:10,vertical:""},{default:a(()=>[o(w,{depth:"3",style:{"font-size":"13px"}},{default:a(()=>e[5]||(e[5]=[d("过滤器默认处理接口返回值的「data」字段")])),_:1}),o(t.ChartDataMonacoEditor)]),_:1})]),_:1},8,["title"]),[[_e,t.filterShow]]),Fe(o(S,{color:"#97846c",title:t.TimelineTitleEnum.MAPPING},{default:a(()=>[o(k,{class:"refresh-icon",onClick:e[0]||(e[0]=u=>{var b,E;return t.getMappingFn((E=(b=t.targetData)==null?void 0:b.option)==null?void 0:E.dataset,!0)})},{default:a(()=>[o(t.RefreshIcon)]),_:1}),o(F,{striped:""},{default:a(()=>[m("thead",Hn,[(M(),$(ce,null,et(t.tableTitle,u=>m("div",{class:"thead",key:u},te(u),1)),64))]),o(t.Draggable,{"item-key":"mapping",modelValue:t.targetData.mapping,"onUpdate:modelValue":e[1]||(e[1]=u=>t.targetData.mapping=u),class:"ghost",onChange:t.onMoveCallback},{item:a(({element:u,index:b})=>[m("div",Rn,[m("div",{title:u.mapping},[m("span",Pn,te(u.mapping),1)],8,Mn),m("div",null,[o(z,{value:u.mappingValue,"onUpdate:value":E=>u.mappingValue=E,style:{width:"90px",height:"30px"},size:"small",type:"text",placeholder:"映射名称",onBlur:t.fetchTargetData},null,8,["value","onUpdate:value"])]),m("div",null,[u.result===0?(M(),$("div",zn,[o(j,{dot:"",type:"success"}),o(w,null,{default:a(()=>e[6]||(e[6]=[d("无")])),_:1})])):(M(),$("div",Un,[o(j,{dot:"",type:u.result===1?"success":"error"},null,8,["type"]),b===0?(M(),X(w,{key:0},{default:a(()=>e[7]||(e[7]=[d(" 图表分类 ")])),_:1})):(M(),X(v,{key:1,size:"small",checked:u.display,"onUpdate:checked":E=>u.display=E,onClick:t.fetchTargetData,label:u.result===1?"成功":"失败"},null,8,["checked","onUpdate:checked","label"]))]))])])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title"]),[[_e,t.isCharts&&t.targetData&&t.targetData.mapping.length>0]]),o(S,{type:"success",title:t.TimelineTitleEnum.CONTENT},{default:a(()=>[o(h,{vertical:"",size:2},{default:a(()=>[o(h,{class:"source-btn-box",size:8},{default:a(()=>[o(R,{class:"sourceBtn-item",disabled:t.noData,onClick:t.openOnlineEditHandle},{icon:a(()=>[o(k,null,{default:a(()=>[o(t.EditIcon)]),_:1})]),default:a(()=>[e[8]||(e[8]=d(" 编辑 "))]),_:1},8,["disabled"]),o(V,{"file-list":t.uploadFileListRef,"onUpdate:fileList":e[2]||(e[2]=u=>t.uploadFileListRef=u),"show-file-list":!1,customRequest:t.customRequest,onBeforeUpload:t.beforeUpload,accept:"application/json, text/plain"},{default:a(()=>[o(h,null,{default:a(()=>[o(B,{"show-arrow":!1,trigger:"hover"},{trigger:a(()=>[Fe(o(R,{class:"sourceBtn-item",disabled:t.noData},{icon:a(()=>[o(k,null,{default:a(()=>[o(t.DocumentAddIcon)]),_:1})]),default:a(()=>[e[9]||(e[9]=d(" 导入 "))]),_:1},8,["disabled"]),[[_e,!l.ajax]])]),default:a(()=>[e[10]||(e[10]=d(" 支持导入 json / txt 格式文件 "))]),_:1})]),_:1})]),_:1},8,["file-list","customRequest","onBeforeUpload"]),m("div",null,[o(R,{class:"sourceBtn-item",disabled:t.noData,onClick:t.download},{icon:a(()=>[o(k,null,{default:a(()=>[o(t.DocumentDownloadIcon)]),_:1})]),default:a(()=>[e[11]||(e[11]=d(" 下载 "))]),_:1},8,["disabled","onClick"]),o(B,{trigger:"hover"},{trigger:a(()=>[o(k,{class:"go-ml-1",size:"21",depth:3},{default:a(()=>[o(t.HelpOutlineIcon)]),_:1})]),default:a(()=>[e[12]||(e[12]=m("span",null,"点击【下载】查看完整数据",-1))]),_:1})])]),_:1}),o(O,{class:"go-mt-3",size:"small"},{default:a(()=>[o(t.VueJsonPretty,{data:t.source,showIcon:!0,showLength:!0,showLineNumber:!0,showDoubleQuotes:!1,virtual:!0},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1}),o(y,{class:"go-online-edit go-background-filter",title:"组件数据在线编辑 — "+t.targetData.chartConfig.title,preset:"card",size:"small",style:{width:"800px"},show:t.showRef,"onUpdate:show":e[4]||(e[4]=u=>t.showRef=u),"transform-origin":"center","mask-closable":!1,bordered:!0,onAfterLeave:t.closeOlineEditHandle,"content-style":"padding: 0;"},{action:a(()=>[o(h,{justify:"space-between"},{default:a(()=>[m("div",qn,[o(s,{bordered:!1,type:"primary",style:{"border-radius":"5px"}},{icon:a(()=>[o(k,{component:t.DocumentTextIcon},null,8,["component"])]),default:a(()=>[e[13]||(e[13]=d(" 说明 "))]),_:1}),o(h,{"wrap-item":!1,vertical:""},{default:a(()=>[o(w,{class:"go-ml-2",depth:"3",style:{"font-size":"1"}},{default:a(()=>[e[16]||(e[16]=d(" 1. 格式化代码： ")),o(s,{bordered:!1,type:"warning",style:{"font-size":"12px"}},{default:a(()=>e[14]||(e[14]=[d("( shift + alt + f ) ")])),_:1}),o(r,{vertical:""}),o(s,{bordered:!1,type:"warning",style:{"font-size":"12px"}},{default:a(()=>e[15]||(e[15]=[d("右键 -> Format Document")])),_:1})]),_:1}),o(w,{class:"go-ml-2",depth:"3",style:{"font-size":"1","text-align":"left"}},{default:a(()=>e[17]||(e[17]=[d(" 2. 字符串需要用英文双引号包裹，否则会报错 ")])),_:1})]),_:1})]),o(h,null,{default:a(()=>[o(R,{class:"go-px-4",focusable:!1,onClick:t.closeOlineEditHandle},{default:a(()=>e[18]||(e[18]=[d("取消")])),_:1}),o(R,{class:"go-px-4",type:"primary",onClick:t.saveOlineEditHandle},{default:a(()=>e[19]||(e[19]=[d(" 保存 ")])),_:1})]),_:1})]),_:1})]),default:a(()=>[o(r,{style:{margin:"4px 0 10px"}}),o(t.MonacoEditor,{modelValue:t.editorCode,"onUpdate:modelValue":e[3]||(e[3]=u=>t.editorCode=u),height:"70vh",language:t.chartKeyIsHtml?"html":"json"},null,8,["modelValue","language"])]),_:1},8,["title","show"])],64)}const io=$e(Ln,[["render",Gn],["__scopeId","data-v-bd24e592"],["__file","index.vue"]]);export{io as C};
