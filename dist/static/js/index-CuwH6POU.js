var pe=Object.defineProperty,ge=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var re=(q,t,l)=>t in q?pe(q,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):q[t]=l,Q=(q,t)=>{for(var l in t||(t={}))ve.call(t,l)&&re(q,l,t[l]);if(de)for(var l of de(t))qe.call(t,l)&&re(q,l,t[l]);return q},W=(q,t)=>ge(q,ye(t));import{d as U,r as w,A as X,_ as j,U as s,t as I,o as c,w as a,c as h,s as n,q as p,X as D,a5 as ce,e as L,ac as me,aI as K,V as M,F as N,n as le,z as ae,Y as k,H as De,f0 as O,fo as te,fp as ne,e_ as be,aa as Pe,K as H,cS as ue,fs as he,b8 as J,aw as _e,D as Ce,E as ie,fh as Ee,fl as Ie,fm as we}from"./index-DzJUk-4s.js";import{i as Z}from"./icon-Bt2TghsQ.js";import{Y as Se,Z as fe,aF as Re}from"./index-B2h3DCGB.js";import{A as Be}from"./index-BBNnqqCS.js";import{c as se}from"./index-DkV0_qOD.js";import{g as oe}from"./plugin-BZaVEG5Y.js";import"./index-DnNrz6w_.js";import"./index-DumZb7Zp.js";import{R as xe,a as Te,C as Fe}from"./index-BX2lGo2a.js";import"./querySelectorAll-CWDd-9ax.js";import{C as Ae}from"./index-BkUKjMxU.js";import{u as ke}from"./systemStore-CDAOEx2u.js";import"./file-BoGdIhh5.js";import"./index-YIaHLc6Z.js";import"./fileTypeEnum-22QBGXO_.js";import"./noImage-C1O4zUTD.js";import"./index.d-J2-cmQid.js";import"./correct-mOxEQCJ-.js";import"./chart_default-Cv54ZmSo.js";import"./noFile-CJNz9t2r.js";import"./useSync.hook-CykodbHN.js";import"./listen-BenKfQqv.js";import"./driver.js-DincbcBx.js";import"./drawRemote-BVHvBcY1.js";import"./index-BWD_u572.js";import"./indexDBStore-BkJ2w0ZQ.js";/* empty css                                                              */import"./error-DU3-BFcz.js";import"./index-BCTmwJrR.js";/* empty css               */import"./GoUserAvatar-BBITl89l.js";import"./points-Bi1H5gtF.js";import"./index-CYCNU51b.js";import"./svip-tip-BogTL7q_.js";import"./doc-Br7GyA9J.js";import"./DataBaseAIChat-Dq68Jh7Q.js";import"./logo-Bd1KfhDG.js";/* empty css                                                                          */const Oe=U({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(q,{expose:t,emit:l}){t();const e=q,g=l,P=w(),o=w(),r=w(!1);X(()=>e.modelShow,m=>{r.value=m});const v={props:e,emit:g,pondName:P,inputInstRef:o,modelShowRef:r,closeHandle:()=>{g("update:modelShow",!1)},closeAndSendHandle:()=>{var m,_;if(!((m=e.targetDataRequest)!=null&&m.dataPondName)){window.$message.warning("请在左下角输入名称！"),(_=o.value)==null||_.focus();return}oe({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{g("update:modelShow",!1),g("editSaveHandle",e.targetDataRequest)}})},get RequestGlobalConfig(){return Te},get RequestTargetConfig(){return xe}};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),He={class:"go-pr-3"},Ne={key:1},Ue={key:1};function je(q,t,l,e,g,P){const o=s("n-space"),r=s("n-scrollbar"),u=s("n-tag"),i=s("n-input"),v=s("n-button"),m=s("n-card"),_=s("n-modal");return c(),I(_,{class:"go-chart-data-request",show:e.modelShowRef,"onUpdate:show":t[1]||(t[1]=d=>e.modelShowRef=d),"mask-closable":!1,closeOnEsc:!1},{default:a(()=>[e.modelShowRef?(c(),I(m,{key:0,bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:a(()=>t[2]||(t[2]=[])),"header-extra":a(()=>t[3]||(t[3]=[])),action:a(()=>[n(o,{justify:"space-between"},{default:a(()=>[l.targetDataRequest?(c(),I(o,{key:0},{default:a(()=>[n(u,{bordered:!1,type:"primary"},{default:a(()=>t[4]||(t[4]=[D("名称：")])),_:1}),n(i,{value:l.targetDataRequest.dataPondName,"onUpdate:value":t[0]||(t[0]=d=>l.targetDataRequest.dataPondName=d),ref:"inputInstRef",type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(c(),h("span",Ne)),n(o,null,{default:a(()=>[n(v,{onClick:e.closeHandle},{default:a(()=>t[5]||(t[5]=[D("取消")])),_:1}),n(v,{type:"primary",onClick:e.closeAndSendHandle},{default:a(()=>t[6]||(t[6]=[D("保存")])),_:1})]),_:1})]),_:1})]),default:a(()=>[n(r,{style:{"max-height":"718px"}},{default:a(()=>[p("div",He,[n(o,{vertical:""},{default:a(()=>{var d;return[n(e.RequestGlobalConfig),n(e.RequestTargetConfig,{"target-data-request":(d=l.targetDataRequest)==null?void 0:d.dataPondRequestConfig},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})):(c(),h("div",Ue))]),_:1},8,["show"])}const ze=j(Oe,[["render",je],["__scopeId","data-v-0dcba7a6"],["__file","pondIndex.vue"]]),Ge=U({__name:"index",emits:["createPond","deletePond"],setup(q,{expose:t,emit:l}){t(),ce(E=>({"06403472":m.value}));const e=l,{DuplicateOutlineIcon:g,TrashIcon:P}=Z.ionicons5,o=me(),{chartEditStore:r,targetData:u}=se(),{requestDataPond:i}=K(r.getRequestGlobalConfig),v=L(()=>u.value.request.requestDataPondId),m=L(()=>o.getAppTheme),f={emit:e,DuplicateOutlineIcon:g,TrashIcon:P,designStore:o,chartEditStore:r,targetData:u,requestDataPond:i,selectPondId:v,themeColor:m,createPond:()=>{e("createPond",!0)},deletePond:(E,b)=>{E.stopPropagation(),E.preventDefault(),e("deletePond",b)},clickHandle:E=>{u.value.request.requestDataPondId=E.dataPondId}};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),Le={class:"go-chart-data-pond-list"},Me={class:"pond-item-box"},Ve=["onClick"],Ye={class:"item-content"},Qe={class:"item-content-body"},We=["onClick"];function Xe(q,t,l,e,g,P){const o=s("n-timeline-item"),r=s("n-timeline"),u=s("n-icon"),i=s("n-button"),v=s("n-divider"),m=s("n-a"),_=s("n-text"),d=s("n-space"),C=s("n-tag"),f=s("n-ellipsis"),E=s("n-scrollbar");return c(),h("div",Le,[n(r,{class:"pond-item-timeline",style:{width:"20px"}},{default:a(()=>[n(o,{type:"info"}),n(o,{type:"success"})]),_:1}),p("div",Me,[n(i,{class:"create-btn go-py-4",ghost:"",onClick:e.createPond},{icon:a(()=>[n(u,null,{default:a(()=>[n(e.DuplicateOutlineIcon)]),_:1})]),default:a(()=>[t[0]||(t[0]=p("span",null," 创建 ",-1))]),_:1}),n(v,{style:{margin:"10px 0"}}),e.requestDataPond.length?M("",!0):(c(),I(d,{key:0,justify:"center"},{default:a(()=>[n(_,{class:"not-layer-text",depth:3},{default:a(()=>[t[2]||(t[2]=D(" 暂无数据内容， ")),n(m,{onClick:e.createPond},{default:a(()=>t[1]||(t[1]=[D("立即创建")])),_:1})]),_:1})]),_:1})),n(E,{style:{"max-height":"490px"}},{default:a(()=>[(c(!0),h(N,null,le(e.requestDataPond,b=>(c(),h("div",{key:b.dataPondId,class:ae([{select:b.dataPondId===e.selectPondId},"pond-item"]),onClick:T=>e.clickHandle(b)},[p("div",Ye,[p("div",Qe,[p("div",null,[n(C,{class:"go-mr-1",type:b.dataPondId===e.selectPondId?"warning":"",bordered:!1},{default:a(()=>t[3]||(t[3]=[D(" 名称 ")])),_:2},1032,["type"]),n(f,{style:{"max-width":"180px"}},{default:a(()=>[D(k(b.dataPondName||"暂无"),1)]),_:2},1024)]),p("div",null,[n(C,{class:"go-mr-1",type:b.dataPondId===e.selectPondId?"warning":"",bordered:!1},{default:a(()=>t[4]||(t[4]=[D(" 地址 ")])),_:2},1032,["type"]),n(f,{style:{"max-width":"180px"}},{default:a(()=>[D(k(b.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),p("div",{class:"item-content-icon go-transition-quick",onClick:T=>e.deletePond(T,b)},[n(u,null,{default:a(()=>[n(e.TrashIcon)]),_:1})],8,We)]),p("div",{class:ae({"select-modal":b.dataPondId===e.selectPondId})},null,2)],10,Ve))),128))]),_:1})])])}const Je=j(Ge,[["render",Xe],["__scopeId","data-v-ad7def3d"],["__file","index.vue"]]),Ke=U({__name:"displayTable",props:{target:Object},setup(q,{expose:t}){t();const l=q,e={key:"",value:""},g=De({content:[]});X(()=>l.target,o=>{g.content=[];for(const r in o)g.content.push({key:r,value:o[r]});g.content.length||(g.content=[JSON.parse(JSON.stringify(e))])},{immediate:!0,deep:!0});const P={props:l,defaultItem:e,tableArray:g};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}});function Ze(q,t,l,e,g,P){const o=s("n-table");return c(),I(o,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:a(()=>[t[0]||(t[0]=p("thead",null,[p("tr",null,[p("th",null,"key"),p("th",null,"value")])],-1)),p("tbody",null,[(c(!0),h(N,null,le(e.tableArray.content,(r,u)=>(c(),h("tr",{key:u},[p("td",null,k(r.key||"暂无"),1),p("td",null,k(r.value||"暂无"),1)]))),128))])]),_:1})}const $e=j(Ke,[["render",Ze],["__file","displayTable.vue"]]),et=U({__name:"index",props:{globalData:Object,targetData:Object},setup(q,{expose:t}){t();const l=q,{HelpOutlineIcon:e,FlashIcon:g,PulseIcon:P}=Z.ionicons5,{requestUrl:o,requestInterval:r,requestHttpType:u,requestContentType:i,requestSQLContent:v,requestParams:m,requestParamsBodyType:_,requestIntervalUnit:d}=K(l.targetData.dataPondRequestConfig),C=[O.HEADER],f={[te.DEFAULT]:"普通请求",[te.SQL]:"SQL 请求"},E=w(O.PARAMS),F={props:l,HelpOutlineIcon:e,FlashIcon:g,PulseIcon:P,requestUrl:o,requestInterval:r,requestHttpType:u,requestContentType:i,requestSQLContent:v,requestParams:m,requestParamsBodyType:_,requestIntervalUnit:d,tabs:C,requestContentTypeObj:f,tabValue:E,updateRequestParams:A=>{E.value!==O.BODY&&(m.value[E.value]=A)},updateRequestBodyTable:A=>{E.value===O.BODY&&(_.value===ne.FORM_DATA||_.value===ne.X_WWW_FORM_URLENCODED)&&(m.value[O.BODY][_.value]=A)},SettingItemBox:fe,SettingItem:Se,displayTable:$e,get RequestBodyEnum(){return ne},get RequestParamsTypeEnum(){return O},get SelectHttpTimeNameObj(){return be},get RequestContentTypeEnum(){return te}};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),tt={class:"go-chart-data-display"},nt={class:"go-mr-3"},at={key:0},ot={class:"go-mt-3"},lt={key:0},st={key:1},dt={key:1},rt={style:{width:"500px","overflow-x":"auto"}};function ut(q,t,l,e,g,P){const o=s("n-input"),r=s("n-icon"),u=s("n-divider"),i=s("n-tab"),v=s("n-tabs"),m=s("n-text"),_=s("n-card"),d=s("n-code"),C=s("n-scrollbar");return c(),h("div",tt,[n(C,{style:{"max-height":"570px"}},{default:a(()=>[p("div",nt,[p("div",null,[n(e.SettingItemBox,{name:"主体信息"},{default:a(()=>[n(e.SettingItem,{name:"接口名称"},{default:a(()=>{var f;return[n(o,{size:"small",placeholder:((f=l.targetData)==null?void 0:f.dataPondName)||"暂无",disabled:!0},null,8,["placeholder"])]}),_:1}),n(e.SettingItem,{name:"接口类型"},{default:a(()=>[n(o,{size:"small",placeholder:e.requestHttpType||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),n(e.SettingItemBox,null,{default:a(()=>[n(e.SettingItem,{name:"组件间隔"},{default:a(()=>[n(o,{size:"small",placeholder:`${e.requestInterval||"暂无"}`,disabled:!0},{suffix:a(()=>[D(k(l.targetData&&e.SelectHttpTimeNameObj[e.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1}),n(e.SettingItem,{name:"全局间隔（默认）"},{default:a(()=>{var f;return[n(o,{size:"small",placeholder:`${((f=l.globalData)==null?void 0:f.requestInterval)||"暂无"}`,disabled:!0},{suffix:a(()=>[D(k(l.globalData&&e.SelectHttpTimeNameObj[l.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]}),_:1})]),_:1}),n(e.SettingItemBox,{name:"源地址",alone:!0},{default:a(()=>{var f;return[n(o,{size:"small",placeholder:((f=l.globalData)==null?void 0:f.requestOriginUrl)||"暂无",disabled:!0},{prefix:a(()=>[n(r,{component:e.PulseIcon},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),n(e.SettingItemBox,{name:"接口地址",alone:!0},{default:a(()=>[n(o,{size:"small",placeholder:e.requestUrl||"暂无",disabled:!0},{prefix:a(()=>[n(r,{component:e.FlashIcon},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),n(u),n(e.SettingItemBox,{name:"类型"},{default:a(()=>[n(e.SettingItem,{name:"配置类型"},{default:a(()=>[n(o,{size:"small",placeholder:l.targetData&&e.requestContentTypeObj[e.requestContentType],disabled:!0},null,8,["placeholder"])]),_:1}),e.requestContentType===e.RequestContentTypeEnum.DEFAULT?(c(),I(e.SettingItem,{key:0,name:"body 类型"},{default:a(()=>[n(o,{size:"small",placeholder:l.targetData&&e.requestParamsBodyType,disabled:!0},null,8,["placeholder"])]),_:1})):M("",!0)]),_:1}),e.requestContentType===e.RequestContentTypeEnum.DEFAULT?(c(),h("div",at,[n(v,{type:"line",animated:"",value:e.tabValue,"onUpdate:value":t[0]||(t[0]=f=>e.tabValue=f)},{default:a(()=>[(c(!0),h(N,null,le(e.RequestParamsTypeEnum,f=>(c(),I(i,{key:f,name:f,tab:f},{default:a(()=>[D(k(f),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),p("div",ot,[e.tabValue!==e.RequestParamsTypeEnum.BODY?(c(),h("div",lt,[n(e.displayTable,{class:"go-my-3",target:e.requestParams[e.tabValue]},null,8,["target"])])):(c(),h("div",st,[e.requestParamsBodyType===e.RequestBodyEnum.NONE?(c(),I(_,{key:0,class:"go-mt-3 go-pb-3"},{default:a(()=>[n(m,{depth:"3"},{default:a(()=>t[1]||(t[1]=[D("该接口没有 Body 体")])),_:1})]),_:1})):e.requestParamsBodyType===e.RequestBodyEnum.FORM_DATA||e.requestParamsBodyType===e.RequestBodyEnum.X_WWW_FORM_URLENCODED?(c(),I(e.displayTable,{key:1,class:"go-my-3",target:e.requestParams[e.RequestParamsTypeEnum.BODY][e.requestParamsBodyType]},null,8,["target"])):e.requestParamsBodyType===e.RequestBodyEnum.JSON?(c(),I(_,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:a(()=>[n(d,{code:e.requestParams[e.RequestParamsTypeEnum.BODY][e.requestParamsBodyType]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):e.requestParamsBodyType===e.RequestBodyEnum.XML?(c(),I(d,{key:3,code:e.requestParams[e.RequestParamsTypeEnum.BODY][e.requestParamsBodyType]||"",language:"html"},null,8,["code"])):M("",!0)]))])])):(c(),h("div",dt,[n(e.SettingItemBox,{name:"键名"},{default:a(()=>[n(m,null,{default:a(()=>t[2]||(t[2]=[D("sql")])),_:1})]),_:1}),n(e.SettingItemBox,{name:"键值"},{default:a(()=>[p("div",rt,[n(d,{code:e.requestSQLContent.sql||"",language:"sql",style:{}},null,8,["code"])])]),_:1})]))])]),_:1})])}const it=j(et,[["render",ut],["__scopeId","data-v-e2a46621"],["__file","index.vue"]]),ct=U({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(q,{expose:t,emit:l}){t();const e=q,g=l,{PencilIcon:P}=Z.ionicons5,{chartEditStore:o,targetData:r}=se(),{requestDataPond:u}=K(o.getRequestGlobalConfig),i=w(!1),v=w(!1),m=w(!1),_=w(!1),d=w(),C=L(()=>{var S,G;const y=(G=(S=r==null?void 0:r.value)==null?void 0:S.request)==null?void 0:G.requestDataPondId;return y?u.value.filter(R=>y===R.dataPondId)[0]:void 0});X(()=>e.modelShow,y=>{v.value=y}),X(()=>C.value,y=>{m.value=!0,d.value=y,_e(()=>{m.value=!1})},{immediate:!0});const f=(y=!1)=>{_.value=!!y,i.value=!0},E=()=>{const y=Pe();d.value={dataPondId:y,dataPondName:y,dataPondRequestConfig:H.cloneDeep(W(Q({},he),{requestDataType:ue.Pond}))},f()},b=y=>{_.value?T(y):F(y),_.value=!1,i.value=!1},T=y=>{try{const x=u.value.findIndex(S=>S.dataPondId===y.dataPondId);x!==-1?(u.value.splice(x,1,y),o.getComponentList.forEach(S=>{S.request.requestDataType===ue.Pond&&S.request.requestDataPondId===y.dataPondId&&(S.request=W(Q({},J(y.dataPondRequestConfig)),{requestDataPondId:y.dataPondId}))}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch(x){window.$message.error("编辑失败，请稍后重试！")}},F=y=>{try{d.value?(u.value.unshift(y),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch(x){window.$message.error("创建失败，请稍后重试!")}},V={props:e,emit:g,PencilIcon:P,chartEditStore:o,targetData:r,requestDataPond:u,requestShow:i,modelShowRef:v,loading:m,isEdit:_,editData:d,pondData:C,openPond:f,createPond:E,saveHandle:b,editSaveHandle:T,createSaveHandle:F,deletePond:y=>{oe({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const x=u.value.findIndex(S=>S.dataPondId===y.dataPondId);x!==-1?(u.value.splice(x,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},closeHandle:()=>{oe({message:"确定不保存当前的请求配置？",onPositiveCallback:async()=>{try{g("update:modelShow",!1),window.oldRequestGlobalConfig&&o.getRequestGlobalConfig&&(o.getRequestGlobalConfig.requestDataPond=window.oldRequestGlobalConfig.requestDataPond),window.oldTargetData&&r&&(r.value.request=window.oldTargetData.request)}catch(y){window.$message.error("取消失败, 请稍后重试!")}}})},closeAndSave:()=>{C.value&&(r.value.request=W(Q({},J(C.value.dataPondRequestConfig)),{requestDataPondId:C.value.dataPondId})),g("update:modelShow",!1)},get noData(){return Re},get ChartDataPondList(){return Je},get PondDataRequest(){return ze},get ChartDataDisplay(){return it}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),mt={class:"pond-content"},_t={key:1,class:"no-data go-flex-center"},ft=["src"];function pt(q,t,l,e,g,P){const o=s("n-text"),r=s("n-icon"),u=s("n-button"),i=s("n-space"),v=s("n-card"),m=s("n-modal");return c(),h(N,null,[n(m,{class:"go-chart-data-pond-control",show:e.modelShowRef,"onUpdate:show":t[1]||(t[1]=_=>e.modelShowRef=_),"mask-closable":!1},{default:a(()=>[n(v,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:a(()=>t[3]||(t[3]=[])),"header-extra":a(()=>t[4]||(t[4]=[])),action:a(()=>[n(i,{justify:"space-between"},{default:a(()=>[n(u,{type:"info",secondary:"",disabled:!e.pondData,onClick:t[0]||(t[0]=_=>e.openPond(!0))},{icon:a(()=>[n(r,null,{default:a(()=>[n(e.PencilIcon)]),_:1})]),default:a(()=>[t[6]||(t[6]=D(" 编辑内容 "))]),_:1},8,["disabled"]),n(i,null,{default:a(()=>[n(u,{onClick:e.closeHandle},{default:a(()=>t[7]||(t[7]=[D("取消")])),_:1}),n(u,{type:"primary",onClick:e.closeAndSave},{default:a(()=>t[8]||(t[8]=[D("应用配置")])),_:1})]),_:1})]),_:1})]),default:a(()=>[p("div",mt,[e.pondData&&!e.loading?(c(),I(e.ChartDataDisplay,{key:0,targetData:e.pondData,globalData:e.chartEditStore.getRequestGlobalConfig},null,8,["targetData","globalData"])):(c(),h("div",_t,[p("img",{src:e.noData,alt:"暂无数据"},null,8,ft),n(o,{depth:3},{default:a(()=>t[5]||(t[5]=[D("暂未选择公共接口")])),_:1})])),n(e.ChartDataPondList,{onCreatePond:e.createPond,onDeletePond:e.deletePond})])]),_:1})]),_:1},8,["show"]),n(e.PondDataRequest,{modelShow:e.requestShow,"onUpdate:modelShow":t[2]||(t[2]=_=>e.requestShow=_),targetDataRequest:e.editData,isEdit:e.isEdit,onEditSaveHandle:e.saveHandle},null,8,["modelShow","targetDataRequest","isEdit"])],64)}const gt=j(ct,[["render",pt],["__scopeId","data-v-31dac500"],["__file","index.vue"]]),yt=U({__name:"index",setup(q,{expose:t}){t(),ce(R=>({"049cfdef":$.value}));const l=1,e=w(window.__PRIVATE_MODULE__.CloseOpenAI),g=me(),{HelpOutlineIcon:P,FlashIcon:o,PulseIcon:r,FishIcon:u}=Z.ionicons5,{targetData:i,chartEditStore:v}=se(),m=Ce(),_=ke();let d=null;const{requestDataPond:C,requestInterval:f,requestIntervalUnit:E}=K(v.getRequestGlobalConfig),b=w(!1),T=w(!1),F=w(!1),A=w(!1),z=L(()=>{const R=i.value.request.requestDataPondId;return R?C.value.filter(Y=>R===Y.dataPondId)[0]:void 0}),$=L(()=>g.getAppTheme),V=()=>{var R;d=H.cloneDeep((R=z.value)==null?void 0:R.dataPondRequestConfig),window.oldRequestGlobalConfig=H.cloneDeep(v.getRequestGlobalConfig),window.oldTargetData=H.cloneDeep(i.value),A.value=!0},y=()=>{_e(()=>{z.value&&d&&(z.value.dataPondRequestConfig=d)})},x=()=>{T.value=!0,window.oldRequestGlobalConfig=H.cloneDeep(v.getRequestGlobalConfig),window.oldTargetData=H.cloneDeep(i.value)},S=async()=>{var ee,Y;if(!((ee=i.value)!=null&&ee.request)){window.$message.warning("请选择一个公共接口！");return}b.value=!0;const R=setTimeout(()=>{b.value=!1},1e4);try{const B=await Ee(J(i.value.request),J(v.getRequestGlobalConfig));if(clearTimeout(R),b.value=!1,B){if(!(B!=null&&B.data)&&!i.value.filter&&!((Y=i.value.filterConfig)!=null&&Y.selectList[0].globalFilterId)){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),F.value=!0;return}i.value.option.dataset=Ie(B==null?void 0:B.data,B,i.value.id,i.value.mapping,we(i.value)),F.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(B){console.error(B),b.value=!1,window.$message.warning(B||"数据异常，请检查！")}};m.off(ie.CHART_EDIT_TRIGGER_FILTER_SEND_POND_REQUEST),m.on(ie.CHART_EDIT_TRIGGER_FILTER_SEND_POND_REQUEST,S);const G={buildType:l,CloseOpenAI:e,designStore:g,HelpOutlineIcon:P,FlashIcon:o,PulseIcon:r,FishIcon:u,targetData:i,chartEditStore:v,eventBus:m,systemStore:_,get dataPondRequestConfig(){return d},set dataPondRequestConfig(R){d=R},requestDataPond:C,GlobalRequestInterval:f,GlobalRequestIntervalUnit:E,loading:b,controlModel:T,showMatching:F,dataBaseAIShow:A,pondData:z,themeColor:$,openAiHandle:V,aiCancelHandle:y,controlModelHandle:x,sendHandle:S,SettingItemBox:fe,AIBtn:Be,get ChartDataPondControl(){return gt},ChartDataAnalyzeDataBaseByAI:Fe,get ChartDataMatchingAndShow(){return Ae}};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),vt={class:"go-chart-data-pond"},qt={class:"go-absolute-center"};function Dt(q,t,l,e,g,P){const o=s("n-icon"),r=s("n-input"),u=s("n-button"),i=s("n-card"),v=s("n-tooltip"),m=s("n-flex"),_=s("go-skeleton");return c(),h(N,null,[p("div",vt,[n(i,{class:"n-card-shallow"},{default:a(()=>[n(e.SettingItemBox,{name:"请求名称",alone:!0},{default:a(()=>{var d;return[n(r,{size:"small",placeholder:((d=e.pondData)==null?void 0:d.dataPondName)||"暂无",disabled:!0},{prefix:a(()=>[n(o,{component:e.FishIcon},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),n(e.SettingItemBox,{name:"接口地址",alone:!0},{default:a(()=>{var d;return[n(r,{size:"small",placeholder:((d=e.pondData)==null?void 0:d.dataPondRequestConfig.requestUrl)||"暂无",disabled:!0},{prefix:a(()=>[n(o,{component:e.FlashIcon},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),p("div",{class:"edit-text",onClick:e.controlModelHandle},[p("div",qt,[n(u,{type:"primary",secondary:""},{default:a(()=>t[2]||(t[2]=[D("编辑配置")])),_:1})])])]),_:1})]),n(m,{class:"go-my-2 go-pr-2",justify:"space-between"},{default:a(()=>[n(m,{align:"center",size:0},{default:a(()=>[t[4]||(t[4]=D(" 说明 ")),n(v,{trigger:"hover"},{trigger:a(()=>[n(o,{size:"21",depth:3},{default:a(()=>[n(e.HelpOutlineIcon)]),_:1})]),default:a(()=>[t[3]||(t[3]=p("div",null,[p("div",null,"默认读取 data 字段"),p("pre",null,`建议返回数据格式:{
  "code": 0,
  "data": {},
    ...
}`)],-1))]),_:1})]),_:1}),e.CloseOpenAI?M("",!0):(c(),h(N,{key:0},[e.systemStore.getMembershipInfo.model?(c(),I(e.AIBtn,{key:0,title:"AI 一键解析",disabled:!e.pondData,tooltip:e.pondData?"通过语言描述，AI 一键生成 SQL 语句":"请先选择公共接口",onClick:e.openAiHandle},null,8,["disabled","tooltip"])):(c(),I(e.AIBtn,{key:1,disabled:!0,title:"AI 一键解析",tooltip:"请配置 OpenAI"}))],64)),n(u,{class:ae({"btn-full":e.CloseOpenAI}),type:"primary",ghost:"",onClick:e.sendHandle},{icon:a(()=>[n(o,null,{default:a(()=>[n(e.FlashIcon)]),_:1})]),default:a(()=>[t[5]||(t[5]=D(" 发送请求 "))]),_:1},8,["class"])]),_:1}),n(e.ChartDataMatchingAndShow,{show:e.showMatching&&!e.loading,ajax:!0},null,8,["show"]),n(_,{load:e.loading,repeat:3},null,8,["load"]),n(e.ChartDataPondControl,{modelShow:e.controlModel,"onUpdate:modelShow":t[0]||(t[0]=d=>e.controlModel=d),onSendHandle:e.sendHandle},null,8,["modelShow"]),e.pondData?(c(),I(e.ChartDataAnalyzeDataBaseByAI,{key:0,modalShow:e.dataBaseAIShow,"onUpdate:modalShow":t[1]||(t[1]=d=>e.dataBaseAIShow=d),targetData:e.targetData,request:e.pondData.dataPondRequestConfig,onCancel:e.aiCancelHandle},null,8,["modalShow","targetData","request"])):M("",!0)],64)}const sn=j(yt,[["render",Dt],["__scopeId","data-v-cc6dd324"],["__file","index.vue"]]);export{sn as default};
