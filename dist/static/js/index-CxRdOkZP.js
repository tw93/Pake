var Ce=Object.defineProperty;var ue=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var de=(T,t,m)=>t in T?Ce(T,t,{enumerable:!0,configurable:!0,writable:!0,value:m}):T[t]=m,pe=(T,t)=>{for(var m in t||(t={}))Ee.call(t,m)&&de(T,m,t[m]);if(ue)for(var m of ue(t))be.call(t,m)&&de(T,m,t[m]);return T};import{B as ke,f as ye,d as we,u as xe,a as Se,h as Z,b as Te,C as Oe}from"./index-DkV0_qOD.js";import{d as me,r as f,R as q,b8 as De,_ as ve,U as y,c as E,o as g,s as o,w as a,q as _,X as P,F as $,n as se,t as W,z as le,W as ee,Y as ie,$ as ge,ci as Fe,D as Ae,E as oe,ae as Le,bm as _e,bi as Re,b3 as Ue,bu as Ie,P as ae,b6 as Be,V as N}from"./index-DzJUk-4s.js";import{g as X,a as He,b as Me,l as fe}from"./plugin-BZaVEG5Y.js";import{i as re}from"./icon-Bt2TghsQ.js";import{u as Pe,E as ze}from"./index-B2h3DCGB.js";import{u as Ve}from"./systemStore-CDAOEx2u.js";import{_ as he}from"./correct-mOxEQCJ-.js";import"./index-YIaHLc6Z.js";import"./querySelectorAll-CWDd-9ax.js";import"./file-BoGdIhh5.js";import"./fileTypeEnum-22QBGXO_.js";import"./noImage-C1O4zUTD.js";import"./index.d-J2-cmQid.js";import"./index-DumZb7Zp.js";import"./chart_default-Cv54ZmSo.js";import"./noFile-CJNz9t2r.js";import"./useSync.hook-CykodbHN.js";import"./listen-BenKfQqv.js";import"./driver.js-DincbcBx.js";import"./drawRemote-BVHvBcY1.js";import"./index-BWD_u572.js";import"./indexDBStore-BkJ2w0ZQ.js";/* empty css                                                              */import"./error-DU3-BFcz.js";import"./index-BCTmwJrR.js";/* empty css               */import"./GoUserAvatar-BBITl89l.js";import"./points-Bi1H5gtF.js";import"./index-CYCNU51b.js";import"./svip-tip-BogTL7q_.js";import"./doc-Br7GyA9J.js";const ne="全部",Ne=me({__name:"editIndex",props:{categoryOptions:{type:Array,default:()=>[]}},setup(T,{expose:t}){const m=T,{CloseIcon:e,AddIcon:z}=re.ionicons5,I=window.__PRIVATE_MODULE__.ResourceCategoryList,v=f(!0),V=f(!1),O=f(null),h=f({}),b=f([]),w=[{label:"修改分类",key:"updateCategory",icon:"EditIcon",type:"primary"},{label:"删除",key:"delete",icon:"TrashIcon",type:"error"}],c=f([]),A=f([]);let d={};const D=f(!1),s=f(!1),k=f([]),i=f(""),B=f(""),F=f(""),J=f([]),K=["背景","图标","装饰"];let H={[I[0]]:K};const L=f([]),Q=()=>{var l,x;if(V.value=!0,d={},H={[I[0]]:K},!((l=m.categoryOptions)!=null&&l.length)){v.value=!1;return}if(c.value=(x=m.categoryOptions)==null?void 0:x.map(C=>{const U=[];C.item.forEach(S=>{S.key!==ne&&U.push(S.key)}),H[C.key]=U;const j=C.item.map(S=>({label:S.label,key:C.key+S.key,category:C.key,tags:S.key}));return{label:C.label,key:C.key,children:j||[]}}),c.value.forEach(C=>{C.children=C.children.filter(U=>U.tags!==ne)}),"children"in c.value[0]&&(c.value[0].key&&(b.value=[c.value[0].key]),c.value[0].children)){const{key:C,category:U,tags:j,label:S}=c.value[0].children[0];O.value=C,G(C,U,j),h.value={key:C,item:{key:C,label:S,category:U,tags:j}}}},G=async(l,x,C)=>{var U,j;if(d[l]&&d[l].length){A.value=d[l];return}v.value=!0;try{const S=await ye({type:"public",tags:C,category:x,page:1,pageSize:99999});S.code===q.SUCCESS?(d[l]=(U=S.data)==null?void 0:U.data,A.value=(j=S.data)==null?void 0:j.data,setTimeout(()=>{v.value=!1},300)):v.value=!1}catch(S){v.value=!1}},te=l=>{h.value=De(l),G(l.key,l.item.category,l.item.tags)},Y=async()=>{(await we({ids:k.value})).code===q.SUCCESS&&(window.$message.info("删除成功"),d={},G(h.value.key,h.value.item.category,h.value.item.tags))},n=async l=>{k.value=l.selectList,l.type==="delete"?X({message:"确定要删除选中的内容吗?",onPositiveCallback:()=>{X({message:"此操作会影响所有用户，请二次确认是否删除",onPositiveCallback:()=>{Y()}})}}):l.type==="updateCategory"&&(J.value=c.value.map(x=>x.label),s.value=!0)},u=l=>{B.value=l,l==="素材"?L.value=Array.from(new Set([...K,...H[l]])):L.value=H[l]},r=()=>{if(!F.value){window.$message.warning("请输入类型！");return}if(L.value.findIndex(x=>x===F.value)===-1){const x=JSON.parse(JSON.stringify(L.value));x.push(F.value),L.value=x,H[B.value].push(F.value),window.$message.success("添加成功！"),F.value="",i.value=L.value[L.value.length-1]}else window.$message.error("已有现成类型！")},p=l=>{i.value=l},R=async()=>{if(!B.value||!i.value){window.$message.error("请选择分类！");return}X({message:"确定要修改选中的内容吗?",onPositiveCallback:async()=>{X({message:"此操作会影响所有用户，请二次确认是否修改",onPositiveCallback:async()=>{D.value=!0,(await xe({data:k.value.map(x=>({id:Number(x),category:B.value,tags:i.value}))})).code===q.SUCCESS?(window.$message.success("保存成功！"),d={},G(h.value.key,h.value.item.category,h.value.item.tags),D.value=!1,s.value=!1):D.value=!1}})}})};t({editHandle:Q});const ce={props:m,CloseIcon:e,AddIcon:z,ResourceCategoryList:I,allText:ne,fetchLoading:v,editModelShow:V,defaultValue:O,activeValue:h,defaultExpandedKeys:b,editToolsOptions:w,editMenuOption:c,infoList:A,get menuOptions(){return d},set menuOptions(l){d=l},saveLoading:D,categoryModelShow:s,selectIdList:k,selectType:i,selectCategoryType:B,typeInput:F,categoryType:J,defaultType:K,get allTags(){return H},set allTags(l){H=l},typeList:L,editHandle:Q,changeCategoryHandle:G,changeMenuHandle:te,deleteDataHandle:Y,toolsClickEmitHandle:n,selectCategoryContent:u,addType:r,selectContent:p,saveHandle:R,BatchSelectEditDialog:ke};return Object.defineProperty(ce,"__isScriptSetup",{enumerable:!1,value:!0}),ce}}),Ge={class:"category-box",style:{"min-height":"200px"}},je={class:"select-type-box"},Ke={src:he,alt:""},We={class:"select-type-box go-mt-5"},qe={src:he,alt:""},Je={class:"bottom"};function Ye(T,t,m,e,z,I){const v=y("n-icon"),V=y("n-flex"),O=y("n-divider"),h=y("n-text"),b=y("n-ellipsis"),w=y("n-card"),c=y("n-space"),A=y("n-input"),d=y("n-button"),D=y("n-input-group"),s=y("n-popover"),k=y("n-modal");return g(),E($,null,[o(e.BatchSelectEditDialog,{modalShow:e.editModelShow,"onUpdate:modalShow":t[0]||(t[0]=i=>e.editModelShow=i),dialogTitle:"编辑资源库",message:"暂无数据，请右键点击大屏中图表上传到资源库",toolsOptions:e.editToolsOptions,defaultValue:e.defaultValue,menuOptions:e.editMenuOption,dataList:e.infoList,defaultExpandedKeys:e.defaultExpandedKeys,fetchLoading:e.fetchLoading,onToolsClick:e.toolsClickEmitHandle,onChangeMenu:e.changeMenuHandle},null,8,["modalShow","defaultValue","menuOptions","dataList","defaultExpandedKeys","fetchLoading"]),o(k,{class:"go-handle-category go-background-filter",show:e.categoryModelShow,"onUpdate:show":t[4]||(t[4]=i=>e.categoryModelShow=i),size:"small","transform-origin":"center"},{default:a(()=>[o(w,{style:{width:"700px"},"content-style":"padding: 0;",size:"small",bordered:!1,role:"dialog","aria-modal":"true"},{header:a(()=>[o(V,{justify:"space-between"},{default:a(()=>[t[5]||(t[5]=_("div",{class:"go-mb-0"},"修改分类",-1)),o(v,{size:"20",class:"go-cursor-pointer",onClick:t[1]||(t[1]=i=>e.categoryModelShow=!1)},{default:a(()=>[o(e.CloseIcon)]),_:1})]),_:1})]),action:a(()=>[_("div",Je,[o(d,{type:"primary",secondary:"",onClick:t[3]||(t[3]=i=>e.categoryModelShow=!1)},{default:a(()=>t[9]||(t[9]=[P(" 取消 ")])),_:1}),o(d,{class:"go-ml-3",type:"primary",loading:e.saveLoading,onClick:e.saveHandle},{default:a(()=>[o(h,{depth:"2"},{default:a(()=>t[10]||(t[10]=[P("保存")])),_:1})]),_:1},8,["loading"])])]),default:a(()=>[o(O,{style:{margin:"0"}}),_("div",Ge,[_("div",je,[o(h,{class:"title go-mr-3"},{default:a(()=>t[6]||(t[6]=[P("一级分类")])),_:1}),o(c,{class:"go-mt-1"},{default:a(()=>[(g(!0),E($,null,se(e.categoryType,i=>(g(),W(w,{class:le(["pay-time-btn category",{active:i===e.selectCategoryType}]),size:"small",key:i,"content-style":"padding: 10px;",onClick:B=>e.selectCategoryContent(i)},{default:a(()=>[o(b,{style:{"max-width":"80px"}},{default:a(()=>[P(ie(i),1)]),_:2},1024),ee(_("img",Ke,null,512),[[ge,i===e.selectCategoryType]])]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_("div",We,[o(h,{class:"title go-mr-3"},{default:a(()=>t[7]||(t[7]=[P("二级分类")])),_:1}),o(c,{class:"go-mt-1"},{default:a(()=>[o(s,{trigger:"click"},{trigger:a(()=>[o(w,{class:"pay-time-btn add",size:"small","content-style":"padding: 10px 15px;"},{default:a(()=>[o(v,null,{default:a(()=>[o(e.AddIcon)]),_:1})]),_:1})]),default:a(()=>[_("div",null,[o(D,null,{default:a(()=>[o(A,{value:e.typeInput,"onUpdate:value":t[2]||(t[2]=i=>e.typeInput=i),valueModifiers:{trim:!0},placeholder:"不要超过3个字 (本次有效)"},null,8,["value"]),o(d,{ghost:"",type:"primary",onClick:e.addType},{default:a(()=>t[8]||(t[8]=[P("确认")])),_:1})]),_:1})])]),_:1}),(g(!0),E($,null,se(e.typeList,i=>(g(),W(w,{class:le(["pay-time-btn",{active:i===e.selectType}]),size:"small",key:i,"content-style":"padding: 10px;",onClick:B=>e.selectContent(i)},{default:a(()=>[o(b,{style:{"max-width":"80px"}},{default:a(()=>[P(ie(i),1)]),_:2},1024),ee(_("img",qe,null,512),[[ge,i===e.selectType]])]),_:2},1032,["class","onClick"]))),128))]),_:1})])])]),_:1})]),_:1},8,["show"])],64)}const Xe=ve(Ne,[["render",Ye],["__scopeId","data-v-717d7bd7"],["__file","editIndex.vue"]]),M="全部",Qe=me({__name:"index",setup(T,{expose:t}){t();const m=f();let e={};const z=Pe(),I=Ve(),v=Ae(),{TrashIcon:V,RefreshIcon:O}=re.ionicons5,{EditIcon:h}=re.carbon,b=f([]),w=f([]),c=f("素材"),A=f(null),d=f([]),D=n=>/\.(png|jpe?g|gif|svg|webp|ico)(\?.*)?$/.test(n),s=n=>/\.(mp4)(\?.*)?$/.test(n),k=n=>/\.(webm)(\?.*)?$/.test(n),i=async n=>{var r;if(w.value=((r=b.value.find(p=>p.key===n))==null?void 0:r.item)||[],A.value=w.value[0].key,e[n]&&e[n].length){d.value=e[n][M];return}const u=await ye({type:"public",category:n,page:1,pageSize:99999});if(u.code===q.SUCCESS){const p={[M]:[]};u.data.data.forEach(R=>{p[R.tags]||(p[R.tags]=[]),p[R.tags].push(R),p[M].push(R)}),e[n]=p,d.value=e[n][M]}},B=n=>{d.value=e[c.value][n]},F=async()=>{const n=await Se({type:"public"});n.code===q.SUCCESS&&n.data&&n.data.length>0&&(b.value=n.data.map(u=>{var r;return{key:u.label,label:u.label,item:[{key:M,label:M},...(r=u.children)==null?void 0:r.map(p=>({key:p,label:p}))]}}),c.value=b.value[0].key,w.value=b.value[0].item,i(c.value))},J=()=>{e={},F()},K=async(n,u)=>{var p;if(u.disabled)return;const r=await _e(u);r.isGroup?(p=r.groupList)==null||p.forEach(R=>{Z(R.chartConfig,R)}):Z(r.chartConfig,r),n.dataTransfer.setData(Re.DRAG_KEY,Ue({id:u.id,key:u.id,chartKey:ae.GROUP_TEMPLATES,conKey:ae.GROUP_TEMPLATES,category:u.tags,categoryName:u.tags,package:ae.GROUP_TEMPLATES,chartFrame:Ie.GROUP_TEMPLATE,title:u.projectName,image:u.thumbnail,content:u.content}))},H=async n=>{var u;if(!n.disabled)try{He();let r=null;r=await _e(n),r.attr.x=0,r.attr.y=0,r.isGroup?(u=r.groupList)==null||u.forEach(async p=>{await Z(p.chartConfig,p)}):await Z(r.chartConfig,r),r?(z.addComponentList(r,!1,!0),z.setTargetSelectChart(r.id),Me()):fe()}catch(r){console.log(r),fe(),window.$message.warning("图表正在研发中, 敬请期待...")}},L=()=>{z.setEditCanvas(ze.IS_CREATE,!1)},Q=n=>{I.isRootUser&&v.emit(oe.CHART_EDIT_UPLOAD_RESOURCE_OPEN,pe({},n))},G=n=>{I.isRootUser&&X({message:`是否删除【${n==null?void 0:n.projectName}】收藏？`,transformOrigin:"center",onPositiveCallback:async()=>{const u=await Te({type:"public",id:n.id});if(u.code=q.SUCCESS){window.$message.success("删除成功");const r=d.value.findIndex(p=>p.id===n.id);r!==-1&&d.value.splice(r,1),e[c.value][M]=e[c.value][M].filter(p=>p.id!==n.id)}}})},te=()=>{m.value.editHandle()};Fe(()=>{F()}),v.on(oe.CHART_EDIT_UPLOAD_RESOURCE_UPDATE,(n=!0)=>{n?(J(),F()):(e[c.value]=[],i(c.value))}),Le(()=>{v.off(oe.CHART_EDIT_UPLOAD_RESOURCE_UPDATE)});const Y={EditIndexRef:m,allText:M,get menuOptions(){return e},set menuOptions(n){e=n},chartEditStore:z,systemStore:I,eventBus:v,TrashIcon:V,RefreshIcon:O,EditIcon:h,categoryOptions:b,tagsOptions:w,selectCategoryValue:c,selectTagsValue:A,infoList:d,isImage:D,isMp4:s,isWebm:k,changeCategoryHandle:i,changeTagsHandle:B,fetchAllTypeList:F,refreshHandle:J,dragStartHandle:K,dblclickHandle:H,dragendHandle:L,updateTemplateHandle:Q,deleteHandle:G,editHandle:te,get ContentBox(){return Oe},EditIndex:Xe};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}}),Ze={class:"menu-width-box"},$e={class:"menu-width-layout"},et={key:0,class:"menu-bottom"},tt={class:"menu-component-box"},ot={key:0,class:"go-p-2"},at={key:1,class:"chart-content-list"},nt=["onDragstart","onDragend","onDblclick"],st={class:"list-center"},lt={key:0,class:"list-img",alt:"图表图片"},it={key:1,autoplay:"",loop:"",muted:"",class:"list-img"},rt=["src"],ct=["src"],ut={class:"go-flex-center",style:{width:"250px",height:"210px"}},dt={key:0,class:"list-img-popover",alt:"图表图片",style:{"max-width":"250px","max-height":"210px","border-radius":"6px"}},pt={key:1,class:"list-img-popover",autoplay:"",loop:"",muted:""},gt=["src"],_t=["src"],ft={class:"list-tools go-transition"},yt={class:"go-flex-items-center"};function mt(T,t,m,e,z,I){const v=y("n-icon"),V=y("n-text"),O=y("n-button"),h=y("n-menu"),b=y("n-popover"),w=y("n-empty"),c=y("n-tooltip"),A=y("n-divider"),d=y("n-scrollbar"),D=Be("lazy");return g(),W(e.ContentBox,{class:le(["go-content-resource",{isManage:e.systemStore.isRootUser}]),title:"资源库",depth:1,backIcon:!1},{"top-right":a(()=>[e.systemStore.isRootUser?(g(),W(O,{key:0,size:"small",quaternary:"",onClick:e.editHandle},{default:a(()=>[o(v,{size:"14"},{default:a(()=>[o(e.EditIcon)]),_:1}),e.systemStore.isRootUser?(g(),W(V,{key:0,class:"go-fs-13 go-ml-1",depth:"3"},{default:a(()=>t[2]||(t[2]=[P("编辑")])),_:1})):N("",!0)]),_:1})):N("",!0)]),default:a(()=>[_("aside",null,[_("div",Ze,[_("div",$e,[o(h,{class:"menu-width",value:e.selectCategoryValue,"onUpdate:value":[t[0]||(t[0]=s=>e.selectCategoryValue=s),e.changeCategoryHandle],options:e.categoryOptions,collapsed:!1,"icon-size":16},null,8,["value","options"]),e.systemStore.isRootUser?(g(),E("div",et,[o(b,{trigger:"hover","show-arrow":!1,placement:"top"},{trigger:a(()=>[o(O,{quaternary:"",size:"small",focusable:!1,onClick:e.refreshHandle},{icon:a(()=>[o(v,null,{default:a(()=>[o(e.RefreshIcon)]),_:1})]),_:1})]),default:a(()=>[t[3]||(t[3]=_("div",null,"更新资源库数据",-1))]),_:1})])):N("",!0)]),_("div",tt,[o(h,{class:"chart-menu-width",value:e.selectTagsValue,"onUpdate:value":[t[1]||(t[1]=s=>e.selectTagsValue=s),e.changeTagsHandle],options:e.tagsOptions,collapsed:!1,"icon-size":16},null,8,["value","options"]),o(d,{trigger:"none"},{default:a(()=>[e.tagsOptions.length?(g(),E("div",at,[(g(!0),E($,null,se(e.infoList,s=>(g(),E("div",{class:"item-box",key:s.id,draggable:"",onDragstart:k=>!s.disabled&&e.dragStartHandle(k,s),onDragend:k=>!s.disabled&&e.dragendHandle(),onDblclick:k=>e.dblclickHandle(s)},[t[4]||(t[4]=_("div",{class:"list-header"},[_("div",{class:"btn-box super-mini"},[_("div",{class:"btn close"}),_("div",{class:"btn remove"}),_("div",{class:"btn resize"})])],-1)),o(c,{placement:"bottom","show-arrow":!1,trigger:"hover"},{trigger:a(()=>[o(b,{class:"go-background-filter",trigger:"hover",placement:"right",delay:1500},{trigger:a(()=>[_("div",st,[e.isImage(s.thumbnail)?ee((g(),E("img",lt,null,512)),[[D,s.thumbnail]]):(g(),E("video",it,[e.isWebm(s.thumbnail)?(g(),E("source",{key:0,src:s.thumbnail,type:"video/webm"},null,8,rt)):N("",!0),e.isMp4(s.thumbnail)?(g(),E("source",{key:1,src:s.thumbnail,type:"video/mp4"},null,8,ct)):N("",!0)]))])]),default:a(()=>[_("div",ut,[e.isImage(s.thumbnail)?ee((g(),E("img",dt,null,512)),[[D,s.thumbnail]]):(g(),E("video",pt,[e.isWebm(s.thumbnail)?(g(),E("source",{key:0,src:s.thumbnail,type:"video/webm"},null,8,gt)):N("",!0),e.isMp4(s.thumbnail)?(g(),E("source",{key:1,src:s.thumbnail,type:"video/mp4"},null,8,_t)):N("",!0)]))])]),_:2},1024)]),default:a(()=>[P(" "+ie(s.projectName),1)]),_:2},1024),_("div",ft,[_("div",yt,[o(O,{text:"",type:"error",color:"#ffffff",onClick:k=>e.deleteHandle(s)},{icon:a(()=>[o(v,null,{default:a(()=>[o(e.TrashIcon)]),_:1})]),_:2},1032,["onClick"]),o(A,{vertical:"",style:{"margin-left":"0"}}),o(O,{text:"",type:"default",color:"#ffffff",onClick:k=>e.updateTemplateHandle(s)},{icon:a(()=>[o(v,null,{default:a(()=>[o(e.EditIcon)]),_:1})]),_:2},1032,["onClick"])])])],40,nt))),128))])):(g(),E("div",ot,[o(w,{description:e.systemStore.isRootUser?"请通过右键点击图表组件，上传到资源库":"请联系管理员添加素材"},null,8,["description"])]))]),_:1})])])]),e.systemStore.isRootUser?(g(),W(e.EditIndex,{key:0,ref:"EditIndexRef",categoryOptions:e.categoryOptions},null,8,["categoryOptions"])):N("",!0)]),_:1},8,["class"])}const Xt=ve(Qe,[["render",mt],["__scopeId","data-v-94a0f8ba"],["__file","index.vue"]]);export{Xt as default};
