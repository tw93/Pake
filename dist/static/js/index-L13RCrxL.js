import{d as p,r as k,G as g,ae as I,_ as m,U as F,c as s,o as d,q as u,s as B,V as C,Y as E}from"./index-DzJUk-4s.js";import{a as h,j as x,i as y}from"./systemStore-CDAOEx2u.js";const D=p({__name:"index",setup(v,{expose:o}){o();const n=k({ticket:"",url:"",openId:""}),t=async()=>{const{data:e}=await h({scene_id_key:1000002});e!=null&&e.ticket&&(n.value.ticket=e.ticket,n.value.url=e.url)};let a;const l=async()=>{await t(),r(),clearInterval(a),a=setInterval(()=>{t()},1e3*60*5)};let i;const r=()=>{n.value.ticket&&x({ticket:n.value.ticket}).then(e=>{const{data:c}=e;c.state==="WAIT"&&(i=setTimeout(()=>{r()},1500)),c.state==="SUCCESS"&&c.id&&y({data:{openid:c.id}}).then(f=>{f.code===200&&window.$message.success("绑定成功！"),n.value.openId=c.id}),c.state==="FAIL"&&window.$message.warning("绑定失败，请联系管理员。")})};g(()=>{}),I(()=>{clearInterval(a),clearInterval(i)});const _={codeData:n,getWechatQrCodeService:t,get intervalId(){return a},set intervalId(e){a=e},initWeChartLogin:l,get intervalTicketId(){return i},set intervalTicketId(e){i=e},checkLoginByTicket:r};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}}),b={class:"login-content-box"},q={key:0,class:"go-flex-center qr-code-box"},w={class:"qr-border"},A={class:"login-content-qrcode-tips"},S={key:0};function T(v,o,n,t,a,l){const i=F("n-qr-code");return d(),s("div",b,[t.codeData.url?(d(),s("div",q,[u("div",w,[B(i,{value:t.codeData.url,size:180,padding:6,background:"#fff",color:"#041f2b","error-correction-level":"H"},null,8,["value"])])])):(d(),s("div",{key:1,class:"login-content-qrcode",onClickOnce:o[0]||(o[0]=r=>t.initWeChartLogin())}," 点击获取二维码 ",32)),u("div",A,[o[1]||(o[1]=u("div",null,"使用微信扫一扫，绑定微信账号登陆",-1)),t.codeData.openId?(d(),s("div",S,"微信号："+E(t.codeData.openId),1)):C("",!0)])])}const V=m(D,[["render",T],["__scopeId","data-v-f3799d71"],["__file","index.vue"]]);export{V as default};
