import{d as T,a5 as N,e as P,ac as V,r as y,K as Q,cS as te,A,_ as B,U as r,c as q,o as w,q as d,s as t,w as a,t as D,p as U,F as K,n as ae,z as X,X as m,Y as C,fo as F,aI as ne,D as oe,E as j,b2 as G,fh as se,b8 as M,fl as re,fm as le,e_ as ie,V as ue}from"./index-DzJUk-4s.js";import{i as Y}from"./icon-Bt2TghsQ.js";import{u as J,Y as de,Z as ce}from"./index-B2h3DCGB.js";import{A as me}from"./index-BBNnqqCS.js";import{R as _e,a as pe,C as ge}from"./index-BX2lGo2a.js";import{g as Z}from"./plugin-BZaVEG5Y.js";import{a as fe}from"./querySelectorAll-CWDd-9ax.js";import{c as he}from"./index-DkV0_qOD.js";import"./index-DnNrz6w_.js";import"./index-DumZb7Zp.js";import{C as we}from"./index-BkUKjMxU.js";import{u as Ce}from"./systemStore-CDAOEx2u.js";import"./file-BoGdIhh5.js";import"./index-YIaHLc6Z.js";import"./fileTypeEnum-22QBGXO_.js";import"./DataBaseAIChat-Dq68Jh7Q.js";import"./logo-Bd1KfhDG.js";/* empty css                                                              *//* empty css                                                                          */import"./GoUserAvatar-BBITl89l.js";import"./indexDBStore-BkJ2w0ZQ.js";import"./noImage-C1O4zUTD.js";import"./index.d-J2-cmQid.js";import"./correct-mOxEQCJ-.js";import"./chart_default-Cv54ZmSo.js";import"./noFile-CJNz9t2r.js";import"./useSync.hook-CykodbHN.js";import"./listen-BenKfQqv.js";import"./driver.js-DincbcBx.js";import"./drawRemote-BVHvBcY1.js";import"./index-BWD_u572.js";import"./error-DU3-BFcz.js";import"./index-BCTmwJrR.js";/* empty css               */import"./points-Bi1H5gtF.js";import"./index-CYCNU51b.js";import"./svip-tip-BogTL7q_.js";import"./doc-Br7GyA9J.js";const ve=T({__name:"index",setup(S,{expose:n}){n(),N(i=>({"585dedda":u.value}));const{ListIcon:p,ChevronBackIcon:e,ChevronForwardIcon:v}=Y.ionicons5,h=fe(),o=J(),l=V(),u=P(()=>l.getAppTheme),g=y(!0),c=y([]),_=Q.debounce(i=>{if(h.getPercentage<100&&h.getPercentage!==0)return[];const x=Object.values(i).filter(I=>I.request.requestDataType===te.AJAX);c.value=x},300);A(()=>o.getComponentListObject,i=>{_(i)},{immediate:!0,deep:!0});const s={ListIcon:p,ChevronBackIcon:e,ChevronForwardIcon:v,chartLayoutStore:h,chartEditStore:o,designStore:l,themeColor:u,isAsideShow:g,layerList:c,debounceFn:_,boxClickDownHandle:i=>{i&&i!==o.targetChart.selectId[0]&&Z({message:"切换组件会保存当前组件配置, 确定切换?",onPositiveCallback:async()=>{o.setTargetSelectChart(i),window.$message.success("切换组件成功!")}})}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),ye={class:"component-menus-aside-box"},be={class:"divider"},Se=["onClick"],De={class:"list-top"},xe={class:"list-item go-transition-quick"},qe={class:"list-item-left"},Ee=["title"],Ie=["title"];function Ae(S,n,p,e,v,h){const o=r("n-divider"),l=r("n-icon"),u=r("n-button"),g=r("n-tag"),c=r("n-text"),_=r("n-space"),f=r("n-scrollbar");return w(),q("aside",ye,[d("div",be,[t(o,{vertical:"",style:{height:"100%","min-height":"710px","margin-right":"0px"}}),t(u,{class:"aside-btn",size:"small",strong:"",secondary:"",circle:"",type:"tertiary",onClick:n[0]||(n[0]=s=>e.isAsideShow=!e.isAsideShow)},{icon:a(()=>[t(l,{size:"20"},{default:a(()=>[e.isAsideShow?(w(),D(e.ChevronForwardIcon,{key:0})):(w(),D(e.ChevronBackIcon,{key:1}))]),_:1})]),_:1})]),t(f,{style:{"max-height":"718px","padding-right":"15px"},trigger:"none"},{default:a(()=>[d("div",{class:"component-menus-box go-transition-quick",style:U({width:e.isAsideShow?"180px":"0px"})},[d("div",null,[t(g,{class:"go-transition-quick go-mb-2",type:"info",bordered:!1,style:U({borderRadius:"5px",width:e.isAsideShow?"120px":"0",overflow:"hidden"})},{default:a(()=>[n[1]||(n[1]=d("span",{style:{"line-height":"28px"}},"动态请求列表",-1)),t(l,{class:"go-ml-1",size:16,component:e.ListIcon,style:{position:"relative",top:"3px"}},null,8,["component"])]),_:1},8,["style"]),(w(!0),q(K,null,ae(e.layerList,(s,i)=>(w(),q("div",{key:i,class:X(["component-menus-box-item",{"component-menus-box-item-active":s.id===e.chartEditStore.targetChart.selectId[0]}]),onClick:E=>e.boxClickDownHandle(s.id)},[d("div",De,[t(c,{class:"title",depth:2},{default:a(()=>[m(C(s.chartConfig.title),1)]),_:2},1024)]),n[5]||(n[5]=d("div",{class:"divider-bg"},null,-1)),d("div",xe,[d("div",qe,[t(_,{wrap:!1,"wrap-item":!1,size:4,align:"center"},{default:a(()=>[t(c,{class:"text",depth:3},{default:a(()=>n[2]||(n[2]=[m(" ID ")])),_:1}),t(c,{depth:3,style:{"white-space":"nowrap"}},{default:a(()=>[m(C(s.id),1)]),_:2},1024)]),_:2},1024),t(_,{wrap:!1,"wrap-item":!1,size:4,align:"center"},{default:a(()=>[t(c,{class:"text",depth:3},{default:a(()=>n[3]||(n[3]=[m(" 类型 ")])),_:1}),t(u,{size:"tiny",strong:"",secondary:"",type:"tertiary"},{default:a(()=>[d("div",{class:"btn",title:s.request.requestHttpType},C(s.request.requestHttpType||"get"),9,Ee)]),_:2},1024)]),_:2},1024),t(_,{wrap:!1,"wrap-item":!1,size:4,align:"center"},{default:a(()=>[t(c,{class:"text",depth:3},{default:a(()=>n[4]||(n[4]=[m(" 地址 ")])),_:1}),t(u,{size:"tiny",strong:"",secondary:"",type:"tertiary"},{default:a(()=>[d("div",{class:"btn",title:s.request.requestUrl},C(s.request.requestUrl||"暂无"),9,Ie)]),_:2},1024)]),_:2},1024)])])],10,Se))),128))])],4)]),_:1})])}const Fe=B(ve,[["render",Ae],["__scopeId","data-v-2885b0e7"],["__file","index.vue"]]),Te=T({__name:"index",props:{modelShow:Boolean,targetData:Object,saveBtnText:String||null},emits:["update:modelShow","sendHandle"],setup(S,{expose:n,emit:p}){n();const e=S,v=p,h=y(!1),o={[F.DEFAULT]:"普通请求",[F.SQL]:"SQL 请求"};A(()=>e.modelShow,f=>{h.value=f},{immediate:!0});const l=J(),u=y(new Date().getTime());A(()=>l.targetChart.selectId,f=>{u.value=new Date().getTime(),window.oldTargetData=Q.cloneDeep(e.targetData)},{immediate:!1});const _={props:e,emit:v,modelShowRef:h,requestContentTypeObj:o,chartEditStore:l,currentKey:u,closeHandle:()=>{Z({message:"确定不保存当前的请求配置？",onPositiveCallback:async()=>{try{v("update:modelShow",!1),window.oldTargetData&&e.targetData&&(e.targetData.request=window.oldTargetData.request)}catch(f){window.$message.error("取消失败, 请稍后重试!")}}})},closeAndSendHandle:()=>{v("update:modelShow",!1)},get RequestGlobalConfig(){return pe},get RequestTargetConfig(){return _e},ComponentMenus:Fe};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}}),Be={class:"request-option-box"};function Re(S,n,p,e,v,h){const o=r("n-space"),l=r("n-scrollbar"),u=r("n-text"),g=r("n-tag"),c=r("n-button"),_=r("n-card"),f=r("n-modal");return w(),D(f,{class:"go-chart-data-request",show:e.modelShowRef,"onUpdate:show":n[0]||(n[0]=s=>e.modelShowRef=s),"mask-closable":!1,closeOnEsc:!1},{default:a(()=>[t(_,{bordered:!1,role:"dialog",size:"small",style:{width:"1150px",height:"800px"}},{header:a(()=>n[1]||(n[1]=[])),"header-extra":a(()=>n[2]||(n[2]=[])),action:a(()=>[t(o,{justify:"space-between"},{default:a(()=>[d("div",null,[t(u,null,{default:a(()=>{var s;return[m("「 "+C((s=p.targetData)==null?void 0:s.chartConfig.title)+" 」",1)]}),_:1}),t(u,null,{default:a(()=>n[3]||(n[3]=[m("—— ")])),_:1}),t(g,{type:"primary",bordered:!1,style:{"border-radius":"5px"}},{default:a(()=>[m(C(p.targetData?e.requestContentTypeObj[p.targetData.request.requestContentType]:e.requestContentTypeObj[0]),1)]),_:1})]),t(o,null,{default:a(()=>[t(c,{onClick:e.closeHandle},{default:a(()=>n[4]||(n[4]=[m(C("取消"))])),_:1}),t(c,{type:"primary",onClick:e.closeAndSendHandle},{default:a(()=>[m(C(p.saveBtnText||"应用配置"),1)]),_:1})]),_:1})]),_:1})]),default:a(()=>[d("div",Be,[t(o,{size:0,"wrap-item":!1},{default:a(()=>[t(l,{style:{flex:"1","max-height":"718px","padding-right":"15px"}},{default:a(()=>[(w(),D(o,{vertical:"",key:e.currentKey},{default:a(()=>{var s;return[t(e.RequestGlobalConfig),t(e.RequestTargetConfig,{"target-data-request":(s=p.targetData)==null?void 0:s.request},null,8,["target-data-request"])]}),_:1}))]),_:1}),t(e.ComponentMenus)]),_:1})])]),_:1})]),_:1},8,["show"])}const ke=B(Te,[["render",Re],["__scopeId","data-v-f1b6f970"],["__file","index.vue"]]),He=T({__name:"index",setup(S,{expose:n}){n(),N(O=>({"3d8c60b8":k.value}));const p=y(window.__PRIVATE_MODULE__.CloseOpenAI),{HelpOutlineIcon:e,FlashIcon:v,PulseIcon:h}=Y.ionicons5,{targetData:o,chartEditStore:l}=he(),u=Ce(),g=oe(),{requestOriginUrl:c,requestInterval:_,requestIntervalUnit:f}=ne(l.getRequestGlobalConfig),s=V(),i=y(!1),E=y(!1),x=y(!1),I=y(!1),W=()=>{E.value=!0,window.oldTargetData=G(o.value)},$=()=>{window.oldTargetData=G(o.value),I.value=!0},R=async()=>{var z,L;if(!((z=o.value)!=null&&z.request))return;i.value=!0;const O=setTimeout(()=>{i.value=!1},1e4);try{const b=await se(M(o.value.request),M(l.getRequestGlobalConfig));if(clearTimeout(O),i.value=!1,b){const{data:ee}=b;if(!ee&&!o.value.filter&&!((L=o.value.filterConfig)!=null&&L.selectList[0].globalFilterId)){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),x.value=!0;return}o.value.option.dataset=re(b==null?void 0:b.data,b,o.value.id,o.value.mapping,le(o.value)),x.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(b){console.error(b),i.value=!1,window.$message.warning("数据异常，请检查！")}},k=P(()=>s.getAppTheme);g.off(j.CHART_EDIT_TRIGGER_FILTER_SEND_REQUEST),g.on(j.CHART_EDIT_TRIGGER_FILTER_SEND_REQUEST,R);const H={CloseOpenAI:p,HelpOutlineIcon:e,FlashIcon:v,PulseIcon:h,targetData:o,chartEditStore:l,systemStore:u,eventBus:g,requestOriginUrl:c,GlobalRequestInterval:_,GlobalRequestIntervalUnit:f,designStore:s,loading:i,requestShow:E,showMatching:x,dataBaseAIShow:I,requestModelHandle:W,openAiHandle:$,sendHandle:R,themeColor:k,SettingItemBox:ce,SettingItem:de,AIBtn:me,get ChartDataRequest(){return ke},ChartDataAnalyzeDataBaseByAI:ge,get SelectHttpTimeNameObj(){return ie},get RequestContentTypeEnum(){return F},get ChartDataMatchingAndShow(){return we}};return Object.defineProperty(H,"__isScriptSetup",{enumerable:!1,value:!0}),H}}),Oe={class:"go-chart-configurations-data-ajax"},ze={class:"go-absolute-center"};function Le(S,n,p,e,v,h){const o=r("n-tag"),l=r("n-input"),u=r("n-icon"),g=r("n-button"),c=r("n-card"),_=r("n-tooltip"),f=r("n-flex"),s=r("go-skeleton");return w(),q("div",Oe,[t(c,{class:"n-card-shallow"},{default:a(()=>[t(e.SettingItemBox,{name:"请求配置"},{default:a(()=>[t(e.SettingItem,{name:"类型"},{default:a(()=>[t(o,{bordered:!1,type:"primary",style:{"border-radius":"5px"}},{default:a(()=>[m(C(e.targetData.request.requestContentType===e.RequestContentTypeEnum.DEFAULT?"普通请求":"SQL请求"),1)]),_:1})]),_:1}),t(e.SettingItem,{name:"方式"},{default:a(()=>[t(l,{size:"small",placeholder:e.targetData.request.requestHttpType||"暂无",disabled:!0},null,8,["placeholder"])]),_:1}),t(e.SettingItem,{name:"组件间隔"},{default:a(()=>[t(l,{size:"small",placeholder:`${e.targetData.request.requestInterval||"暂无"}`,disabled:!0},{suffix:a(()=>[m(C(e.SelectHttpTimeNameObj[e.targetData.request.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1}),t(e.SettingItem,{name:"全局间隔（默认）"},{default:a(()=>[t(l,{size:"small",placeholder:`${e.GlobalRequestInterval||"暂无"} `,disabled:!0},{suffix:a(()=>[m(C(e.SelectHttpTimeNameObj[e.GlobalRequestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1})]),_:1}),t(e.SettingItemBox,{name:"源地址",alone:!0},{default:a(()=>[t(l,{size:"small",placeholder:e.requestOriginUrl||"暂无",disabled:!0},{prefix:a(()=>[t(u,{component:e.PulseIcon},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),t(e.SettingItemBox,{name:"组件地址",alone:!0},{default:a(()=>[t(l,{size:"small",placeholder:e.targetData.request.requestUrl||"暂无",disabled:!0},{prefix:a(()=>[t(u,{component:e.FlashIcon},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),d("div",{class:"edit-text",onClick:e.requestModelHandle},[d("div",ze,[t(g,{type:"primary",secondary:""},{default:a(()=>n[2]||(n[2]=[m("编辑配置")])),_:1})])])]),_:1}),t(f,{class:"go-my-2 go-pr-2",justify:"space-between"},{default:a(()=>[t(f,{align:"center",size:0},{default:a(()=>[n[4]||(n[4]=m(" 说明 ")),t(_,{trigger:"hover"},{trigger:a(()=>[t(u,{size:"21",depth:3},{default:a(()=>[t(e.HelpOutlineIcon)]),_:1})]),default:a(()=>[n[3]||(n[3]=d("div",null,[d("div",null,"默认读取 data 字段"),d("pre",null,`建议返回数据格式:{
  "code": 0,
  "data": {},
    ...
}`)],-1))]),_:1})]),_:1}),e.CloseOpenAI?ue("",!0):(w(),q(K,{key:0},[e.systemStore.getMembershipInfo.model?(w(),D(e.AIBtn,{key:0,title:"AI 一键解析",tooltip:"通过语言描述，AI 一键生成 SQL 语句",onClick:e.openAiHandle})):(w(),D(e.AIBtn,{key:1,disabled:!0,title:"AI 一键解析",tooltip:"请配置 OpenAI"}))],64)),t(g,{class:X({"btn-full":e.CloseOpenAI}),type:"primary",ghost:"",onClick:e.sendHandle},{icon:a(()=>[t(u,null,{default:a(()=>[t(e.FlashIcon)]),_:1})]),default:a(()=>[n[5]||(n[5]=m(" 发送请求 "))]),_:1},8,["class"])]),_:1}),t(e.ChartDataMatchingAndShow,{show:e.showMatching&&!e.loading,ajax:!0},null,8,["show"]),t(s,{load:e.loading,repeat:3},null,8,["load"]),t(e.ChartDataRequest,{modelShow:e.requestShow,"onUpdate:modelShow":n[0]||(n[0]=i=>e.requestShow=i),targetData:e.targetData,onSendHandle:e.sendHandle},null,8,["modelShow","targetData"]),t(e.ChartDataAnalyzeDataBaseByAI,{modalShow:e.dataBaseAIShow,"onUpdate:modalShow":n[1]||(n[1]=i=>e.dataBaseAIShow=i),targetData:e.targetData,request:e.targetData.request},null,8,["modalShow","targetData","request"])])}const St=B(He,[["render",Le],["__scopeId","data-v-ed9adebb"],["__file","index.vue"]]);export{St as default};
