var X=Object.defineProperty,Y=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var L=(n,e,s)=>e in n?X(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s,j=(n,e)=>{for(var s in e||(e={}))Q.call(e,s)&&L(n,s,e[s]);if(P)for(var s of P(e))Z.call(e,s)&&L(n,s,e[s]);return n},H=(n,e)=>Y(n,J(e));import{d as R,r as C,A as $,R as D,an as K,bX as ee,_ as N,U as g,t as I,o as p,w as o,s as a,q as f,X as w,Y as A,e as te,ay as F,D as oe,cv as ne,E as ae,ai as se,bc as ie,c as x,F as V,n as re,V as le,f as de}from"./index-DzJUk-4s.js";import{n as O,o as ue,p as ce,l as me,q as _e}from"./team.api-Dw2fcOfS.js";import{g as fe}from"./plugin-BZaVEG5Y.js";import{i as G}from"./icon-Bt2TghsQ.js";import{u as z}from"./systemStore-CDAOEx2u.js";/* empty css                                                              *//* empty css                                                                          */import{G as pe}from"./GoUserAvatar-BBITl89l.js";import{d as ve}from"./index-YIaHLc6Z.js";var q=(n=>(n.EDIT="edit",n.DOWNLOAD="download",n.VIEW="view",n))(q||{});const ge=R({__name:"index",props:{modalShow:{required:!0,type:Boolean},getTeamInfo:{required:!0,type:Object}},emits:["update:modalShow"],setup(n,{expose:e,emit:s}){e();const t=s,l=n,{copy:y,isSupported:d}=ve(),{ChevronDownIcon:c,RefreshIcon:m}=G.ionicons5,S=C(!1),i=C(!0),b=C("view"),_=C(""),E={edit:"可编辑",download:"可下载",view:"可查看"},T=[{label:E.edit,key:"edit"},{label:E.download,key:"download"},{label:E.view,key:"view"}];$(()=>l.modalShow,r=>{S.value=r});const U=()=>{S.value=!1,t("update:modalShow",!1)},B=r=>{b.value=r},k=async()=>{const r=await O({teamId:l.getTeamInfo.id});if(r.code===D.SUCCESS){window.$message.success("重置成功"),l.getTeamInfo.invitationKey=r.data;const h=z();l.getTeamInfo.id===h.getTeamInfo.id&&(h.teamInfo.invitationKey=r.data)}},M=async()=>{let r=l.getTeamInfo.invitationKey;if(!r){const h=await O({teamId:l.getTeamInfo.id});if(h.code===D.SUCCESS)r=h.data;else{window.$message.error("生成链接失败，请联系管理员");return}}_.value=`${location.origin}/invite?invitationKey=${r}&invitationType=${K.TEAM}&desc=邀请你加入「${l.getTeamInfo.team_name}」空间`,d.value&&r?(await y(_.value),window.$message.success("复制成功")):(U(),window.$message.success("复制邀请链接成功"),setTimeout(()=>{ee(_.value)},500))},u=async()=>{let r=l.getTeamInfo.invitationKey;if(!r){const h=await O({teamId:l.getTeamInfo.id});if(h.code===D.SUCCESS)r=h.data;else{window.$message.error("生成链接失败，请联系管理员");return}}_.value=`${location.origin}/invite?invitationKey=${r}&invitationType=${K.TEAM}&desc=邀请你加入「${l.getTeamInfo.team_name}」空间`};u();const v={emit:t,props:l,AuthorityEnum:q,copy:y,isSupported:d,ChevronDownIcon:c,RefreshIcon:m,showRef:S,useInvite:i,authority:b,link:_,authorityConfigDesc:E,options:T,closeHandle:U,handleSelect:B,refreshHandle:k,copyHandle:M,initHandle:u};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),we={class:"content-box"},ye={class:"left-box"},Se={class:"left-box-text"};function he(n,e,s,t,l,y){const d=g("n-divider"),c=g("n-text"),m=g("n-icon"),S=g("n-button"),i=g("n-tooltip"),b=g("n-popconfirm"),_=g("n-space"),E=g("n-modal");return p(),I(E,{class:"go-move-scree-model go-background-filter",title:"邀请成员",preset:"card",size:"small",style:{width:"550px"},show:t.showRef,"onUpdate:show":e[0]||(e[0]=T=>t.showRef=T),"transform-origin":"center",bordered:!0,"content-style":"padding: 0 0 10px;",onAfterLeave:t.closeHandle},{default:o(()=>[a(d,{style:{"margin-top":"4px","margin-bottom":"0"}}),f("div",we,[t.useInvite?(p(),I(_,{key:0,align:"center"},{default:o(()=>[f("div",ye,[f("div",Se,[t.link?(p(),I(c,{key:0,class:"go-ellipsis-1",style:{height:"24px"}},{default:o(()=>[w(A(t.link),1)]),_:1})):(p(),I(c,{key:1},{default:o(()=>e[1]||(e[1]=[w(" 请重置邀请链接 ")])),_:1}))]),a(b,{placement:"bottom-end","show-arrow":!1,onPositiveClick:t.refreshHandle},{trigger:o(()=>[a(i,{trigger:"hover","show-arrow":!1},{trigger:o(()=>[a(S,{class:"refresh-btn",secondary:"",size:"small",style:{width:"30px"}},{default:o(()=>[a(m,{size:18},{default:o(()=>[a(t.RefreshIcon)]),_:1})]),_:1})]),default:o(()=>[e[2]||(e[2]=w(" 重置链接 "))]),_:1})]),default:o(()=>[e[3]||(e[3]=f("span",null,"重置后，旧链接将失效，无法通过旧链接加入空间。",-1))]),_:1})]),a(S,{class:"copy-btn",type:"primary",onClick:t.copyHandle},{default:o(()=>[a(c,{style:{"font-size":"13px"}},{default:o(()=>e[4]||(e[4]=[w(" 复制链接 ")])),_:1})]),_:1})]),_:1})):(p(),I(c,{key:1},{default:o(()=>e[5]||(e[5]=[w("任何人无法通过链接加入空间")])),_:1}))])]),_:1},8,["show"])}const Ie=N(ge,[["render",he],["__scopeId","data-v-b2a8b631"],["__file","index.vue"]]);var W=(n=>(n[n.MANAGE=1]="MANAGE",n.ITEM="",n[n.REMOVE=4]="REMOVE",n))(W||{});const be=R({__name:"member",props:{teamDetail:{type:Object,default:()=>({})}},setup(n,{expose:e}){e();const s=n,t=oe(),l=z(),{id:y}=l.getUserInfo,{AddIcon:d,ChevronDownIcon:c,TrashIcon:m}=G.ionicons5,S=C(!1),i=C([]),b=te(()=>y===s.teamDetail.createUserId),_={1:"管理员","":"成员",4:"移出空间"},E=[{label:_[1],key:1,desc:"支持大屏创建、发布、部署等所有操作权限"},{label:_[""],key:"",desc:"可添加为大屏的协作人员"},{type:"divider",key:"d1"},{key:4,label:()=>F("div",[F("span",{style:"color: #E55D5D; font-weight: 500"},_[4])])}],T=u=>{const v={key:4,label:()=>F("div",[F("span",{style:"color: #E55D5D; font-weight: 500"},"退出空间")])};return(u==null||u==="")&&(u=""),[{label:_[u],key:u,desc:"可作为大屏的协作人员"},{type:"divider",key:"d1"},v]},U=u=>{const{option:v,node:r}=u;return v.desc?F(ne,{keepAliveOnHover:!1,showArrow:!1,style:{width:"max-content"},placement:"right"},{trigger:()=>[r],default:()=>v.desc}):r},B=async(u,v,r)=>{if(u===4)fe({message:"退出空间后，成员将无法继续访问空间中任何资源，该成员所属资源将移交至空间中。",onPositiveCallback:async()=>{(await ue({teamId:s.teamDetail.id,team_member_id:v.id})).code===D.SUCCESS&&(window.$message.success("移除成功"),i.value.splice(r,1),b.value||(t.emit(ae.UPDATE_TEAM_LIST),await se.push({path:"/"}),window.location.reload()))}});else{if(String(y)===String(v.id))return;(await ce({team_id:s.teamDetail.id,user_id:v.id,user_role_status:u||null})).code===D.SUCCESS&&(window.$message.success("设置成功"),i.value[r].user_role_status=u)}},k=async()=>{const u=await me({teamId:s.teamDetail.id});if(u.code===D.SUCCESS){i.value=u.data.map(v=>H(j({},v.users),{user_role_status:v.user_role_status}));return}};k();const M={AuthorityEnum:W,props:s,eventBus:t,systemStore:l,userId:y,AddIcon:d,ChevronDownIcon:c,TrashIcon:m,modalShow:S,infoList:i,isCreate:b,authorityConfigDesc:_,options:E,optionsMember:T,renderOption:U,handleSelect:B,getTeamUserListInfo:k,get GoUserAvatar(){return pe},get TeamInviteMember(){return Ie},get NIcon(){return ie}};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}}),Ce={class:"go-team-member-box"},Ee={class:"top"},De={class:"content"},Te={class:"list title"},Fe={class:"left"},Ae={class:"center"},xe={class:"right"},Ue={class:"center"},ke={class:"right"},Me={key:0};function Be(n,e,s,t,l,y){const d=g("n-text"),c=g("n-button"),m=g("n-space"),S=g("n-dropdown");return p(),x(V,null,[f("div",Ce,[f("div",Ee,[a(m,{"wrap-item":!1,align:"center"},{default:o(()=>[e[3]||(e[3]=f("div",{class:"top-title"},"空间成员",-1)),a(c,{type:"primary",size:"small",focusable:!1,onClick:e[0]||(e[0]=i=>t.modalShow=!0)},{default:o(()=>[a(d,{class:"top-btn"},{default:o(()=>[a(t.NIcon,{size:14},{default:o(()=>[a(t.AddIcon)]),_:1})]),_:1}),a(d,{class:"top-btn"},{default:o(()=>e[2]||(e[2]=[w(" 邀请成员 ")])),_:1})]),_:1})]),_:1})]),f("div",De,[f("div",null,[f("div",Te,[f("div",Fe,[a(d,{depth:3},{default:o(()=>e[4]||(e[4]=[w("成员名称")])),_:1})]),f("div",Ae,[a(d,{depth:3},{default:o(()=>e[5]||(e[5]=[w("成员信息")])),_:1})]),f("div",xe,[a(d,{depth:3},{default:o(()=>e[6]||(e[6]=[w("成员权限（文件）")])),_:1})])]),(p(!0),x(V,null,re(t.infoList,(i,b)=>(p(),x("div",{class:"list users",key:i.id},[a(m,{align:"center",class:"left","wrap-item":!1,wrap:!1},{default:o(()=>[a(t.GoUserAvatar,{width:30,height:30,avatarUrl:i.avatar,style:{height:"30px"}},null,8,["avatarUrl"]),w(" "+A(i.nickname)+" ",1),String(t.userId)===String(i.id)?(p(),I(d,{key:0,depth:3},{default:o(()=>e[7]||(e[7]=[w("[我]")])),_:1})):le("",!0)]),_:2},1024),f("div",Ue,A(i.phone),1),f("div",ke,[String(s.teamDetail.createUserId)===String(i.id)?(p(),x("span",Me,"所有者")):t.isCreate||String(t.userId)===String(i.id)?(p(),I(m,{key:1,style:{width:"100%"}},{default:o(()=>[a(S,{trigger:"hover","render-option":t.renderOption,options:t.isCreate?t.options:t.optionsMember(i.user_role_status),onSelect:_=>t.handleSelect(_,i,b)},{default:o(()=>[a(m,{align:"center"},{default:o(()=>[a(d,null,{default:o(()=>[w(A(i.user_role_status?t.authorityConfigDesc[i.user_role_status]:t.authorityConfigDesc[t.AuthorityEnum.ITEM]),1)]),_:2},1024),a(t.NIcon,{style:{position:"relative",top:"2px"}},{default:o(()=>[a(t.ChevronDownIcon)]),_:1})]),_:2},1024)]),_:2},1032,["options","onSelect"])]),_:2},1024)):(p(),I(d,{key:2},{default:o(()=>[w(A(i.user_role_status?t.authorityConfigDesc[i.user_role_status]:t.authorityConfigDesc[t.AuthorityEnum.ITEM]),1)]),_:2},1024))])]))),128))])])]),a(t.TeamInviteMember,{modalShow:t.modalShow,"onUpdate:modalShow":e[1]||(e[1]=i=>t.modalShow=i),getTeamInfo:s.teamDetail},null,8,["modalShow","getTeamInfo"])],64)}const Oe=N(be,[["render",Be],["__scopeId","data-v-e37c6f7a"],["__file","member.vue"]]),Re=R({__name:"memberProject",setup(n,{expose:e}){e();const s=C(window.__PRIVATE_MODULE__.CreateTeamUpgrade),t=C(!0),l=C({createUserId:"",team_name:"...",team_charts_limit:0,chartCount:0,teamUserCount:0,team_number_limit:0,end_date:new Date}),y=de(),d=async()=>{try{const m=await _e({teamId:y});if(setTimeout(()=>{t.value=!1},200),!m||m.code!==D.SUCCESS)return;l.value=m.data}catch(m){}};d();const c={isPrivate:s,loading:t,teamDetail:l,teamId:y,getTeamDetail:d,member:Oe};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}});function Ne(n,e,s,t,l,y){const d=g("n-spin"),c=g("n-space");return p(),x("div",null,[t.loading?(p(),I(c,{key:0,justify:"center",style:{width:"100%"}},{default:o(()=>[a(d,{size:"medium"})]),_:1})):(p(),I(t.member,{key:1,teamDetail:t.teamDetail},null,8,["teamDetail"]))])}const Xe=N(Re,[["render",Ne],["__file","memberProject.vue"]]);export{Xe as default};
