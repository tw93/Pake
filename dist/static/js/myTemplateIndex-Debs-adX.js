import{d as te,a5 as De,as as he,e as oe,bd as se,ac as ge,r as N,H as ve,ay as D,aA as re,aB as R,aC as L,c8 as Te,aD as le,b4 as ie,aw as ce,R as Z,_ as ae,U as i,c as b,V as k,o as r,s as t,w as n,q as S,t as M,X as C,Y as O,Z as Se,bx as Ne,G as Ee,A as de,az as ue,aO as me,ak as fe,aP as _e,bc as ke,F as Ie,n as Ce,au as Ae}from"./index-DzJUk-4s.js";import{i as q}from"./icon-Bt2TghsQ.js";import{g as ee,D as Fe}from"./plugin-BZaVEG5Y.js";import{u as Me}from"./useScroll.hook-BppF_wKM.js";import{u as He,f as Be,d as je,a as ze,c as Ve}from"./masterplates.api-CmXDBnKg.js";import{u as ye,T as Pe}from"./templateStore.d-scXId6Zo.js";import{u as be,d as Ue}from"./systemStore-CDAOEx2u.js";import{n as Re}from"./noFile-CJNz9t2r.js";import{d as Le}from"./project-list-bg-C8sD85Ky.js";import{F as $}from"./fileTypeEnum-22QBGXO_.js";import{_ as Oe}from"./points-Bi1H5gtF.js";import"./index-YIaHLc6Z.js";const pe="#e88080",qe=te({__name:"ItemsCard",props:{cardData:Object,index:{type:Number,default:0}},emits:["delete","create","update"],setup(h,{expose:a,emit:o}){var H;a(),De(u=>({"5599fa8a":I.value,"3969dc52":g.value,f56fff28:pe,"4218b260":he(F)}));const e=o,s=h,A=be(),m=ge(),v=N(),{TrashOutlineIcon:T,ArrowUndoOutlineIcon:f}=q.ionicons5,{CarbonSendIcon:p,SendBackwardIcon:_}=q.carbon,w=N(window.__PRIVATE_MODULE__.MemberPoint),c=N(null),d=ve({idEdit:!1,isEnter:!1,newTitle:"",oldTitle:""}),I=oe(()=>m.getAppTheme),g=oe(()=>se(m.getAppTheme,.2)),F=se("#e88080",.2),G=()=>Le,j=()=>{var u;e("delete",(u=s.cardData)==null?void 0:u.id)},Q=()=>{var u;e("create",(u=s.cardData)==null?void 0:u.id)},z=N(null),V=N(((H=s.cardData)==null?void 0:H.remarks)||""),K=()=>{var y;const u=()=>{s.cardData&&e("update",{id:s.cardData.id,state:s.cardData.state?0:2,points:z.value,remarks:V.value})};if(((y=s.cardData)==null?void 0:y.state)===0){if(!w){u();return}ee({title:"提示",message:()=>D("div",{style:{marginTop:"10px"}},[D(re,{style:{margin:"10px 0 20px"}}),D(R,{align:"center",wrap:!1},{default:()=>[D(L,{style:{whiteSpace:"nowrap",fontSize:"14px"}},{default:()=>"积分"}),D(Te,{placeholder:"请输入模板所需积分，默认为免费使用",value:z.value,precision:0,min:0,max:999999,onUpdateValue:B=>z.value=B||0,style:{width:"100%"}})]}),D(R,{wrap:!1,style:{marginTop:"20px"}},{default:()=>[D(L,{style:{whiteSpace:"nowrap",fontSize:"14px"}},{default:()=>"描述"}),D(le,{type:"textarea",placeholder:"请输入模板的描述",value:V.value,onUpdateValue:B=>V.value=B,style:{width:"100%"}})]})]),promise:!0,onPositiveCallback:()=>{u()}})}else ee({message:"确定下架该模板吗？",onPositiveCallback:()=>{u()}})},W=async({file:u})=>{v.value=[];const y=u.file.type;return u.file.size>1024*1024*ie?(window.$message.warning(`图片超出 ${ie}M 限制，请重新上传！`),!1):y!==$.PNG&&y!==$.JPEG&&y!==$.GIF?(window.$message.warning("文件格式不符合，请重新上传！"),!1):!0},Y=async u=>{const{file:y}=u,B=P=>{if(!s.cardData)return;const U=s.cardData,ne=U.points||0,X=U.state||0;e("update",{id:U.id,state:X,points:ne,fileKey:P})};ce(async()=>{if(y.file&&s.cardData){const P=y.file,U=P.name.substring(P.name.lastIndexOf(".")+1),X=`charts-img-db/${`template_${s.cardData.id}.${U}`}`;(await(await A.getSTSClient()).putObject({key:X,body:P})).statusCode===200&&B(X)}})},J=()=>{var u,y;d.newTitle=((u=s.cardData)==null?void 0:u.projectName)||"",d.oldTitle=((y=s.cardData)==null?void 0:y.projectName)||"",d.idEdit=!0,ce(()=>{c.value&&c.value.focus()})},l=async(u=!1)=>{var y;if(!((y=s.cardData)!=null&&y.id)){window.$message.warning("修改失败，请刷新页面重试");return}if(d.isEnter=u,d.idEdit=!1,!d.newTitle.trim()){window.$message.warning("名称不能为空");return}if(d.newTitle!==d.oldTitle&&s.cardData)try{(await He({id:s.cardData.id,data:{projectName:d.newTitle}})).code==Z.SUCCESS&&(window.$message.success("修改成功"),s.cardData.projectName=d.newTitle)}catch(B){window.$message.error("操作失败, 请稍后重试")}},E={emit:e,props:s,systemStore:A,designStore:m,uploadFileListRef:v,TrashOutlineIcon:T,ArrowUndoOutlineIcon:f,CarbonSendIcon:p,SendBackwardIcon:_,isPrivateMemberPoint:w,inputInstRef:c,editNameInfo:d,themeColor:I,fadeThemeColor:g,errorBg:pe,fadeErrorBg:F,requireErrorImg:G,deleteHandle:j,createHandle:Q,points:z,remarks:V,evUpdateMasterplatesGrounding:K,beforeUploadHandle:W,customRequest:Y,renameHandle:J,saveNewName:l,blurHandle:()=>{d.isEnter||l()},get NFlex(){return R},get NText(){return L},get NDivider(){return re},get NInput(){return le},get dayjs(){return Ue}};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}}),Ge="/static/png/fabu.png",Ke={key:0,class:"go-items-list-card"},Ye={key:0,class:"top-tip",src:Ge},Je={class:"list-content"},Xe={class:"list-content-img"},Ze=["src"],Qe={key:2,class:"list-content-point go-background-filter-shallow"},We={key:3,class:"list-content-point show-color go-background-filter-shallow"},$e={class:"list-content-hover go-transition-quick"},et={key:0},tt={key:1},at={key:1},nt={class:"list-footer"},ot={class:"top"};function st(h,a,o,e,s,A){const m=i("n-image"),v=i("svg-icon"),T=i("n-number-animation"),f=i("n-icon"),p=i("n-tag"),_=i("n-button"),w=i("n-upload"),c=i("n-space"),d=i("n-card");return o.cardData?(r(),b("div",Ke,[t(d,{class:"list-card",hoverable:"",size:"small"},{action:n(()=>{var I;return[S("div",nt,[S("div",ot,[e.editNameInfo.idEdit?(r(),M(e.NInput,{key:0,value:e.editNameInfo.newTitle,"onUpdate:value":a[0]||(a[0]=g=>e.editNameInfo.newTitle=g),valueModifiers:{trim:!0},ref:"inputInstRef",size:"small",type:"text",maxlength:16,placeholder:"输入新名称",onBlur:e.blurHandle,onKeyup:a[1]||(a[1]=Se(g=>e.saveNewName(!0),["enter"])),style:{width:"150px"}},null,8,["value"])):(r(),M(e.NText,{key:1,class:"go-ellipsis-1 go-cursor-pointer",title:(I=o.cardData)==null?void 0:I.projectName,onDblclick:e.renameHandle},{default:n(()=>{var g;return[C(O(((g=o.cardData)==null?void 0:g.projectName)||""),1)]}),_:1},8,["title"])),t(w,{"show-file-list":!1,"file-list":e.uploadFileListRef,"onUpdate:fileList":a[2]||(a[2]=g=>e.uploadFileListRef=g),customRequest:e.customRequest,onBeforeUpload:e.beforeUploadHandle,accept:"image/png, image/gif, image/jpeg"},{default:n(()=>[t(_,{secondary:"",size:"small"},{default:n(()=>a[6]||(a[6]=[C("上传封面")])),_:1})]),_:1},8,["file-list"])]),t(c,{class:"bottom",justify:"space-between"},{default:n(()=>[t(e.NText,{depth:3},{default:n(()=>[C(O(e.dayjs(o.cardData.createdAt).format("YYYY-MM-DD")||""),1)]),_:1}),a[7]||(a[7]=S("div",{class:"list-footer-ri"},null,-1))]),_:1})])]}),default:n(()=>[o.cardData.state===1?(r(),b("img",Ye)):k("",!0),S("div",Je,[S("div",Xe,[o.cardData.thumbnail?(r(),M(m,{key:0,"object-fit":"contain",height:"180",src:`${o.cardData.thumbnail}?rdn=${o.cardData.updateAt}`,alt:o.cardData.projectName,"fallback-src":e.requireErrorImg()},null,8,["src","alt","fallback-src"])):(r(),b("img",{key:1,class:"default-img",src:e.requireErrorImg(),alt:"cardData.title"},null,8,Ze)),Number(o.cardData.points)===0?(r(),b("div",Qe,[a[3]||(a[3]=C(" 免费 ")),t(e.NDivider,{vertical:"",style:{margin:"0 4px",height:"12px"}}),t(e.NFlex,{size:2,wrap:!1,align:"center"},{default:n(()=>[t(v,{icon:"card-hot",style:{"font-size":"14px"}}),t(e.NText,{depth:3},{default:n(()=>[t(T,{ref:"numberAnimationInstRef",from:0,to:o.cardData.star},null,8,["to"])]),_:1})]),_:1})])):(r(),b("div",We,[a[4]||(a[4]=S("img",{src:Oe},null,-1)),C(" "+O(o.cardData.points)+" ",1),t(e.NDivider,{vertical:"",style:{margin:"0 4px",height:"12px"}}),t(e.NFlex,{size:2,wrap:!1,align:"center"},{default:n(()=>[t(v,{icon:"card-hot",style:{"font-size":"14px"}}),t(e.NText,{depth:3},{default:n(()=>[t(T,{ref:"numberAnimationInstRef",from:0,to:o.cardData.star},null,8,["to"])]),_:1})]),_:1})]))]),S("div",$e,[t(e.NFlex,null,{default:n(()=>[o.cardData.state!==2?(r(),b("div",{key:0,class:"list-content-btn disabled-drag",onClick:e.evUpdateMasterplatesGrounding},[t(e.NFlex,{align:"center",size:0},{default:n(()=>[t(f,null,{default:n(()=>[o.cardData.state==0?(r(),M(e.CarbonSendIcon,{key:0})):k("",!0),o.cardData.state==1?(r(),M(e.ArrowUndoOutlineIcon,{key:1})):k("",!0)]),_:1}),o.cardData.state==0?(r(),b("div",et,"上 架")):k("",!0),o.cardData.state==1?(r(),b("div",tt,"下 架")):k("",!0)]),_:1})])):k("",!0),o.cardData.state==2?(r(),b("div",at,[t(p,{type:"warning",round:""},{default:n(()=>a[5]||(a[5]=[C("审 核 中")])),_:1})])):k("",!0),S("div",{class:"list-content-btn list-content-btn disabled-drag",onClick:e.createHandle},"创 建"),S("div",{class:"list-content-btn list-content-btn-error disabled-drag",onClick:e.deleteHandle},"删 除")]),_:1})])])]),_:1})])):k("",!0)}const rt=ae(qe,[["render",st],["__scopeId","data-v-125be2b2"],["__file","ItemsCard.vue"]]);var we=(h=>(h.SELF="self",h))(we||{});const lt=te({__name:"index",setup(h,{expose:a}){a();const{PersonIcon:o}=q.ionicons5,e=Ne(),s=ye(),A=ge(),m=N(!0),{contentRef:v,bottom:T,list:f,inBottom:p,page:_,pageSize:w}=Me(),c=ve({sortKey:"updateAt",sortValue:"desc"}),d=N(!1),I=N("self"),g=N([]),F=N(""),G=be(),j=async(l=!1)=>{m.value=!0;const{sortKey:x,sortValue:E}=c,H=await Be({page:_.value,pageSize:w.value,sortKey:x,sortValue:E});m.value=!1,H.code===Z.SUCCESS&&(H.data.data.length===0||H.data.data.length<w.value?p.value=!0:p.value=!1,l?f.value.push(...H.data.data):f.value=H.data.data)},Q=async l=>{ee({type:Fe.DELETE,center:!0,promise:!0,message:"删除模板将无法恢复，是否要删除该模板？",onPositiveCallback:async()=>await je({projectId:l}),promiseRejCallback:()=>{window.$message.error("删除失败, 请稍后重试!")},promiseResCallback:x=>{x.code===Z.SUCCESS?(window.$message.success("删除成功!"),f.value.splice(f.value.findIndex(E=>E.id===l),1)):window.$message.error("删除失败, 请稍后重试!")}})},z=l=>{ze(l).then(x=>{l.state===2?window.$message.success("模板将进行审核，2～3工作日内完成!"):window.$message.success("操作成功!"),_.value=1,f.value=[],j()})},V=l=>{F.value=l;const x=[{value:"self",label:()=>D(R,{align:"center",size:4,style:{padding:"6px 0"}},{default:()=>["我的空间",D(ke,{style:{opacity:".5"}},{default:()=>D(o)})]})},{type:"group",label:"空间列表",key:"空间列表",children:[]}];G.getTeamList.forEach(E=>{x[1].children.push({label:E.team_name,value:E.id})}),g.value=x,setTimeout(()=>{d.value=!0,I.value="self"})},K=()=>{d.value=!1,F.value=""},W=async()=>{const l=I.value==="self"?void 0:I.value,x=await Ve({id:F.value,team_id:l});try{if(x.code===Z.SUCCESS){const E=()=>D("div",{style:{borderRadius:"4px",padding:"8px 25px",boxShadow:"var(--n-box-shadow)",display:"flex",gap:"10px",backgroundColor:A.darkTheme?"#48484e":"#fff"}},[D(L,{},{default:()=>"创建成功,"}),D(ue,{text:!0,type:"primary",size:"small",onClick:()=>Y(l)},{default:()=>"点击查看"})]);e.success("创建成功",{type:"success",render:E}),K()}}catch(E){window.$message.error("创建失败, 请稍后重试!")}},Y=l=>{if(l){const x=me(fe.TEAM_MANAGEMENT_MY_NAME,"href");_e(x,[l],!0,!1,{tabKey:"project"})}else{const x=me(fe.SCREEN_ITEMS_NAME,"href");_e(x,[],void 0,!1)}};Ee(()=>{de(()=>T.value,l=>{if(l){if(_.value+=1,p.value)return;j(!0)}})}),de(()=>s.getHomeSort,l=>{c.sortKey=l.sortKey,c.sortValue=l.sortValue,_.value=1,f.value=[],j()},{immediate:!0});const J={SelfEnum:we,PersonIcon:o,message:e,templateStore:s,designStore:A,fetchDataLoading:m,contentRef:v,bottom:T,list:f,inBottom:p,page:_,pageSize:w,homeSort:c,createTemplateHandleDialogShow:d,createTemplateHandleDialogValue:I,dialogOptions:g,selectId:F,systemStore:G,getListData:j,deleteHandle:Q,evUpdateMasterplatesGrounding:z,createTemplateHandleDialog:V,closeDialogHandle:K,createHandle:W,toProjectPage:Y,get NText(){return L},get NButton(){return ue},get NFlex(){return R},get NoDataSvg(){return Re},ItemCard:rt};return Object.defineProperty(J,"__isScriptSetup",{enumerable:!1,value:!0}),J}}),it={ref:"contentRef",class:"go-my-template"},ct={key:1,class:"loading-box"},dt={key:2,class:"go-flex-center go-mt-3"},ut={key:3,class:"go-flex-column-center",style:{margin:"100px auto"}};function mt(h,a,o,e,s,A){const m=i("n-grid-item"),v=i("n-grid"),T=i("n-spin"),f=i("n-image"),p=i("n-divider"),_=i("n-select"),w=i("n-modal");return r(),b("div",it,[e.list.length?(r(),M(v,{key:0,"x-gap":20,"y-gap":20,cols:"2 s:2 m:3 l:3 xl:4 xxl:4",responsive:"screen"},{default:n(()=>[(r(!0),b(Ie,null,Ce(e.list,(c,d)=>(r(),M(m,{key:c.id},{default:n(()=>[t(e.ItemCard,{cardData:c,index:d,onDelete:e.deleteHandle,onCreate:e.createTemplateHandleDialog,onUpdate:e.evUpdateMasterplatesGrounding},null,8,["cardData","index"])]),_:2},1024))),128))]),_:1})):k("",!0),e.fetchDataLoading?(r(),b("div",ct,[t(T,{size:"large"})])):k("",!0),e.inBottom&&e.list.length>12?(r(),b("div",dt,[t(e.NText,{depth:3},{default:n(()=>a[2]||(a[2]=[C("已经到底部啦~")])),_:1})])):k("",!0),!e.list.length&&!e.fetchDataLoading?(r(),b("div",ut,[t(f,{"object-fit":"contain",height:"200","preview-disabled":"",src:e.NoDataSvg},null,8,["src"]),t(e.NText,{depth:"3"},{default:n(()=>a[3]||(a[3]=[C("暂时还没有模板呢")])),_:1})])):k("",!0),t(w,{class:"go-background-filter",title:"选择创建位置",preset:"card",size:"small",style:{width:"600px"},show:e.createTemplateHandleDialogShow,"onUpdate:show":a[1]||(a[1]=c=>e.createTemplateHandleDialogShow=c),"transform-origin":"center",bordered:!0,"content-style":"padding: 0 0 10px;",onAfterLeave:e.closeDialogHandle},{default:n(()=>[t(p,{style:{"margin-top":"4px","margin-bottom":"0"}}),t(e.NFlex,{class:"select-create-target-box"},{default:n(()=>[t(_,{value:e.createTemplateHandleDialogValue,"onUpdate:value":a[0]||(a[0]=c=>e.createTemplateHandleDialogValue=c),options:e.dialogOptions,style:{flex:"1"}},null,8,["value","options"]),t(e.NButton,{type:"primary",onClick:e.createHandle},{default:n(()=>[t(e.NText,{style:{"font-size":"14px"}},{default:n(()=>a[4]||(a[4]=[C("创建模板")])),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],512)}const ft=ae(lt,[["render",mt],["__scopeId","data-v-8262d1f5"],["__file","index.vue"]]);var xe=(h=>(h.MY_TEMPLATE="myTemplate",h.OFFICIAL_TEMPLATE="officialTemplate",h))(xe||{});const _t=te({__name:"myTemplateIndex",setup(h,{expose:a}){a();const o=Ae(),{SortAscendingIcon:e,SortDescendingIcon:s}=q.carbon,{ChevronDownIcon:A}=q.ionicons5,m=ye(),{key:v}=o.currentRoute.value.query||"myTemplate",T=N(v),f=N(m.homeSort.sortKey),p=N(m.homeSort.sortValue),_={updateAt:"更新时间",createdAt:"创建时间",star:"热度"},w=[{type:"group",label:"排序方式",key:"sort",children:[{label:_.star,key:"star"},{label:_.updateAt,key:"updateAt"},{label:_.createdAt,key:"createdAt"}]}],c=()=>{m.setItem(Pe.HOME_SORT,{sortKey:f.value,sortValue:p.value})},g={$router:o,TabNameEnum:xe,SortAscendingIcon:e,SortDescendingIcon:s,ChevronDownIcon:A,templateStore:m,key:v,tabValue:T,selectValue:f,sort:p,suffixObj:_,suffixOptions:w,updateHomeSortData:c,handleSelect:F=>{f.value=F,c()},sortHandle:()=>{p.value=p.value==="asc"?"desc":"asc",c()},get MyTemplate(){return ft}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),pt={class:"go-project-template"},gt={class:"top-tab-box"},vt={class:"go-flex-center"},yt={class:"content-box"};function bt(h,a,o,e,s,A){const m=i("n-icon"),v=i("n-button"),T=i("n-dropdown"),f=i("n-tooltip"),p=i("n-tab"),_=i("n-tabs");return r(),b("div",pt,[S("div",gt,[t(_,{value:e.tabValue,"onUpdate:value":a[0]||(a[0]=w=>e.tabValue=w),type:"line",animated:""},{suffix:n(()=>[S("div",vt,[t(T,{options:e.suffixOptions,onSelect:e.handleSelect},{default:n(()=>[t(v,{"icon-placement":"right",quaternary:"",size:"small",focusable:!1},{icon:n(()=>[t(m,{depth:"3",size:"16"},{default:n(()=>[t(e.ChevronDownIcon)]),_:1})]),default:n(()=>[C(O(e.suffixObj[e.selectValue])+" ",1)]),_:1})]),_:1}),t(f,{placement:"bottom",trigger:"hover","show-arrow":!1},{trigger:n(()=>[t(v,{class:"go-ml-1",quaternary:"",focusable:!1,size:"small",onClick:e.sortHandle},{icon:n(()=>[t(m,{size:"16"},{default:n(()=>[e.sort==="desc"?(r(),M(e.SortAscendingIcon,{key:0})):(r(),M(e.SortDescendingIcon,{key:1}))]),_:1})]),_:1})]),default:n(()=>[S("span",null,O(e.sort==="asc"?"倒序":"正序"),1)]),_:1})])]),default:n(()=>[t(p,{name:e.TabNameEnum.MY_TEMPLATE},{default:n(()=>a[1]||(a[1]=[C("我的模板")])),_:1},8,["name"])]),_:1},8,["value"])]),S("div",yt,[t(e.MyTemplate)])])}const Ht=ae(_t,[["render",bt],["__scopeId","data-v-f27312c8"],["__file","myTemplateIndex.vue"]]);export{Ht as default};
