import{br as Ae,d as Oe,r as c,e as Ve,H as Fe,ac as ze,bx as Ue,G as Pe,A as je,D as Le,E as P,aw as j,c9 as Ke,aZ as qe,R as ee,ay as m,aC as ae,az as te,bQ as Ye,aO as S,aM as oe,bt as L,aP as E,ak as se,ai as Ge,bc as he,aB as _e,_ as Je,U as b,c as M,o as p,q as x,s,w as l,X as T,F as ne,n as le,t as w,Y as I,z as xe}from"./index-DzJUk-4s.js";import{i as Ce}from"./icon-Bt2TghsQ.js";import{S as Qe}from"./searchInput-JhldHsIN.js";import{u as Xe}from"./systemStore-CDAOEx2u.js";import{t as Ze,c as We,S as $e,C as ea}from"./showDetail-VigmGOIs.js";import{b as aa}from"./masterplates.api-CmXDBnKg.js";import{s as ta,a as oa}from"./public-BhRo10AI.js";import"./GoUserAvatar-BBITl89l.js";import"./drawRemote-BVHvBcY1.js";import"./index.d-J2-cmQid.js";import"./index-B2h3DCGB.js";import"./plugin-BZaVEG5Y.js";import"./file-BoGdIhh5.js";import"./index-DumZb7Zp.js";import"./index-YIaHLc6Z.js";import"./fileTypeEnum-22QBGXO_.js";import"./chart_default-Cv54ZmSo.js";import"./hot-tip-bg-5DNCBqVA.js";import"./points-Bi1H5gtF.js";const sa=Ae({id:"templateStore",state:()=>({homeSort:{sortKey:"star",sortValue:"desc"}}),getters:{getHomeSort(){return this.homeSort}},actions:{setItem(g,r){this.$patch(B=>{B[g]=r})}}});var Se=(g=>(g.HOME_SORT="homeSort",g))(Se||{}),Ee=(g=>(g.SELF="self",g))(Ee||{});const na=Oe({__name:"search",setup(g,{expose:r}){r();const{ChevronBackIcon:B,ChevronDownIcon:e,PersonIcon:K}=Ce.ionicons5,{SortAscendingIcon:re,SortDescendingIcon:N}=Ce.carbon,R=c([{title:"模板",key:"masterplate",num:0},{title:"组件",key:"component",num:0}]),q=Ve(()=>f.value==="masterplate"?Ze.map(a=>({title:a.label,key:a.value})):We.map(a=>({title:a.label,key:a.value}))),k=c(!1),h=Fe({id:"",type:"masterplate"}),_=c(),n=Xe(),d=Le(),i=c(""),f=c("masterplate"),v=c("all"),A=c(void 0),Y=c(!1),C=c("self"),ce=c([]),G=ze(),H=Ue(),O=sa(),J=c("star"),V=c("desc"),be=()=>{V.value=V.value==="asc"?"desc":"asc",Q()},Te=a=>{J.value=a,Q()},Q=()=>{O.setItem(Se.HOME_SORT,{sortKey:J.value,sortValue:V.value}),y(!0)},X=c(!1),D=c(1),Z=c([]),F=c(!1),z=c(!1),W=c(32),we=a=>{a.target.scrollTop>10?X.value=!0:X.value=!1;const t=a.target.scrollHeight-a.target.scrollTop-a.target.clientHeight;Math.round(t)<50?F.value=!0:F.value=!1},Ne=(a,t)=>{v.value=a.key,fe(),y(!0)},ke=(a,t)=>{a.preventDefault(),a.stopPropagation(),f.value=t,pe(t),y(!0),setTimeout(()=>{_.value.closeHandle()},300)},He=async a=>{i.value!==a&&(a?i.value=a:i.value="",de(),D.value=1,await y(!0))},y=async(a=!1)=>{a&&(D.value=1);const t=await qe({sortKey:O.getHomeSort.sortKey,sortValue:O.getHomeSort.sortValue,tags:v.value==="all"?"":v.value,searchValue:i.value,page:D.value,pageSize:W.value,type:f.value});t.code===ee.SUCCESS&&(a&&(Z.value=[]),R.value.forEach(o=>{var u,ye;o.key==="component"?o.num=(u=t.data)==null?void 0:u.searchCount.component:o.key==="masterplate"&&(o.num=(ye=t.data)==null?void 0:ye.searchCount.masterplate)}),t.data.data.length===0||t.data.data.length<W.value?j(()=>{z.value=!0}):z.value=!1,Z.value.push(...t.data.data.map(o=>("projectName"in o?Object.assign(o,{type:f.value}):Object.assign(o,{type:f.value,projectName:o==null?void 0:o.title}),o))))},De=(a,t)=>{h.id=a,h.type=t,k.value=!0},Me=a=>{h.id=a.id,h.type=a.category},Ie=(a,t)=>{A.value=a,t==="masterplate"?ie(a):t==="component"&&ue()},ie=async a=>{let t=null;t=H.create("正在添加到模板，请稍后",{type:"loading"});try{const o=await aa({id:a}),u=()=>m("div",{style:{borderRadius:"4px",padding:"8px 25px",boxShadow:"var(--n-box-shadow)",display:"flex",gap:"10px",backgroundColor:G.darkTheme?"#48484e":"#fff"}},[m(ae,{},{default:()=>"创建成功,"}),m(te,{text:!0,type:"primary",size:"small",onClick:ge},{default:()=>"点击查看"})]);o.code===ee.SUCCESS&&(d.emit(P.CHECK_VALIDITY_MEMBER,{needRequest:!0}),t.destroy(),H.success("添加成功",{type:"success",render:u}))}catch(o){window.$message.error("创建失败, 请稍后重试")}},ue=()=>{const a=[{value:"self",label:()=>m(_e,{align:"center",size:4,style:{padding:"6px 0"}},{default:()=>["我的空间",m(he,{style:{opacity:".5"}},{default:()=>m(K)})]})},{type:"group",label:"空间列表",key:"空间列表",children:[]}];n.getTeamList.forEach(t=>{a[1].children.push({label:t.team_name,value:t.id})}),ce.value=a,setTimeout(()=>{Y.value=!0,C.value="self"})},U=()=>{Y.value=!1},Be=async()=>{if(!A.value){window.$message.error("添加失败，请刷新后重试"),U();return}let a=null;a=H.create("正在添加到组件库中，请稍后",{type:"loading"});const t=await Ye({id:A.value,team_id:C.value==="self"?void 0:C.value});try{if(t.code===ee.SUCCESS){d.emit(P.CHECK_VALIDITY_MEMBER,{needRequest:!0});const o=()=>m("div",{style:{borderRadius:"4px",padding:"8px 25px",boxShadow:"var(--n-box-shadow)",display:"flex",gap:"10px",backgroundColor:G.darkTheme?"#48484e":"#fff"}},[m(ae,{},{default:()=>"创建成功,"}),m(te,{text:!0,type:"primary",size:"small",onClick:me},{default:()=>"点击查看"})]);a.destroy(),H.success("添加成功",{type:"success",render:o})}else window.$message.error("创建失败, 请稍后重试");U()}catch(o){U(),window.$message.error("创建失败, 请稍后重试")}},de=()=>{const a=S(oe.COMMUNITY_SEARCH_NAME).path,t=L(),o={search:i.value,category:f.value||"masterplate",tags:v.value};"category"in t&&(o.category=t.category),"tags"in t&&(o.tags=t.tags),d.emit(P.OPERATIONRECORD,{key:`commonSearch@${n.getUserInfo.id}@${o.category}@${o.search}@${o.tags}`,description:"社区更多搜索"}),E(a,void 0,!0,!1,o)},pe=a=>{const t=S(oe.COMMUNITY_SEARCH_NAME).path,o=L(),u={search:i.value,category:a||f.value||"masterplate",tags:v.value};"search"in o&&(u.search=o.search),"tags"in o&&(u.tags=o.tags),E(t,void 0,!0,!1,u)},fe=a=>{const t=S(oe.COMMUNITY_SEARCH_NAME).path,o=L(),u={search:i.value,category:f.value||"masterplate",tags:a||v.value};"search"in o&&(u.search=o.search),"category"in o&&(u.category=o.category),E(t,void 0,!0,!1,u)},$=()=>{const a=L();"search"in a?(i.value=a.search,j(()=>{var t;(t=_.value)==null||t.setValue(a.search)})):(i.value="",j(()=>{var t;(t=_.value)==null||t.setValue("")})),"category"in a&&(f.value=a.category),"tags"in a&&(v.value=a.tags)},ge=()=>{const a=S(se.SCREEN_TEMPLATE_ITEMS_NAME,"href");E(a)},me=()=>{if(C.value==="self"){const a=S(se.SCREEN_ITEMS_NAME).path;E(a,void 0,!1,!1,{tabKey:"component"})}else{const a=S(se.TEAM_MANAGEMENT_MY_NAME).path,t={tabKey:"component"};E(a,[C.value],!1,!1,t)}},Re=()=>{Ge.go(-1)};Pe(()=>{$(),y(!0),je(()=>F.value,a=>{if(a){if(D.value+=1,z.value)return;y()}}),d.on(P.PROJECT_RELOAD_RESOURCE_SEARCH,()=>{$(),j(()=>{y(!0)})})}),Ke(()=>{k.value=!1});const ve={SelfEnum:Ee,ChevronBackIcon:B,ChevronDownIcon:e,PersonIcon:K,SortAscendingIcon:re,SortDescendingIcon:N,allType:R,allTags:q,detailModelShow:k,detailModelInfo:h,searchInputRef:_,systemStore:n,eventBus:d,searchValue:i,searchType:f,tagsValue:v,selectId:A,createComponentHandleDialogShow:Y,createComponentHandleDialogValue:C,dialogOptions:ce,designStore:G,message:H,communitySearchStore:O,selectValue:J,sort:V,sortHandle:be,handleSelect:Te,updateHomeSortData:Q,unTop:X,page:D,list:Z,bottom:F,inBottom:z,pageSize:W,scrollHandle:we,selectTagsHandle:Ne,selectTypeHandle:ke,searchHandle:He,getListData:y,toDetailHandle:De,updateDetailHandle:Me,createHandle:Ie,createTemplateHandle:ie,createComponentHandleDialog:ue,closeDialogHandle:U,createComponentHandle:Be,updateSearch:de,updateType:pe,updateTags:fe,initUpdateRoute:$,toTemplatePage:ge,toComponentPage:me,back:Re,get NText(){return ae},get NButton(){return te},get NFlex(){return _e},get NIcon(){return he},SearchInput:Qe,get suffixObj(){return oa},get suffixOptions(){return ta},ContentCard:ea,ShowDetail:$e};return Object.defineProperty(ve,"__isScriptSetup",{enumerable:!1,value:!0}),ve}}),la={class:"search-box"},ra={class:"go-flex-center back"},ca=["onClick"],ia={class:"go-flex-center"},ua={class:"content-box"},da={class:"content-grid"},pa={style:{"max-height":"80vh",overflow:"auto"}};function fa(g,r,B,e,K,re){const N=b("n-divider"),R=b("n-dropdown"),q=b("n-tooltip"),k=b("n-scrollbar"),h=b("n-select"),_=b("n-modal");return p(),M("div",la,[x("div",{class:xe(["top-box",{unTop:e.unTop}])},[s(e.NFlex,{class:"top-search-box",align:"center",justify:"space-between"},{default:l(()=>[x("div",ra,[s(e.NButton,{strong:"",text:"",style:{height:"40px"},onClick:e.back},{default:l(()=>[s(e.NIcon,{size:"16"},{default:l(()=>[s(e.ChevronBackIcon)]),_:1}),r[4]||(r[4]=T(" 返回 "))]),_:1})]),s(e.NFlex,{align:"center"},{default:l(()=>[s(e.SearchInput,{ref:"searchInputRef",width:"calc(100%)",isPopover:!1,autofocus:!0,defaultValue:e.searchValue,onSearch:e.searchHandle},{suffix:l(()=>[s(e.NFlex,{class:"go-ml-1",align:"center",size:6},{default:l(()=>[s(N,{vertical:"",style:{margin:"0px",height:"30px"}}),(p(!0),M(ne,null,le(e.allType,(n,d)=>(p(),w(e.NButton,{class:"search-after-btn",key:d,size:"small",secondary:e.searchType===n.key,quaternary:e.searchType!==n.key,type:e.searchType===n.key?"primary":void 0,onClick:i=>e.selectTypeHandle(i,n.key)},{default:l(()=>[s(e.NText,null,{default:l(()=>[T(I(n.title)+" "+I(n.num),1)]),_:2},1024)]),_:2},1032,["secondary","quaternary","type","onClick"]))),128))]),_:1})]),_:1},8,["defaultValue"])]),_:1})]),_:1}),s(e.NFlex,{class:"tags",justify:"space-between"},{default:l(()=>[s(e.NFlex,{class:"tags-list",size:4},{default:l(()=>[(p(!0),M(ne,null,le(e.allTags,(n,d)=>(p(),M("div",{class:xe(["item",{active:e.tagsValue===n.key}]),key:n.key,onClick:i=>e.selectTagsHandle(n,d)},[s(e.NText,null,{default:l(()=>[T(I(n.title),1)]),_:2},1024)],10,ca))),128))]),_:1}),x("div",ia,[s(R,{options:e.suffixOptions,onSelect:e.handleSelect},{default:l(()=>[s(e.NButton,{"icon-placement":"right",quaternary:"",size:"small",focusable:!1},{icon:l(()=>[s(e.NIcon,{depth:"3",size:"16"},{default:l(()=>[s(e.ChevronDownIcon)]),_:1})]),default:l(()=>[T(I(e.suffixObj[e.selectValue])+" ",1)]),_:1})]),_:1},8,["options"]),s(q,{placement:"bottom",trigger:"hover","show-arrow":!1},{trigger:l(()=>[s(e.NButton,{class:"go-ml-1",quaternary:"",focusable:!1,size:"small",onClick:e.sortHandle},{icon:l(()=>[s(e.NIcon,{size:"16"},{default:l(()=>[e.sort==="asc"?(p(),w(e.SortAscendingIcon,{key:0})):(p(),w(e.SortDescendingIcon,{key:1}))]),_:1})]),_:1})]),default:l(()=>[x("span",null,I(e.sort==="desc"?"倒序":"正序"),1)]),_:1})])]),_:1})],2),x("div",ua,[e.list.length?(p(),w(k,{key:1,style:{height:"calc(100vh - 210px)"},onScroll:e.scrollHandle},{default:l(()=>[x("div",da,[(p(!0),M(ne,null,le(e.list,n=>(p(),w(e.ContentCard,{key:n.id,cardData:n,toDetail:!1,onCreate:d=>e.createHandle(n.id,n.type),onDetail:d=>e.toDetailHandle(n.id,n.type)},null,8,["cardData","onCreate","onDetail"]))),128))])]),_:1})):(p(),w(e.NFlex,{key:0,justify:"center",style:{"margin-top":"200px"}},{default:l(()=>[s(e.NText,null,{default:l(()=>r[5]||(r[5]=[T("没有搜到内容呢~")])),_:1})]),_:1}))]),s(_,{class:"go-background-filter",title:"选择组件位置",preset:"card",size:"small",style:{width:"600px"},show:e.createComponentHandleDialogShow,"onUpdate:show":r[1]||(r[1]=n=>e.createComponentHandleDialogShow=n),"transform-origin":"center",bordered:!0,"content-style":"padding: 0 0 10px;",onAfterLeave:e.closeDialogHandle},{default:l(()=>[s(N,{style:{"margin-top":"4px","margin-bottom":"0"}}),s(e.NFlex,{class:"select-create-target-box"},{default:l(()=>[s(h,{value:e.createComponentHandleDialogValue,"onUpdate:value":r[0]||(r[0]=n=>e.createComponentHandleDialogValue=n),options:e.dialogOptions,style:{flex:"1"}},null,8,["value","options"]),s(e.NButton,{type:"primary",onClick:e.createComponentHandle},{default:l(()=>[s(e.NText,{style:{"font-size":"14px"}},{default:l(()=>r[6]||(r[6]=[T("添加组件")])),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),s(_,{class:"go-background-filter",title:"资源详情",preset:"card",size:"small",style:{width:"80vw","max-width":"1400px"},show:e.detailModelShow,"onUpdate:show":r[2]||(r[2]=n=>e.detailModelShow=n),"transform-origin":"center",bordered:!0,"content-style":"padding: 0 0 10px;",onAfterLeave:r[3]||(r[3]=()=>{})},{default:l(()=>[s(N,{style:{"margin-top":"4px","margin-bottom":"0"}}),x("div",pa,[s(e.ShowDetail,{category:e.detailModelInfo.type,id:e.detailModelInfo.id,onUpdateDetail:e.updateDetailHandle},null,8,["category","id"])])]),_:1},8,["show"])])}const Ba=Je(na,[["render",fa],["__scopeId","data-v-c0adbeb2"],["__file","search.vue"]]);export{Ba as default};
