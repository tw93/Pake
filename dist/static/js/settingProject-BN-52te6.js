import{d as j,r as _,b8 as $,e as ee,D as te,aQ as ae,E as k,ay as h,R as T,aj as ne,ak as se,_ as G,U as f,c as S,o as E,q as n,s as a,V as x,w as s,X as i,Y as A,t as B,p as oe,F as ue,f as ie}from"./index-DzJUk-4s.js";import{r as le,s as re,t as de,l as me,q as ce}from"./team.api-Dw2fcOfS.js";import{u as _e}from"./systemStore-CDAOEx2u.js";import{i as fe}from"./icon-Bt2TghsQ.js";/* empty css                                                              *//* empty css                                                                          */import{G as L}from"./GoUserAvatar-BBITl89l.js";const pe=j({__name:"setting",props:{teamDetail:{type:Object,default:()=>({})}},emits:["updateTeamInfo"],setup(b,{expose:e,emit:c}){e();const t=c,o=b,g=_(window.__PRIVATE_MODULE__.CreateTeamUpgrade),{AccessibilityIcon:u,GridIcon:p}=fe.ionicons5,m=te(),l=_($(o.teamDetail.team_name)),v=_e(),{id:F}=v.getUserInfo,D=_(!1),y=_(!1),r=_(),C=_(""),U=_([]),z=ee(()=>F===o.teamDetail.createUserId),V=d=>d?d[0]:"无",O=d=>ae(d),q=()=>{m.emit(k.OPEN_UPGRADE_TEAM,{name:o.teamDetail.team_name,end_date:o.teamDetail.end_date,team_number_limit:o.teamDetail.team_number_limit,team_charts_limit:o.teamDetail.team_charts_limit,teamId:o.teamDetail.id,type:1,callback:()=>{}})},Q=d=>h("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},[h(L,{width:22,height:22,avatarUrl:d.avatar,style:{height:"22px"}}),h("span",{style:{fontSize:"13px"}},d.nickname)]),X=(d,w)=>{r.value=w},Y=()=>{{if(U.value.length<1){window.$message.error("暂无移交对象");return}D.value=!0}},J=async()=>{(await le({teamId:o.teamDetail.id,transferUserId:r.value.id})).code===T.SUCCESS&&(window.$message.success("移交成功"),t("updateTeamInfo"),m.emit(k.UPDATE_TEAM_LIST)),M()},M=()=>{D.value=!1,r.value=null},N=()=>{y.value=!1,C.value=""},K=()=>{if(C.value!==o.teamDetail.team_name){window.$message.error("空间名称不正确");return}R()},R=async()=>{(await re({teamId:o.teamDetail.id})).code===T.SUCCESS&&(window.$message.success("删除成功"),N(),m.emit(k.UPDATE_TEAM_LIST),ne(se.SCREEN_ITEMS_NAME))},I=_(!1),W=async()=>{if(I.value=!1,!l.value||l.value===o.teamDetail.team_name)return;(await de({team_id:o.teamDetail.id,team_name:l.value,team_avatar:o.teamDetail.team_avatar,application_switch:o.teamDetail.application_switch,team_contact:o.teamDetail.team_contact})).code===T.SUCCESS&&(window.$message.success("修改成功"),t("updateTeamInfo"),v.setTeamInfoItem(o.teamDetail.id,"team_name",l.value))},Z=()=>{if(v.getTeamInfo.expired){window.$message.error("空间所有者的会员已到期，无法使用此功能");return}I.value=!0},P=async()=>{const d=await me({teamId:o.teamDetail.id});if(d.code===T.SUCCESS){U.value=d.data.filter(w=>w.users.id!==o.teamDetail.createUserId).map(w=>w.users);return}};P();const H={emit:t,props:o,isPrivate:g,AccessibilityIcon:u,GridIcon:p,eventBus:m,teamName:l,systemStore:v,userId:F,showMoveRef:D,showDeleteRef:y,moveTarget:r,inputTeamName:C,infoList:U,isCreate:z,getFirstStr:V,comTipBg:O,upgradeHandle:q,renderMoveLabel:Q,handleMoveSelect:X,showMoveRefHandle:Y,moveHandle:J,closeMoveHandle:M,closeDeleteHandle:N,deleteHandle:K,deleteTeam:R,openEditName:I,editName:W,editFn:Z,getTeamUserListInfo:P,get GoUserAvatar(){return L}};return Object.defineProperty(H,"__isScriptSetup",{enumerable:!1,value:!0}),H}}),ve={class:"go-team-setting-box"},Ee={class:"top-box"},Ae={class:"team-header"},ge={class:"team-header"},Fe={class:"team-header-tips"},De={class:"top"},ye={class:"files-num"},Ce={class:"team-header-tips"},we={class:"top"},Te={class:"files-num"},be={key:0},xe={key:0},Se={class:"content"},Be={class:"content"},Ue={class:"modal-content-box"},Ie={class:"bottom"},ke={class:"modal-content-box"},he={style:{"margin-bottom":"2px"}},Me={class:"bottom"};function Ne(b,e,c,t,o,g){const u=f("n-text"),p=f("n-icon"),m=f("n-input"),l=f("n-button"),v=f("n-space"),F=f("n-divider"),D=f("n-dropdown"),y=f("n-modal");return E(),S(ue,null,[n("div",ve,[n("div",Ee,[n("div",Ae,[a(u,{class:"top team-title",style:{"margin-left":"10px"}},{default:s(()=>[i(A(c.teamDetail.team_name),1)]),_:1})]),n("div",ge,[n("div",Fe,[n("div",De,[a(u,{depth:"3"},{default:s(()=>[e[5]||(e[5]=i(" 项目 ")),a(p,{class:"top-icon",depth:"3"},{default:s(()=>[a(t.GridIcon)]),_:1})]),_:1})]),a(u,{class:"num",depth:"3"},{default:s(()=>[e[6]||(e[6]=n("span",null,"当前创建项目数",-1)),n("span",ye,A(c.teamDetail.chartCount),1),n("span",null," / "+A(c.teamDetail.team_charts_limit),1)]),_:1})]),n("div",Ce,[n("div",we,[a(u,{depth:"3"},{default:s(()=>[e[7]||(e[7]=i(" 成员 ")),a(p,{class:"top-icon",depth:"3"},{default:s(()=>[a(t.AccessibilityIcon)]),_:1})]),_:1})]),a(u,{class:"num",depth:"3"},{default:s(()=>[e[8]||(e[8]=n("span",null,"当前空间人数",-1)),n("span",Te,A(c.teamDetail.teamUserCount),1),e[9]||(e[9]=n("span",null," / ∞",-1))]),_:1})])])]),a(v,{align:"center",style:{"margin-top":"20px"}},{default:s(()=>{var r;return[n("div",{class:"person-tip",style:oe(t.comTipBg(c.teamDetail.createdAt))},A(t.getFirstStr((r=c.teamDetail)==null?void 0:r.team_name[0])),5),a(m,{value:t.teamName,"onUpdate:value":e[0]||(e[0]=C=>t.teamName=C),valueModifiers:{trim:!0},size:"large",disabled:!t.openEditName,maxlength:"20",style:{width:"230px"},onBlur:t.editName},null,8,["value","disabled"]),t.isCreate&&!t.openEditName?(E(),B(l,{key:0,class:"btn",text:"",type:"primary",onClick:t.editFn},{default:s(()=>e[10]||(e[10]=[i(" 编辑 ")])),_:1})):x("",!0)]}),_:1}),t.isCreate?(E(),S("div",be,[e[17]||(e[17]=n("p",{class:"title"},"更多设置",-1)),t.systemStore.checkSVIP?(E(),S("div",xe,[e[13]||(e[13]=n("p",{class:"subtitle"},"移交空间",-1)),n("div",Se,[a(u,{depth:3},{default:s(()=>e[11]||(e[11]=[i("空间归属者可将空间移交给其他成员，移交后将不再保留空间的管理权限。")])),_:1}),a(l,{class:"btn",text:"",type:"primary",onClick:t.showMoveRefHandle},{default:s(()=>e[12]||(e[12]=[i(" 立即移交 ")])),_:1})])])):x("",!0),n("div",null,[e[16]||(e[16]=n("p",{class:"subtitle"},"删除空间",-1)),n("div",Be,[a(u,{depth:3},{default:s(()=>e[14]||(e[14]=[i("删除空间后，空间文件将永久删除，所有成员将无法访问空间文件。")])),_:1}),a(l,{class:"btn",text:"",type:"error",onClick:e[1]||(e[1]=r=>t.showDeleteRef=!0)},{default:s(()=>e[15]||(e[15]=[i(" 删除空间 ")])),_:1})])])])):x("",!0)]),a(y,{class:"go-move-scree-model go-background-filter",title:"移交空间",preset:"card",size:"small",style:{width:"550px"},show:t.showMoveRef,"onUpdate:show":e[2]||(e[2]=r=>t.showMoveRef=r),"transform-origin":"center",bordered:!0,"content-style":"padding: 0 0 10px;",onAfterLeave:t.closeMoveHandle},{default:s(()=>[a(F,{style:{"margin-top":"4px","margin-bottom":"0"}}),n("div",Ue,[e[21]||(e[21]=n("p",null,"移交空间后，你在空间中的权限将默认修改为可管理。",-1)),a(v,{align:"center","wrap-item":!1},{default:s(()=>[e[18]||(e[18]=i(" 选择移交对象 ")),a(D,{trigger:"click","key-field":"id","label-field":"nickname","menu-props":()=>({style:{width:"200px"}}),"render-label":t.renderMoveLabel,options:t.infoList,onSelect:t.handleMoveSelect},{default:s(()=>[a(l,{secondary:"",style:{width:"200px","justify-content":"flex-start"}},{default:s(()=>[t.moveTarget?(E(),B(v,{key:0,align:"center"},{default:s(()=>[a(t.GoUserAvatar,{width:22,height:22,avatarUrl:t.moveTarget.avatar},null,8,["avatarUrl"]),a(u,{depth:2,style:{"font-size":"13px"}},{default:s(()=>[i(A(t.moveTarget.nickname),1)]),_:1})]),_:1})):x("",!0)]),_:1})]),_:1},8,["options"])]),_:1}),n("div",Ie,[a(l,{class:"go-px-4",onClick:t.closeMoveHandle},{default:s(()=>e[19]||(e[19]=[i("取消")])),_:1}),a(l,{type:"primary",focusable:!0,disabled:!t.moveTarget,onClick:t.moveHandle},{default:s(()=>[a(u,null,{default:s(()=>e[20]||(e[20]=[i("移交空间")])),_:1})]),_:1},8,["disabled"])])])]),_:1},8,["show"]),a(y,{class:"go-move-scree-model go-background-filter",title:"删除空间",preset:"card",size:"small",style:{width:"550px"},show:t.showDeleteRef,"onUpdate:show":e[4]||(e[4]=r=>t.showDeleteRef=r),"transform-origin":"center",bordered:!0,"content-style":"padding: 0 0 10px;",onAfterLeave:t.closeDeleteHandle},{default:s(()=>[a(F,{style:{"margin-top":"4px","margin-bottom":"0"}}),n("div",ke,[n("p",he,[e[22]||(e[22]=i(" 确定要删除 「 ")),a(l,{text:"",type:"primary",style:{"font-size":"16px","font-weight":"bold"}},{default:s(()=>[i(A(c.teamDetail.team_name),1)]),_:1}),e[23]||(e[23]=i(" 」吗？ "))]),e[26]||(e[26]=n("p",null,"确认后将永久删除所有空间文件 操作不可撤销，请务必慎重操作。",-1)),n("p",null,[a(m,{value:t.inputTeamName,"onUpdate:value":e[3]||(e[3]=r=>t.inputTeamName=r),type:"text",placeholder:"请输入空间名称"},null,8,["value"])]),n("div",Me,[a(l,{class:"go-px-4",onClick:t.closeDeleteHandle},{default:s(()=>e[24]||(e[24]=[i("取消")])),_:1}),a(l,{type:"primary",focusable:!0,disabled:!t.inputTeamName,onClick:t.deleteHandle},{default:s(()=>[a(u,null,{default:s(()=>e[25]||(e[25]=[i("删除空间")])),_:1})]),_:1},8,["disabled"])])])]),_:1},8,["show"])],64)}const Re=G(pe,[["render",Ne],["__scopeId","data-v-78efb778"],["__file","setting.vue"]]),Pe=j({__name:"settingProject",setup(b,{expose:e}){e();const c=_(window.__PRIVATE_MODULE__.CreateTeamUpgrade),t=_(!0),o=_({createUserId:"",team_name:"...",team_charts_limit:0,chartCount:0,teamUserCount:0,team_number_limit:0,end_date:new Date}),g=ie(),u=async()=>{try{const m=await ce({teamId:g});if(setTimeout(()=>{t.value=!1},200),!m||m.code!==T.SUCCESS)return;o.value=m.data}catch(m){}};u();const p={isPrivate:c,loading:t,teamDetail:o,teamId:g,getTeamDetail:u,setting:Re};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}});function He(b,e,c,t,o,g){const u=f("n-spin"),p=f("n-space");return E(),S("div",null,[t.loading?(E(),B(p,{key:0,justify:"center",style:{width:"100%"}},{default:s(()=>[a(u,{size:"medium"})]),_:1})):(E(),B(t.setting,{key:1,teamDetail:t.teamDetail,onUpdateTeamInfo:e[0]||(e[0]=m=>t.getTeamDetail())},null,8,["teamDetail"]))])}const Qe=G(Pe,[["render",He],["__file","settingProject.vue"]]);export{Qe as default};
