var ht=Object.defineProperty,dt=Object.defineProperties;var mt=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var St=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable;var et=(t,s,o)=>s in t?ht(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o,A=(t,s)=>{for(var o in s||(s={}))St.call(s,o)&&et(t,o,s[o]);if(tt)for(var o of tt(s))gt.call(s,o)&&et(t,o,s[o]);return t},Y=(t,s)=>dt(t,mt(s));import{ao as b,a3 as pt,bh as $t,br as yt,D as It,E as P,ab as Mt,aT as Ot,b_ as bt,ah as T,bj as wt,M as Dt,aG as vt,ag as Tt}from"./index-DzJUk-4s.js";function Lt(t){return b({url:"/user/login",method:"post",data:t})}function Ut(t){return b({url:"/user/registerUser",method:"post",data:t})}function Ft(t){return b({url:"/user/getVerificationCode",method:"get",params:t})}function Nt(t){return b({url:"/user/updateInfo",method:"post",data:t})}function kt(t){return b({url:"/membership/getInfo",method:"get",params:t})}function nt(t){return b({url:"/membership/getSTSInfo",method:"get",params:t})}function Yt(t){return b({url:"/wechat/getQrCode",method:"get",params:t})}function Ht(t){return b({url:"/wechat/polling",method:"get",params:t})}function Bt(t){return b({url:"/wechat/wechatPolling",method:"get",params:t})}function Ct(t){const s=new FormData;return s.append("key",t.key),s.append("body",t.body),b({url:"/sealing/uploadFile",method:"post",data:s})}function Et(t){return b({url:"/membership/operationRecord",method:"post",data:t})}function Vt(t){return b({url:"/membership/createQuestionnaire",method:"post",data:t})}function Wt(t){return b({url:"/membership/changeSketchTimes",method:"post",data:t})}function Kt(t){return b({url:"/membership/changeExcelTimes",method:"post",data:t})}function zt(t){return b({url:"/user/saveOpenAI",method:"post",data:t})}var it={exports:{}};(function(t,s){(function(o,f){t.exports=f()})($t,function(){var o=1e3,f=6e4,l=36e5,$="millisecond",S="second",m="minute",g="hour",M="day",B="week",v="month",J="quarter",k="year",R="date",Z="Invalid Date",ut=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ct=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,ft={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(a){var r=["th","st","nd","rd"],e=a%100;return"["+a+(r[(e-20)%10]||r[e]||r[0])+"]"}},z=function(a,r,e){var i=String(a);return!i||i.length>=r?a:""+Array(r+1-i.length).join(e)+a},lt={s:z,z:function(a){var r=-a.utcOffset(),e=Math.abs(r),i=Math.floor(e/60),n=e%60;return(r<=0?"+":"-")+z(i,2,"0")+":"+z(n,2,"0")},m:function a(r,e){if(r.date()<e.date())return-a(e,r);var i=12*(e.year()-r.year())+(e.month()-r.month()),n=r.clone().add(i,v),u=e-n<0,c=r.clone().add(i+(u?-1:1),v);return+(-(i+(e-n)/(u?n-c:c-n))||0)},a:function(a){return a<0?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:v,y:k,w:B,d:M,D:R,h:g,m,s:S,ms:$,Q:J}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return a===void 0}},U="en",E={};E[U]=ft;var q="$isDayjsObject",Q=function(a){return a instanceof W||!(!a||!a[q])},V=function a(r,e,i){var n;if(!r)return U;if(typeof r=="string"){var u=r.toLowerCase();E[u]&&(n=u),e&&(E[u]=e,n=u);var c=r.split("-");if(!n&&c.length>1)return a(c[0])}else{var d=r.name;E[d]=r,n=d}return!i&&n&&(U=n),n||!i&&U},y=function(a,r){if(Q(a))return a.clone();var e=typeof r=="object"?r:{};return e.date=a,e.args=arguments,new W(e)},h=lt;h.l=V,h.i=Q,h.w=function(a,r){return y(a,{locale:r.$L,utc:r.$u,x:r.$x,$offset:r.$offset})};var W=function(){function a(e){this.$L=V(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[q]=!0}var r=a.prototype;return r.parse=function(e){this.$d=function(i){var n=i.date,u=i.utc;if(n===null)return new Date(NaN);if(h.u(n))return new Date;if(n instanceof Date)return new Date(n);if(typeof n=="string"&&!/Z$/i.test(n)){var c=n.match(ut);if(c){var d=c[2]-1||0,p=(c[7]||"0").substring(0,3);return u?new Date(Date.UTC(c[1],d,c[3]||1,c[4]||0,c[5]||0,c[6]||0,p)):new Date(c[1],d,c[3]||1,c[4]||0,c[5]||0,c[6]||0,p)}}return new Date(n)}(e),this.init()},r.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},r.$utils=function(){return h},r.isValid=function(){return this.$d.toString()!==Z},r.isSame=function(e,i){var n=y(e);return this.startOf(i)<=n&&n<=this.endOf(i)},r.isAfter=function(e,i){return y(e)<this.startOf(i)},r.isBefore=function(e,i){return this.endOf(i)<y(e)},r.$g=function(e,i,n){return h.u(e)?this[i]:this.set(n,e)},r.unix=function(){return Math.floor(this.valueOf()/1e3)},r.valueOf=function(){return this.$d.getTime()},r.startOf=function(e,i){var n=this,u=!!h.u(i)||i,c=h.p(e),d=function(j,w){var C=h.w(n.$u?Date.UTC(n.$y,w,j):new Date(n.$y,w,j),n);return u?C:C.endOf(M)},p=function(j,w){return h.w(n.toDate()[j].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(w)),n)},I=this.$W,O=this.$M,D=this.$D,x="set"+(this.$u?"UTC":"");switch(c){case k:return u?d(1,0):d(31,11);case v:return u?d(1,O):d(0,O+1);case B:var _=this.$locale().weekStart||0,F=(I<_?I+7:I)-_;return d(u?D-F:D+(6-F),O);case M:case R:return p(x+"Hours",0);case g:return p(x+"Minutes",1);case m:return p(x+"Seconds",2);case S:return p(x+"Milliseconds",3);default:return this.clone()}},r.endOf=function(e){return this.startOf(e,!1)},r.$set=function(e,i){var n,u=h.p(e),c="set"+(this.$u?"UTC":""),d=(n={},n[M]=c+"Date",n[R]=c+"Date",n[v]=c+"Month",n[k]=c+"FullYear",n[g]=c+"Hours",n[m]=c+"Minutes",n[S]=c+"Seconds",n[$]=c+"Milliseconds",n)[u],p=u===M?this.$D+(i-this.$W):i;if(u===v||u===k){var I=this.clone().set(R,1);I.$d[d](p),I.init(),this.$d=I.set(R,Math.min(this.$D,I.daysInMonth())).$d}else d&&this.$d[d](p);return this.init(),this},r.set=function(e,i){return this.clone().$set(e,i)},r.get=function(e){return this[h.p(e)]()},r.add=function(e,i){var n,u=this;e=Number(e);var c=h.p(i),d=function(O){var D=y(u);return h.w(D.date(D.date()+Math.round(O*e)),u)};if(c===v)return this.set(v,this.$M+e);if(c===k)return this.set(k,this.$y+e);if(c===M)return d(1);if(c===B)return d(7);var p=(n={},n[m]=f,n[g]=l,n[S]=o,n)[c]||1,I=this.$d.getTime()+e*p;return h.w(I,this)},r.subtract=function(e,i){return this.add(-1*e,i)},r.format=function(e){var i=this,n=this.$locale();if(!this.isValid())return n.invalidDate||Z;var u=e||"YYYY-MM-DDTHH:mm:ssZ",c=h.z(this),d=this.$H,p=this.$m,I=this.$M,O=n.weekdays,D=n.months,x=n.meridiem,_=function(w,C,N,K){return w&&(w[C]||w(i,u))||N[C].slice(0,K)},F=function(w){return h.s(d%12||12,w,"0")},j=x||function(w,C,N){var K=w<12?"AM":"PM";return N?K.toLowerCase():K};return u.replace(ct,function(w,C){return C||function(N){switch(N){case"YY":return String(i.$y).slice(-2);case"YYYY":return h.s(i.$y,4,"0");case"M":return I+1;case"MM":return h.s(I+1,2,"0");case"MMM":return _(n.monthsShort,I,D,3);case"MMMM":return _(D,I);case"D":return i.$D;case"DD":return h.s(i.$D,2,"0");case"d":return String(i.$W);case"dd":return _(n.weekdaysMin,i.$W,O,2);case"ddd":return _(n.weekdaysShort,i.$W,O,3);case"dddd":return O[i.$W];case"H":return String(d);case"HH":return h.s(d,2,"0");case"h":return F(1);case"hh":return F(2);case"a":return j(d,p,!0);case"A":return j(d,p,!1);case"m":return String(p);case"mm":return h.s(p,2,"0");case"s":return String(i.$s);case"ss":return h.s(i.$s,2,"0");case"SSS":return h.s(i.$ms,3,"0");case"Z":return c}return null}(w)||c.replace(":","")})},r.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},r.diff=function(e,i,n){var u,c=this,d=h.p(i),p=y(e),I=(p.utcOffset()-this.utcOffset())*f,O=this-p,D=function(){return h.m(c,p)};switch(d){case k:u=D()/12;break;case v:u=D();break;case J:u=D()/3;break;case B:u=(O-I)/6048e5;break;case M:u=(O-I)/864e5;break;case g:u=O/l;break;case m:u=O/f;break;case S:u=O/o;break;default:u=O}return n?u:h.a(u)},r.daysInMonth=function(){return this.endOf(v).$D},r.$locale=function(){return E[this.$L]},r.locale=function(e,i){if(!e)return this.$L;var n=this.clone(),u=V(e,i,!0);return u&&(n.$L=u),n},r.clone=function(){return h.w(this.$d,this)},r.toDate=function(){return new Date(this.valueOf())},r.toJSON=function(){return this.isValid()?this.toISOString():null},r.toISOString=function(){return this.$d.toISOString()},r.toString=function(){return this.$d.toUTCString()},a}(),X=W.prototype;return y.prototype=X,[["$ms",$],["$s",S],["$m",m],["$H",g],["$W",M],["$M",v],["$y",k],["$D",R]].forEach(function(a){X[a[1]]=function(r){return this.$g(r,a[0],a[1])}}),y.extend=function(a,r){return a.$i||(a(r,W,y),a.$i=!0),y},y.locale=V,y.isDayjs=Q,y.unix=function(a){return y(1e3*a)},y.en=E[U],y.Ls=E,y.p={},y})})(it);var _t=it.exports;const jt=pt(_t),L=It(),{GO_SYSTEM_STORE:ot}=Mt,rt=Ot(ot),at={level:0,points:0,startDate:"",endDate:"",status:"",model:""};let G={userInfo:{id:void 0,username:"",nickname:"",phone:"",avatar:"",token:void 0,email:""},fetchInfo:{OSSUrl:void 0},permission:[],membershipInfo:at,stsClientInfo:{},operationRecordObj:{},otherOption:{needQuestionnaire:!1},teamInfo:{id:"",createdAt:"",createUserId:"",end_date:"",team_name:"",invitationKey:"",isPersonTeam:!0,user_role_status:null,expired:!1},teamList:[],currentFolderId:"",fileFolderList:[],currentProjectLimit:{projectCount:0,projectLimitCount:0}};rt&&(G=Y(A(A({},G),rt),{currentFolderId:""}));const st=()=>{const s=H().getMembershipInfo,{status:o,startDate:f,endDate:l}=s;return!o||!f||!l?(L.emit(P.OPEN_UPGRADE_MEMBER),!1):!0},Rt=({needRequest:t=!1,callback:s=o=>{}})=>{if(!t){const f=st();f&&L.emit(P.CLOSE_UPGRADE_MEMBER),s(f);return}const o=H();kt({id:o.getUserInfo.id}).then(f=>{if(f!=null&&f.data){if(f.data.userInfo){const m=f.data.userInfo;o.setItem(T.USER_INFO,m)}const l=wt(Dt(f.data.membership));if(l===null||!l||!l.createUserId){vt(),L.emit(P.OPEN_UPGRADE_MEMBER),o.setItem(T.MEMBERSHIPINFO,at);return}l.needQuestionnaire&&l.status&&(o.otherOption.needQuestionnaire=!0);const $={level:l.level,points:l.points,startDate:l.startDate,endDate:l.endDate,status:l.status,model:l.model};l.isRoot&&($.isRoot=l.isRoot),o.setItem(T.MEMBERSHIPINFO,$);const S=st();S&&L.emit(P.CLOSE_UPGRADE_MEMBER),s(S)}})};L.on(P.CHECK_VALIDITY_MEMBER,Rt);const xt=({key:t="",description:s=""})=>{const o=H(),f=t;let l=o.getOperationRecordObj||{};const $=Number((l[f]||{}).total||0)+1;o.setItem(T.OPERATIONRECORDOBJ,Y(A({},l),{[f]:{key:f,description:s,total:$,date:jt().format("YYYY-MM-DD HH:00:00")}}));const S=o.getOperationRecordObj||{};if($>=1||Object.getOwnPropertyNames(S).length>=5){let m=[];for(let g in S){const M=S[g];m.push(M)}Et({list:m}).then(g=>{o.setItem(T.OPERATIONRECORDOBJ,{})})}};L.on(P.OPERATIONRECORD,xt);const H=yt({id:"useSystemStore",state:()=>G,getters:{getUserInfo(){return this.userInfo},getFetchInfo(){return this.fetchInfo},getPermission(){return this.permission},getMembershipInfo(){return this.membershipInfo||{}},checkSVIP:function(){return this.membershipInfo.level===2},getSTSClient:function(){return["3"].includes("1")?async()=>({putObject:Ct}):async()=>{const s=window;let o=0;if(s.stsOSSClient&&s.stsOSSClient.stsTokenFreshTime){const f=s.stsOSSClient.stsTokenFreshTime.getTime();o=new Date().getTime()-f}if(!s.stsOSSClient||o>10*60*1e3){const l=(await nt({})).data,$=H(),S=g=>{const M={endpoint:"https://goviewpro.goviewlink.com",region:"oss-cn-hangzhou",accessKeyId:g.AccessKeyId,accessKeySecret:g.AccessKeySecret,stsToken:g.SecurityToken,bucket:"goviewpro",cname:!0};return $.setItem(T.STSCLIENTINFO,M),M};S(l);const m=new s.OSS(Y(A({},this.stsClientInfo),{refreshSTSToken:async()=>{const g=await nt({});return S(g.data),{accessKeyId:l.AccessKeyId,accessKeySecret:l.AccessKeySecret,stsToken:l.SecurityToken}},refreshSTSTokenInterval:30*60*1e3}));return m.putObject=async g=>{const M=await m.put(g.key,g.body);return M.statusCode=200,M},s.stsOSSClient=m,m}return s.stsOSSClient}},getTeamInfo(){return this.teamInfo},getTeamList(){return this.teamList},isRootUser(){return this.membershipInfo.isRoot},getOperationRecordObj(){return this.operationRecordObj}},actions:{setItem(t,s){this.$patch(o=>{o[t]=s}),Tt(ot,this.$state)},checkTeamInfo(){let t=!0;this.teamList.forEach(s=>{this.teamInfo.id===s.id&&(t=!1,this.setItem(T.TEAMINFO,s))}),t&&this.setItem(T.TEAMINFO,{isPersonTeam:!0,team_name:"个人空间",id:""})},setTeamInfoItem(t,s,o){if(t===void 0||s===void 0)return;const f=this.teamList[this.teamList.findIndex(l=>l.id===t)];f&&(f[s]=o)},setProjectLimitItem(t,s){this.currentProjectLimit.projectCount=t,this.currentProjectLimit.projectLimitCount=s},checkSVIPFree:function(t,s){return s!=="masterplate"?!1:Number(t.User.id)===9&&this.checkSVIP&&t.points},checkOfficialUser:function(t,s){return Number(t)===9&&s==="masterplate"},setCloudStorageStatic:async function(t){const{id:s}=this.getUserInfo,o=t.name,f=`cloudStorageStatic/${s}/${o}`;return await(await this.getSTSClient()).putObject({key:f,body:t})},getCloudStorageStatic:async function(t={pageSize:1e3,nextMarker:"",searchContent:""}){const{id:s}=this.getUserInfo;let o=`cloudStorageStatic/${s}/`;return t.searchContent&&(o=`cloudStorageStatic/${s}/${t.searchContent}`),await(await this.getSTSClient()).list({prefix:o,marker:t.nextMarker,"max-keys":t.pageSize})},getCloudStorageDirectorySize:async function(){const{id:t}=this.getUserInfo;let s=0,o="";const f=await this.getSTSClient(),l=`cloudStorageStatic/${t}/`;for(;;){const $=await f.list({prefix:l,marker:o,"max-keys":1e3}),S=$.objects;for(const m of S)s+=m.size;if(!$.isTruncated)break;o=$.nextMarker}return{b:s,kb:s/1024,mb:s/1024/1024,gb:s/1024/1024/1024}},deleteCloudStorageStatic:async function(t){const{id:s}=this.getUserInfo;return t.includes(s)?await(await this.getSTSClient()).delete(t):!1},setAIModel(t){return this.setItem(T.MEMBERSHIPINFO,Y(A({},this.membershipInfo),{model:t})),t}}});window.getProjectURL=async(t,s={needContent:!1,path:"project"})=>{const f=await H().getSTSClient(),l=`${s.path}/${t}.txt`;let $=f.getObjectUrl(l);const S=async m=>{let g=null;try{g=await f.put(l,m,{headers:{"Content-Disposition":"attachment;","x-oss-object-acl":"public-read"}})}catch(M){window.$message.error("网络异常，保存失败！")}return g};if(s.needContent){let m=(await bt.get($,{responseType:"text"})).data;return{url:$,content:m,client:f,saveFn:S}}return{url:$,client:f,saveFn:S}};export{Yt as a,Ht as b,st as c,jt as d,Vt as e,Kt as f,Ft as g,Wt as h,Nt as i,Bt as j,Lt as l,Ut as r,zt as s,H as u};
