var re=Object.defineProperty,ie=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var q=(r,a,n)=>a in r?re(r,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[a]=n,Y=(r,a)=>{for(var n in a||(a={}))de.call(a,n)&&q(r,n,a[n]);if(K)for(var n of K(a))ue.call(a,n)&&q(r,n,a[n]);return r},G=(r,a)=>ie(r,ce(a));import{u as me}from"./useScreenCommunityScroll.hook-UzS3nILY.js";import{d as pe,bx as fe,ac as _e,r as w,G as ge,A as ve,c9 as he,D as ye,aO as X,ak as xe,aP as J,R as Q,aw as Se,ay as V,aC as W,az as Z,E as we,aM as Ee,bt as be,_ as Ce,U as _,c as h,o as u,q as E,s as o,t as z,V as $,w as s,X as T,F as O,n as ee,z as De,Y as A}from"./index-DzJUk-4s.js";import{i as te}from"./icon-Bt2TghsQ.js";import{f as Te,b as Me}from"./masterplates.api-CmXDBnKg.js";import{u as Be,T as ke}from"./templateStore.d-scXId6Zo.js";import{t as He,S as Ie,C as Ne}from"./showDetail-VigmGOIs.js";import{s as Ve,a as ze}from"./public-BhRo10AI.js";import{u as Oe}from"./systemStore-CDAOEx2u.js";import"./GoUserAvatar-BBITl89l.js";import"./drawRemote-BVHvBcY1.js";import"./index.d-J2-cmQid.js";import"./index-B2h3DCGB.js";import"./plugin-BZaVEG5Y.js";import"./file-BoGdIhh5.js";import"./index-DumZb7Zp.js";import"./index-YIaHLc6Z.js";import"./fileTypeEnum-22QBGXO_.js";import"./chart_default-Cv54ZmSo.js";import"./hot-tip-bg-5DNCBqVA.js";import"./points-Bi1H5gtF.js";const Ae=pe({__name:"template",setup(r,{expose:a}){a();const{SortAscendingIcon:n,SortDescendingIcon:e}=te.carbon,{ChevronDownIcon:L}=te.ionicons5,M=ye(),{bottom:y,list:d,inBottom:m,page:g,pageSize:x}=me(),S=fe(),b=_e(),p=Be(),i=Oe();let c=[...He];i.isRootUser&&c.push({label:"待审核",value:"pending"});const P=c.map(t=>t.label),v=w(1),B=w(!1),k=w(""),H=w(p.getHomeSort.sortKey||"star"),C=w(p.getHomeSort.sortValue||"desc"),ae=t=>{H.value=t,I()},oe=()=>{C.value=C.value==="asc"?"desc":"asc",I()},I=()=>{p.setItem(ke.HOME_SORT,{sortKey:H.value,sortValue:C.value}),D(!0)},R=()=>{const t=X(xe.SCREEN_TEMPLATE_ITEMS_NAME,"href");J(t,[],void 0,!1)},D=async(t=!1)=>{t&&(d.value=[],g.value=1,y.value=!1,m.value=!1);const l=await Te({sortKey:p.getHomeSort.sortKey,sortValue:p.getHomeSort.sortValue,tags:c[v.value].value,page:g.value,pageSize:x.value,all:1});l.code===Q.SUCCESS&&(t&&(d.value=[]),l.data.data.length===0||l.data.data.length<x.value?Se(()=>{m.value=!0}):m.value=!1,d.value.push(...l.data.data.map(f=>G(Y({},f),{type:"masterplate"}))))},se=async t=>{let l=null;l=S.create("正在添加到模板，请稍后",{type:"loading"});try{const f=await Me({id:t}),N=()=>V("div",{style:{borderRadius:"4px",padding:"8px 25px",boxShadow:"var(--n-box-shadow)",display:"flex",gap:"10px",backgroundColor:b.darkTheme?"#48484e":"#fff"}},[V(W,{},{default:()=>"创建成功,"}),V(Z,{text:!0,type:"primary",size:"small",onClick:R},{default:()=>"点击查看"})]);f.code===Q.SUCCESS&&(M.emit(we.CHECK_VALIDITY_MEMBER,{needRequest:!0}),l.destroy(),S.success("添加成功",{type:"success",render:N}))}catch(f){window.$message.error("创建失败, 请稍后重试")}},U=(t,l=!1)=>{v.value=t;const f=c[t].value,N=X(Ee.COMMUNITY_TEMPLATE_NAME).path;J(N,void 0,l,!1,{tag:f}),D(!0)},ne=t=>{k.value=t,B.value=!0},le=t=>{k.value=t.id},j=()=>{const t=be();if("tag"in t){const l=c.findIndex(f=>f.value===t.tag);l!==-1&&(v.value=l)}else v.value=1;g.value=1,U(v.value,!0)};j(),ge(()=>{ve(()=>y.value,t=>{if(t){if(g.value+=1,m.value)return;D()}})}),he(()=>{B.value=!1});const F={SortAscendingIcon:n,SortDescendingIcon:e,ChevronDownIcon:L,eventBus:M,bottom:y,list:d,inBottom:m,page:g,pageSize:x,message:S,designStore:b,templateStore:p,systemStore:i,get templateTags(){return c},set templateTags(t){c=t},tagsList:P,activeIndex:v,detailModelShow:B,detailModelId:k,selectValue:H,sort:C,handleSelect:ae,sortHandle:oe,updateHomeSortData:I,toTemplatePage:R,getListData:D,createHandle:se,selectHandle:U,toDetailHandle:ne,updateDetailHandle:le,initList:j,get NText(){return W},get NButton(){return Z},ContentCard:Ne,get suffixObj(){return ze},get suffixOptions(){return Ve},ShowDetail:Ie};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),Le={class:"community-template-box"},Pe=["onClick"],Re={class:"go-flex-center"},Ue={class:"content-box"},je={key:1,class:"go-flex-center go-mt-3"},Fe={style:{"max-height":"80vh",overflow:"auto","padding-top":"10px"}};function Ke(r,a,n,e,L,M){const y=_("n-h3"),d=_("n-flex"),m=_("n-icon"),g=_("n-dropdown"),x=_("n-tooltip"),S=_("n-spin"),b=_("n-divider"),p=_("n-modal");return u(),h(O,null,[E("div",Le,[o(d,{justify:"space-between",align:"center",style:{"margin-bottom":"10px"}},{default:s(()=>[o(y,{style:{"margin-bottom":"0px"}},{default:s(()=>a[1]||(a[1]=[T("全部模板")])),_:1})]),_:1}),o(d,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:s(()=>[o(d,{class:"tags-list",size:4},{default:s(()=>[(u(!0),h(O,null,ee(e.tagsList,(i,c)=>(u(),h("div",{class:De(["item",{active:e.activeIndex===c}]),key:i,onClick:P=>e.selectHandle(c)},[o(e.NText,null,{default:s(()=>[T(A(i),1)]),_:2},1024)],10,Pe))),128))]),_:1}),E("div",Re,[o(g,{options:e.suffixOptions,onSelect:e.handleSelect},{default:s(()=>[o(e.NButton,{"icon-placement":"right",quaternary:"",size:"small",focusable:!1},{icon:s(()=>[o(m,{depth:"3",size:"16"},{default:s(()=>[o(e.ChevronDownIcon)]),_:1})]),default:s(()=>[T(A(e.suffixObj[e.selectValue])+" ",1)]),_:1})]),_:1},8,["options"]),o(x,{placement:"bottom",trigger:"hover","show-arrow":!1},{trigger:s(()=>[o(e.NButton,{class:"go-ml-1",quaternary:"",focusable:!1,size:"small",onClick:e.sortHandle},{icon:s(()=>[o(m,{size:"16"},{default:s(()=>[e.sort==="asc"?(u(),z(e.SortAscendingIcon,{key:0})):(u(),z(e.SortDescendingIcon,{key:1}))]),_:1})]),_:1})]),default:s(()=>[E("span",null,A(e.sort==="desc"?"倒序":"正序"),1)]),_:1})])]),_:1}),E("div",Ue,[(u(!0),h(O,null,ee(e.list,i=>(u(),h("div",{class:"screen-list",key:i.id},[o(e.ContentCard,{toDetail:!1,"is-hot":!1,cardData:i,onCreate:e.createHandle,onDetail:c=>e.toDetailHandle(i.id)},null,8,["cardData","onDetail"])]))),128))]),e.inBottom?$("",!0):(u(),z(d,{key:0,justify:"center"},{default:s(()=>[o(S,{class:"go-mt-3",show:e.bottom},null,8,["show"])]),_:1})),e.list.length>12&&e.inBottom?(u(),h("div",je,[o(e.NText,{depth:3},{default:s(()=>a[2]||(a[2]=[T("已经到底部啦~")])),_:1})])):$("",!0)]),o(p,{class:"go-background-filter",title:"资源详情",preset:"card",size:"small",style:{width:"80vw","max-width":"1400px"},show:e.detailModelShow,"onUpdate:show":a[0]||(a[0]=i=>e.detailModelShow=i),"transform-origin":"center",bordered:!0,"content-style":"padding: 0 0 10px;"},{default:s(()=>[o(b,{style:{"margin-top":"4px","margin-bottom":"0"}}),E("div",Fe,[o(e.ShowDetail,{category:"masterplate",id:e.detailModelId,onUpdateDetail:e.updateDetailHandle},null,8,["id"])])]),_:1},8,["show"])],64)}const mt=Ce(Ae,[["render",Ke],["__scopeId","data-v-ae8c8407"],["__file","template.vue"]]);export{mt as default};
